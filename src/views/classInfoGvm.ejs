<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
  <link rel="stylesheet" href="/css/table.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/gvmList.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />

  <style>
    /* nmsvbmbvsmnvds */
    .teacher-group {
      border-top: 2px solid black;

      /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */
      border-collapse: separate;
      margin-bottom: 10px;
    }

    .teacher-group td,
    .teacher-group th {
      padding: 8px;
      text-align: left;
      border: 2px solid black;
      /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */
    }
  </style>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .class-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      table-layout: auto;
      /* Cho ph√©p b·∫£ng t·ª± ƒëi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc c·ªôt */
    }

    .class-table th,
    .class-table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
      white-space: normal;
      /* Cho ph√©p xu·ªëng d√≤ng */
      word-wrap: break-word;
      /* Chia t·ª´ v√† xu·ªëng d√≤ng khi c·∫ßn */
    }

    .class-table th {
      background-color: #007bff;
      /* ƒê·ªïi m√†u n·ªÅn ti√™u ƒë·ªÅ th√†nh xanh d∆∞∆°ng */
      color: white;
      font-weight: bold;
    }

    .class-table tbody tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    .class-table tbody tr:hover {
      background-color: #ddd;
    }

    .action-button {
      background-color: #4caf50;
      color: white;
      padding: 5px 10px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }

    .action-button:hover {
      background-color: #45a049;
    }

    /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc c√°c c·ªôt */
    .class-table th,
    .class-table td {
      min-width: 50px;
      /* ƒê·∫∑t k√≠ch th∆∞·ªõc t·ªëi thi·ªÉu cho c·ªôt ƒë·ªÉ kh√¥ng b·ªã qu√° h·∫πp */
    }
  </style>

  <style>
    /* ph·∫ßn css cho label t·ªïng s·ªë ti·∫øt ki*/
    .total-label {
      margin-left: auto;
      /* CƒÉn ph·∫£i cho th·∫ª total-label */
      margin-right: 0;
      font-family: Arial, sans-serif;
      font-size: 16px;
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
      width: fit-content;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: block;
      /* ƒê·∫£m b·∫£o th·∫ª div l√† kh·ªëi ƒë·ªÉ cƒÉn ph·∫£i ho·∫°t ƒë·ªông */
    }

    .total-label label {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ in ƒë·∫≠m */
      color: #000;
      /* M√†u ch·ªØ ƒëen */
      margin-right: 8px;
      /* Th√™m kho·∫£ng c√°ch b√™n ph·∫£i */
      cursor: pointer;
      /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn v√† m√†u ch·ªØ m·ªÅm m·∫°i */
      padding: 5px 10px;
      /* Th√™m padding cho label ƒë·ªÉ t·∫°o kh√¥ng gian */
      border: 1px solid #ccc;
      /* Khung cho label */
      border-radius: 4px;
      /* Bo g√≥c cho khung */
    }

    .total-label label,
    .total-label label span {
      background-color: #007bff;
      /* M√†u n·ªÅn khi hover */
      color: #fff;
      /* M√†u ch·ªØ tr·∫Øng khi hover */
    }

    .total-label span {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ trong span c≈©ng in ƒë·∫≠m */
      color: #333;
      /* M√†u ch·ªØ ƒë·∫≠m cho gi√° tr·ªã */
    }

    /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·∫£ input[type="date"] v√† input[type="text"] */
    input[type="date"],
    input[type="text"] {
      width: 120px;
      /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y theo mong mu·ªën */
      box-sizing: border-box;
      padding: 5px;
      /* Gi·ªØ padding nh∆∞ c≈© */
    }
  </style>
  <!-- Ph√¢n quy·ªÅn -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      //const role = localStorage.getItem("userRole");
      const MaPhongBan = localStorage.getItem("MaPhongBan");
      // ·∫®n ph·∫ßn l·ªçc khoa n·∫øu role l√† Khoa
      const departmentFilter = document.getElementById("departmentFilter");

      if (
        !MaPhongBan.includes("DAOTAO") &&
        !MaPhongBan.includes("TAICHINH")
      ) {
        departmentFilter.style.display = "none";
      }
    });
  </script>
</head>

<body>
  <!-- Ph·∫ßn header -->
  <%- include('header') %>

    <div class="container-fluid m-4 box">
      <div class="d-flex justify-content-center">
        <!-- Main content -->
        <div class="gvmList" style="width: 100%">
          <div class="m-3">
            <div class="">
              <h1>TH√îNG TIN C√ÅC L·ªöP GI·∫¢NG VI√äN M·ªúI</h1>
              <div class="header-actions" style="height: 45px">
                <!-- <button class="add-class" onclick="addClass()">+ Th√™m gi·∫£ng vi√™n m·ªùi</button> -->
                <input type="text" placeholder="T√¨m ki·∫øm theo T√™n..." class="search" id="searchInput"
                  onkeyup="searchClass()" />

                <div class="loc d-flex">
                  <select class="selectop mx-1" id="combobox-dot">
                    <option value="">ƒê·ª£t</option>
                  </select>

                  <!-- Combo box k√¨ -->
                  <select class="selectop mx-1" id="combobox-ki">
                    <option value="">K·ª≥</option>
                  </select>

                  <!-- Combo box NƒÉm -->
                  <select class="selectop mx-1" id="NamHoc">
                    <option value="">NƒÉm h·ªçc</option>
                  </select>
                  <select class="selectop mx-1" id="departmentFilter">
                    <option value="">Ch·ªçn khoa</option>
                  </select>

                  <select id="he_dao_tao" name="he_dao_tao" class="w-200px mx-2 selectop">
                    <option value="ALL">T·∫•t c·∫£ h·ªá</option>
                    <option value="ƒê·∫°i h·ªçc (ƒê√≥ng h·ªçc ph√≠)">
                      ƒê·∫°i h·ªçc (ƒê√≥ng h·ªçc ph√≠)
                    </option>
                    <option value="ƒê·∫°i h·ªçc (M·∫≠t m√£)">ƒê·∫°i h·ªçc (M·∫≠t m√£)</option>
                    <option value="Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)">Cao h·ªçc</option>
                    <option value="Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)">
                      Nghi√™n c·ª©u sinh
                    </option>
                  </select>

                  <button class="btn text-nowrap mx-2" id="render" style="height: 45px" onclick="filterTable()">
                    Hi·ªÉn th·ªã
                  </button>
                </div>
              </div>

              <table class="class-table" id="classTable">
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Gi·∫£ng vi√™n</th>
                    <th>M√¥n h·ªçc</th>
                    <th>T√™n l·ªõp</th>
                    <th>S·ªë t√≠n ch·ªâ</th>
                    <th>ƒê·ª£t</th>
                    <th>K·ª≥</th>
                    <th>NƒÉm</th>
                    <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
                    <th>Ng√†y k·∫øt th√∫c</th>
                    <th>S·ªë ti·∫øt</th>
                    <th>T·ªïng s·ªë ti·∫øt</th>
                    <th>T·ªïng s·ªë ti·∫øt c·∫£ nƒÉm</th>
                    <th>Khoa</th>
                    <!-- C·ªôt Khoa -->
                    <th>Chi ti·∫øt gi·∫£ng vi√™n m·ªùi</th>
                  </tr>
                </thead>

                <tbody class="teacher-group" id="data-table-body"></tbody>
              </table>
              <!-- t·ªïng ti·∫øt -->
              <!-- Label t·ªïng s·ªë ti·∫øt t√°ch ri√™ng v·ªõi b·∫£ng -->
              <div class="total-label">
                <!-- <label>T·ªïng s·ªë ti·∫øt L√™n L·ªõp: <span class="value" id="totalLL">0</span></label> -->
                <label>T·ªïng s·ªë ti·∫øt Quy Chu·∫©n:
                  <span class="value" id="totalQC">0</span></label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <tbody style="display: none" class="teacher-group" id="data-table-body"></tbody>

    <script>
      function filterTable() {
        // L·∫•y gi√° tr·ªã l·ªçc t·ª´ c√°c dropdown
        let dot = document.getElementById("combobox-dot").value;
        let ki = document.getElementById("combobox-ki").value;
        let nam = document.getElementById("NamHoc").value;
        let department = document
          .getElementById("departmentFilter")
          .value.trim();
        const he_dao_tao = document.getElementById("he_dao_tao").value;

        // T·∫°o d·ªØ li·ªáu g·ª≠i ƒë·∫øn server
        const filterData = {
          dot: dot,
          ki: ki,
          nam: nam,
          department: department,
          he_dao_tao: he_dao_tao,
        };

        // G·ª≠i request t·ªõi server ƒë·ªÉ l·∫•y d·ªØ li·ªáu l·ªçc
        fetch("/api/getClassInfoGvmData", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(filterData),
        })
          .then((response) => response.json())
          .then((data) => {
            // Render l·∫°i b·∫£ng d·ª±a tr√™n d·ªØ li·ªáu tr·∫£ v·ªÅ t·ª´ server
            renderTable(data);
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
          });
      }

      function renderTable(data) {
        console.log(data);
        const tableBody = document.getElementById("data-table-body");
        tableBody.innerHTML = ""; // Clear previous data

        let index = 1;

        // Duy·ªát qua t·∫•t c·∫£ c√°c gi·∫£ng vi√™n trong groupedByTeacher
        // Gi·∫£ s·ª≠ bi·∫øn "index" v√† "tableBody" ƒë√£ ƒë∆∞·ª£c khai b√°o t·ª´ tr∆∞·ªõc

        Object.keys(data).forEach((teacher) => {
          const courses = data[teacher];

          // T√≠nh t·ªïng s·ªë ti·∫øt c·ªßa t·∫•t c·∫£ c√°c kh√≥a h·ªçc (bao g·ªìm c·∫£ kh√≥a h·ªçc cu·ªëi c√πng)
          const totalSoTiet = courses.reduce(
            (total, course) => total + (parseFloat(course.SoTiet) || 0),
            0
          );

          // L·∫•y ƒë·ªëi t∆∞·ª£ng cu·ªëi c√πng c·ªßa m·∫£ng ƒë·ªÉ t√≠nh s·ªë ti·∫øt ƒë·ªì √°n, kh√¥ng render n√≥ ra b·∫£ng
          const lastCourse = courses[courses.length - 1];
          const tongSoTietBaoGomDoAn = lastCourse.soTietDoAn ? lastCourse.soTietDoAn + totalSoTiet : totalSoTiet;

          // Render b·∫£ng ch·ªâ v·ªõi c√°c ph·∫ßn t·ª≠ t·ª´ ƒë·∫ßu ƒë·∫øn ph·∫ßn t·ª≠ √°p ch√≥t (b·ªè qua ƒë·ªëi t∆∞·ª£ng cu·ªëi c√πng)
          courses.slice(0, -1).forEach((course, courseIndex) => {
            const tr = document.createElement("tr");
            tr.setAttribute("data-department", course.Khoa);
            tr.setAttribute("data-dot", course.Dot);
            tr.setAttribute("data-ki", course.KiHoc);
            tr.setAttribute("data-nam", course.NamHoc);

            // N·∫øu l√† kh√≥a h·ªçc ƒë·∫ßu ti√™n c·ªßa gi·∫£ng vi√™n, th√™m th√¥ng tin gi·∫£ng vi√™n v·ªõi rowspan
            if (courseIndex === 0) {
              tr.classList.add("teacher-group");
              tr.innerHTML = `
        <td rowspan="${courses.length - 1}">${index}</td>
        <td rowspan="${courses.length - 1}">${course.GiangVien}</td>
      `;
              index++;
            }

            // Th√™m c√°c √¥ d·ªØ li·ªáu cho m√¥n h·ªçc
            tr.innerHTML += `
      <td>${course.TenHocPhan}</td>
      <td>${course.Lop}</td>
      <td>${course.SoTinChi}</td>
      <td>${course.Dot}</td>
      <td>${course.KiHoc}</td>
      <td>${course.NamHoc}</td>
      <td>${formatDate(course.NgayBatDau)}</td>
      <td>${formatDate(course.NgayKetThuc)}</td>
      <td>${course.SoTiet}</td>
    `;

            // N·∫øu l√† kh√≥a h·ªçc ƒë·∫ßu ti√™n c·ªßa gi·∫£ng vi√™n, th√™m th√¥ng tin t·ªïng s·ªë ti·∫øt, ph√≤ng ban v√† n√∫t xem chi ti·∫øt
            if (courseIndex === 0) {
              tr.innerHTML += `
        <td rowspan="${courses.length - 1}">${totalSoTiet.toFixed(2)}</td>
        <td rowspan="${courses.length - 1}">${tongSoTietBaoGomDoAn.toFixed(2)}</td>
        <td rowspan="${courses.length - 1}">${course.Khoa}</td>
        <td rowspan="${courses.length - 1}">
          <button class="action-button view" onclick="viewClass(this, '${parseInt(course.id_Gvm) - 1}')">üëÅÔ∏è</button>
        </td>
      `;
            }

            tableBody.appendChild(tr);
          });
        });

        calculateTotals();
      }

      // H√†m format ng√†y th√°ng
      function formatDate(dateStr) {
        if (!dateStr) return "N/A";
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return "N/A";
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
      }

      // Gi·∫£ s·ª≠ GiangDay ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr∆∞·ªõc ƒë√≥
      renderTable(GiangDay);
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let totalQC = 0;
        // console.log(totalQC)

        // Ch·ªçn t·∫•t c·∫£ c√°c h√†ng ch·ª©a d·ªØ li·ªáu
        const rows = document.querySelectorAll(
          "tbody.teacher-group tr[data-department]"
        );

        rows.forEach((row) => {
          // Ki·ªÉm tra xem h√†ng c√≥ hi·ªÉn th·ªã hay kh√¥ng
          const isVisible = row.style.display != "none";

          if (isVisible) {
            // L·∫•y √¥ QuyChuan theo th·ª© t·ª± c·ªôt (gi·∫£ ƒë·ªãnh c·ªôt QuyChuan l√† c·ªôt th·ª© 10)
            const qcCell = row.querySelector("td:nth-child(12)");
            if (qcCell) {
              const qcValue = parseFloat(qcCell.textContent.trim());
              if (!isNaN(qcValue)) {
                // console.log(totalQC)
                totalQC += qcValue;
              }
            }
          }
        });

        // Hi·ªÉn th·ªã t·ªïng s·ªë ti·∫øt QuyChu·∫©n v√†o element c√≥ id `totalQC`
        document.getElementById("totalQC").textContent = totalQC.toFixed(2);
      });
    </script>
    <script>
      // t·ªïng quy chu·∫©n
      function calculateTotals() {
        let totalQC = 0;
        // console.log(totalQC)

        // Ch·ªçn t·∫•t c·∫£ c√°c h√†ng ch·ª©a d·ªØ li·ªáu
        const rows = document.querySelectorAll(
          "tbody.teacher-group tr[data-department]"
        );

        rows.forEach((row) => {
          // Ki·ªÉm tra xem h√†ng c√≥ hi·ªÉn th·ªã hay kh√¥ng
          const isVisible = row.style.display != "none";

          if (isVisible) {
            // L·∫•y √¥ QuyChuan theo th·ª© t·ª± c·ªôt (gi·∫£ ƒë·ªãnh c·ªôt QuyChuan l√† c·ªôt th·ª© 10)
            const qcCell = row.querySelector("td:nth-child(12)");
            if (qcCell) {
              const qcValue = parseFloat(qcCell.textContent.trim());
              if (!isNaN(qcValue)) {
                totalQC += qcValue;
              }
            }
          }
        });

        // Hi·ªÉn th·ªã t·ªïng s·ªë ti·∫øt QuyChu·∫©n v√†o element c√≥ id `totalQC`
        document.getElementById("totalQC").textContent = totalQC.toFixed(2);
      }

      // T√¨m ki·∫øm gi·∫£ng vi√™n m·ªùi theo t√™n
      function searchClass() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("classTable");
        let rows = table.getElementsByTagName("tr");

        let currentGroup = [];
        let groupVisible = false;

        for (let i = 1; i < rows.length; i++) {
          // B·∫Øt ƒë·∫ßu t·ª´ 1 ƒë·ªÉ b·ªè qua h√†ng ti√™u ƒë·ªÅ
          let row = rows[i];

          if (row.classList.contains("teacher-group")) {
            // ƒê√¢y l√† h√†ng ƒë·∫ßu ti√™n c·ªßa m·ªôt nh√≥m gi·∫£ng vi√™n m·ªõi
            if (currentGroup) {
              // ·∫®n/hi·ªán nh√≥m tr∆∞·ªõc ƒë√≥ d·ª±a tr√™n k·∫øt qu·∫£ t√¨m ki·∫øm
              setGroupVisibility(currentGroup, groupVisible);
            }

            currentGroup = [];
            groupVisible = false;
          }

          currentGroup.push(row);

          let teacherNameCell = row.cells[1]; // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n ·ªü c·ªôt th·ª© 2
          if (teacherNameCell) {
            let teacherName = teacherNameCell.textContent.toLowerCase();
            if (teacherName.includes(input)) {
              groupVisible = true;
            }
          }
        }

        // X·ª≠ l√Ω nh√≥m cu·ªëi c√πng
        if (currentGroup) {
          setGroupVisibility(currentGroup, groupVisible);
        }
        calculateTotals();
      }

      function setGroupVisibility(group, isVisible) {
        for (let row of group) {
          row.style.display = isVisible ? "" : "none";
        }
      }

      async function fetchGVMLists() {
        try {
          const response = await fetch("/api/classInfoGvm");
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          const gvmLists = await response.json();
          return gvmLists;
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      function viewClass(button, index) {
        var hre = "/viewGvm/" + index;
        window.location.href = hre;
      }

      // ƒê√≥ng modal
      function closeModal() {
        document.getElementById("modal").style.display = "none";
      }

      // Th√™m s·ª± ki·ªán khi nh·∫•n ra ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
      window.onclick = function (event) {
        let modal = document.getElementById("modal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>

    <script>
      // L·∫•y query string t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get("message");

      // L·∫•y ph·∫ßn t·ª≠ div ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
      const messageDiv = document.getElementById("message");

      // console.log(message)
      // Hi·ªÉn th·ªã th√¥ng b√°o d·ª±a tr√™n gi√° tr·ªã c·ªßa message
      if (message === "insertSuccess") {
        alert("Update Success");
      } else if (message === "insertFalse") {
        alert("Update False");
      }

      // Sau khi hi·ªÉn th·ªã th√¥ng b√°o, x√≥a query string ƒë·ªÉ tr√°nh hi·ªÉn th·ªã l·∫°i khi refresh
      if (message) {
        // S·ª≠ d·ª•ng window.history ƒë·ªÉ x√≥a query string m√† kh√¥ng refresh l·∫°i trang
        const newUrl = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
      }
    </script>

    <!-- Ph·∫ßn ph√¢n quy·ªÅn -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="ThongTinGD"
        const ThongTinGD = document.getElementById("ThongTinGD");

        ThongTinGD.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt
          const isKhoa = localStorage.getItem("isKhoa"); // L·∫•y role t·ª´ localStorage

          if (isKhoa == 0) {
            // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/info2";
          } else {
            window.location.href = "/info";
          }
        });

        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="Home"

        const Home = document.getElementById("Home");

        Home.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

          const isKhoa = localStorage.getItem("isKhoa");

          if (isKhoa == 0) {
            // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/maindt";
          } else {
            window.location.href = "/mainkhoa";
          }
        });
      });
    </script>

    <script>
      window.onload = function () {
        const TenNhanVien = localStorage.getItem("TenNhanVien"); // L·∫•y t√™n ng∆∞·ªùi d√πng t·ª´ localStorage
        let Role = localStorage.getItem("userRole");
        if (Role.toUpperCase() == "L√ÉNH ƒê·∫†O KHOA") {
          Role = "LƒêK";
        }
        if (TenNhanVien) {
          // Hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng tr√™n ph·∫ßn t·ª≠ HTML
          document.querySelector(
            ".fullname"
          ).innerText = `${TenNhanVien} - ${Role}`;
        } else {
          document.querySelector(".fullname").innerText = "Hi, Guest"; // Hi·ªÉn th·ªã n·∫øu kh√¥ng c√≥ t√™n ng∆∞·ªùi d√πng
        }
        //document.querySelector(".role").innerText = `${Role}`;
      };
    </script>
    <script>
      document
        .getElementById("changePasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

          if (tenDangNhap) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
            window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(
              tenDangNhap
            )}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
          }
        });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const isKhoa = localStorage.getItem("isKhoa");
        const role = localStorage.getItem("userRole");
        const Quyen = localStorage.getItem("userRole");

        // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
        const actionButton = document.getElementById("actionButton");
        const actionButton1 = document.getElementById("actionButton1");
        const actionButton2 = document.getElementById("actionButton2");
        const actionButton3 = document.getElementById("actionButton3");

        if (isKhoa == 0) {
          actionButton1.style.display = "none"; // ·∫®n actionButton1 n·∫øu isKhoa = 0
          actionButton2.style.display = "inline-block"; // Hi·ªán actionButton2
          if (role.trim().toLocaleLowerCase() == "th∆∞·ªùng") {
            actionButton2.style.display = "none"; // Hi·ªán actionButton2
          }
        } else {
          actionButton1.style.display = "inline-block"; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
          actionButton2.style.display = "none"; // ·∫®n actionButton2

          if (Quyen.toLowerCase() == "gv") {
            actionButton1.style.display = "none"; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
          }
        }

        //·∫®n site duy·ªát l·ªõp gk
        if (Quyen === "L√£nh ƒë·∫°o khoa" || Quyen === "Duy·ªát") {
          actionButton3.style.display = "";
        } else {
          actionButton3.style.display = "none";
        }
      });
    </script>

    <script>
      $(document).ready(function () {
        $('#NamHoc option[value=""]').remove();
        $('#combobox-ki option[value=""]').remove();
        $('#combobox-dot option[value=""]').remove();

        $.ajax({
          url: "/getNamHoc",
          method: "GET",
          success: function (response) {
            if (response.success) {
              response.NamHoc.forEach(function (item) {
                console.log(item.NamHoc);
                $("#NamHoc").append(
                  `<option value="${item.NamHoc}">${item.NamHoc}</option>`
                );
              });

              response.Ki.forEach(function (item) {
                console.log(item.Ki);
                $("#combobox-ki").append(
                  `<option value="${item.value}">${item.Ki}</option>`
                );
              });
              response.Dot.forEach(function (item) {
                console.log(item.Dot);
                $("#combobox-dot").append(
                  `<option value="${item.value}">${item.Dot}</option>`
                );
              });
            } else {
              console.error(
                "Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu nƒÉm h·ªçc:",
                response.message
              );
            }
          },
          error: function (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu nƒÉm h·ªçc:", error);
          },
        });
      });
    </script>

    <!-- <script>
    function filterTable() {
      // L·∫•y gi√° tr·ªã l·ªçc
      let dot = document.getElementById("combobox-dot").value;
      let ki = document.getElementById("combobox-ki").value;
      let nam = document.getElementById("NamHoc").value;
      let department = document.getElementById("departmentFilter").value.trim();
  
      let tbody = document.getElementById("data-table-body");
      let teacherGroups = tbody.querySelectorAll("tr.teacher-group"); // Ch·ªâ l·∫•y c√°c d√≤ng nh√≥m gi·∫£ng vi√™n
  
      // Duy·ªát qua t·ª´ng nh√≥m gi·∫£ng vi√™n
      teacherGroups.forEach((teacherGroupRow) => {
        let courses = teacherGroupRow.nextElementSibling; // L·∫•y d√≤ng m√¥n h·ªçc k·∫ø ti·∫øp
        let showGroup = false; // ƒê·∫∑t m·∫∑c ƒë·ªãnh l√† ·∫©n
  
        // Duy·ªát qua t·ª´ng d√≤ng m√¥n h·ªçc thu·ªôc nh√≥m gi·∫£ng vi√™n
        while (courses && !courses.classList.contains("teacher-group")) {
          let rowDepartment = courses.getAttribute("data-department");
          let rowDot = courses.getAttribute("data-dot");
          let rowKi = courses.getAttribute("data-ki");
          let rowNam = courses.getAttribute("data-nam");
  
          // Ki·ªÉm tra c√°c ƒëi·ªÅu ki·ªán l·ªçc
          let matchesDepartment = department === "ALL" || rowDepartment === department;
          let matchesDot = rowDot === dot;
          let matchesKi = rowKi === ki;
          let matchesNam = rowNam === nam;

          console.log("stt");
          console.log("nam = ", nam);
          console.log("row nam = ", rowNam);
          console.log("matchesNam = ", matchesNam);
  
          // N·∫øu c√≥ m√¥n h·ªçc n√†o kh·ªõp v·ªõi ƒëi·ªÅu ki·ªán l·ªçc, hi·ªÉn th·ªã c·∫£ nh√≥m
          if (matchesDepartment && matchesDot && matchesKi && matchesNam) {
            showGroup = true;
            break; // Tho√°t v√≤ng l·∫∑p v√¨ ch·ªâ c·∫ßn m·ªôt m√¥n h·ªçc kh·ªõp
          }
  
          courses = courses.nextElementSibling; // Ti·∫øp t·ª•c sang d√≤ng m√¥n h·ªçc ti·∫øp theo
        }
  
        // Hi·ªÉn th·ªã ho·∫∑c ·∫©n d√≤ng nh√≥m gi·∫£ng vi√™n v√† c√°c d√≤ng m√¥n h·ªçc c·ªßa nh√≥m
        if (showGroup) {
          teacherGroupRow.style.display = ""; // Hi·ªÉn th·ªã d√≤ng nh√≥m gi·∫£ng vi√™n
          let courseRow = teacherGroupRow.nextElementSibling;
          while (courseRow && !courseRow.classList.contains("teacher-group")) {
            courseRow.style.display = ""; // Hi·ªÉn th·ªã c√°c d√≤ng m√¥n h·ªçc
            courseRow = courseRow.nextElementSibling;
          }
        } else {
          teacherGroupRow.style.display = "none"; // ·∫®n d√≤ng nh√≥m gi·∫£ng vi√™n
          let courseRow = teacherGroupRow.nextElementSibling;
          while (courseRow && !courseRow.classList.contains("teacher-group")) {
            courseRow.style.display = "none"; // ·∫®n c√°c d√≤ng m√¥n h·ªçc
            courseRow = courseRow.nextElementSibling;
          }
        }
      });
      // Hi·ªÉn th·ªã l·∫°i tbody sau khi l·ªçc
      tbody.style.display = "table-row-group";  // Hi·ªÉn th·ªã l·∫°i tbody
  
      calculateTotals(); // C·∫≠p nh·∫≠t l·∫°i t·ªïng s·ªë sau khi l·ªçc
    }
  </script> -->

    <script>
      $(document).ready(function () {
        $('#departmentFilter option[value=""]').remove();
        // G·ªçi AJAX ƒë·ªÉ l·∫•y d·ªØ li·ªáu JSON t·ª´ API
        $.ajax({
          url: "/getPhongBan", // ƒê∆∞·ªùng d·∫´n t·ªõi API getPhongBan
          method: "GET",
          success: function (response) {
            // Ki·ªÉm tra n·∫øu response th√†nh c√¥ng
            const MaPhongBan = response.MaPhongBan;
            if (response.success) {
              $("#departmentFilter").prepend(
                '<option value="ALL">T·∫•t c·∫£ khoa</option>'
              );
              // L·∫∑p qua t·ª´ng m·ª•c trong m·∫£ng MaPhongBan
              response.MaPhongBan.forEach(function (item) {
                // N·∫øu item.MaPhongBan b·∫±ng boMon.MaPhongBan, hi·ªÉn th·ªã tr∆∞·ªõc
                console.log(item);
                $("#departmentFilter").append(
                  `<option value="${item.MaPhongBan}">${item.MaPhongBan}</option>`
                );
              });

              // N·∫øu kh√¥ng c√≥ ph√≤ng ban n√†o t∆∞∆°ng ·ª©ng, b·∫°n c√≥ th·ªÉ th√™m t√πy ch·ªçn m·∫∑c ƒë·ªãnh ·ªü ƒë√¢y
              if (!$("#departmentFilter option:selected").length) {
                $("#departmentFilter").prepend(
                  '<option value="">Ch·ªçn Ph√≤ng Ban</option>'
                );
              }
            } else {
              console.error(
                "Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu phongBan:",
                response.message
              );
            }
          },
          error: function (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu phongBan:", error);
          },
        });
      });
    </script>
    <script>
      document
        .getElementById("infome")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const id_User = localStorage.getItem("id_User"); // L·∫•y id_User t·ª´ localStorage\
          if (id_User) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang infome v√† truy·ªÅn id_User trong URL
            window.location.href = `/infome/${id_User}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y id_User trong localStorage.");
          }
        });
    </script>
</body>

</html>