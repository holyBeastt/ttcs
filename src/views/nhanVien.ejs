<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
    <link rel="stylesheet" href="/css/table.css" />
    <link rel="stylesheet" href="/css/admin.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/styles.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <%-include('adminHeader') %>

    <div class="container my-5 box">
      <div class="d-flex justify-content-start mb-3">
        <!-- N√∫t L·ªçc m√†u gi·ªëng n√∫t Hi·ªÉn th·ªã -->

        <button id="createNv" class="btn">
          <i class="bi bi-plus-circle"></i> Th√™m Nh√¢n Vi√™n
        </button>
        <script>
          document
            .getElementById("createNv")
            .addEventListener("click", function () {
              window.location.href = "/themNhanVienSite";
            });
        </script>
        <input
          type="text"
          placeholder="T√¨m ki·∫øm theo t√™n nh√¢n vi√™n..."
          class="search mx-3"
          id="searchInput"
          style="height: 40px; width: 300px"
        />
        <input
          type="text"
          placeholder="T√¨m ki·∫øm theo m√£ ph√≤ng ban..."
          class="search mx-3"
          id="searchPB"
          style="height: 40px; width: 300px"
        />
        <script>
          function filterNhanVien() {
            const nameInput = document.getElementById("searchInput").value.toLowerCase();
            const pbInput = document.getElementById("searchPB").value.toLowerCase();
            const table = document.getElementById("nhanVienTable");
            const rows = table.getElementsByTagName("tr");

            for (let i = 1; i < rows.length; i++) {
              // B·ªè qua h√†ng ti√™u ƒë·ªÅ
              const row = rows[i];
              const nameCell = row.cells[2]; // C·ªôt t√™n nh√¢n vi√™n
              const pbCell = row.cells[4]; // C·ªôt m√£ ph√≤ng ban

              const nameMatch = nameCell && nameCell.textContent.toLowerCase().includes(nameInput);
              const pbMatch = pbCell && pbCell.textContent.toLowerCase().includes(pbInput);

              // Hi·ªÉn th·ªã h√†ng n·∫øu c·∫£ hai ƒëi·ªÅu ki·ªán ƒë·ªÅu kh·ªõp
              row.style.display = nameMatch && pbMatch ? "" : "none";
            }
          }

          // G·∫Øn s·ª± ki·ªán `keyup` cho c·∫£ hai √¥ input
          document.getElementById("searchInput").addEventListener("keyup", filterNhanVien);
          document.getElementById("searchPB").addEventListener("keyup", filterNhanVien);
        </script>
      </div>
      <div class="pb-3">
        <table id="nhanVienTable" class="table table-bordered">
          <thead>
            <tr>
              <th>STT</th>
              <th>M√£ nh√¢n vi√™n</th>
              <th>T√™n nh√¢n vi√™n</th>
              <th>Gi·ªõi t√≠nh</th>
              <th>M√£ Ph√≤ng ban</th>
              <th>T√™n ph√≤ng ban</th>
              <th>Ch·ª©c v·ª•</th>
              <th>% mi·ªÖn gi·∫£m</th>
              <th>B·ªô m√¥n</th>
              <th>ƒêi·ªán tho·∫°i</th>
              <th>CCCD</th>
              <th>Ng√†y c·∫•p CCCD</th>
              <th>N∆°i c·∫•p CCCD</th>
              <th>H·ªçc v·ªã</th>
              <th>T√™n ƒëƒÉng nh·∫≠p</th>
              <th>H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody class="nhanVien" id="data-table-body">
            <% if (nhanvienLists && nhanvienLists.length > 0) { %> <% for (var i
            = 0; i < nhanvienLists.length; i++) { %>
            <tr class="nhanVien">
              <td><%= i+1 %></td>
              <td><%= nhanvienLists[i].MaNhanVien %></td>
              <!-- Hi·ªÉn th·ªã t√™n t√†i kho·∫£n -->
              <td><%= nhanvienLists[i].TenNhanVien %></td>
              <!-- Hi·ªÉn th·ªã email -->
              <td><%= nhanvienLists[i].GioiTinh %></td>
              <td><%= nhanvienLists[i].MaPhongBan %></td>
              <td><%= nhanvienLists[i].TenPhongBan %></td>
              <td><%= nhanvienLists[i].ChucVu %></td>
              <td><%= nhanvienLists[i].PhanTramMienGiam %></td>
              <td><%= nhanvienLists[i].MonGiangDayChinh %></td>
              <td><%= nhanvienLists[i].DienThoai %></td>
              <td><%= nhanvienLists[i].CCCD %></td>
              <% const options = { year: 'numeric', month: '2-digit', day:
              '2-digit' }; %>
              <td>
                <%= nhanvienLists[i].NgayCapCCCD ? new
                Date(nhanvienLists[i].NgayCapCCCD).toLocaleDateString('vi-VN',
                options) : '' %>
              </td>
              <td><%= nhanvienLists[i].NoiCapCCCD %></td>
              <td><%= nhanvienLists[i].HocVi %></td>
              <td><%= nhanvienLists[i].TenDangNhap %></td>
              <td class="d-flex" style="border: none">
                <button
                  class="action-button edit"
                  onclick="editNV(this, <%= parseInt(nhanvienLists[i].id_User) %>)"
                >
                  ‚úèÔ∏è
                </button>
                <button
                  class="action-button view"
                  onclick="viewNV(this, <%= parseInt(nhanvienLists[i].id_User) %>)"
                >
                  üëÅÔ∏è
                </button>
              </td>
            </tr>
            <% } %> <% } else { %>
            <tr>
              <td colspan="16">Kh√¥ng c√≥ t√†i kho·∫£n n√†o.</td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Script x·ª≠ l√Ω checkbox -->
    <!-- <script>
      document.addEventListener("DOMContentLoaded", function () {
        const selectAllCheckbox = document.getElementById("selectAll");
        const rowCheckboxes = document.querySelectorAll(".row-checkbox");

        selectAllCheckbox.addEventListener("change", function () {
          rowCheckboxes.forEach((checkbox) => {
            checkbox.checked = selectAllCheckbox.checked;
          });
        });

        rowCheckboxes.forEach((checkbox) => {
          checkbox.addEventListener("change", function () {
            selectAllCheckbox.checked = Array.from(rowCheckboxes).every(
              (cb) => cb.checked
            );
          });
        });
      });
    </script> -->
    <script>
      function editNV(button, index) {
        hre = "/updateNV/" + index;
        window.location.href = hre;
      }
      function viewNV(button, index) {
        hre = "/viewNV/" + index;
        window.location.href = hre;
      }
    </script>
    <script>
      document
        .getElementById("changePasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

          if (tenDangNhap) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
            window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(
              tenDangNhap
            )}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
          }
        });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('message') === 'insertSuccess') {
          Swal.fire({
            title: "Th√¥ng b√°o",
            html: "C·∫≠p nh·∫≠t th√¥ng tin nh√¢n vi√™n th√†nh c√¥ng",
            icon: "success",
            confirmButtonText: "OK",
            width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
        } else if (urlParams.get('message') === 'insertFalse') {
          Swal.fire({
            title: "Th√¥ng b√°o",
            html: "C·∫≠p nh·∫≠t th√¥ng tin nh√¢n vi√™n th·∫•t b·∫°i!",
            icon: "error",
            confirmButtonText: "OK",
            width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
        }
      })
    </script>
  </body>
</html>
