<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
  <link rel="stylesheet" href="/css/table.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/css/import.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
</head>
<style>
  .btn {
    height: 45px;
    margin-bottom: 0px;
    text-wrap: nowrap;
  }

  /* Css ph·∫ßn suggestion */
  .suggestions {
    position: absolute;
    /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m b√™n tr√™n c√°c th√†nh ph·∫ßn kh√°c */
    top: calc(100% + 5px);
    /* ƒê·∫∑t g·ª£i √Ω ph√≠a tr√™n input v·ªõi m·ªôt kho·∫£ng c√°ch */
    font-size: 12px;
    left: 0;
    background-color: #f0f0f0;
    color: #000;
    border: 1px solid #ccc;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m tr√™n c√°c th√†nh ph·∫ßn kh√°c */
    border-radius: 4px;
    max-height: 300px;
    overflow-y: auto;
  }

  /* Hi·ªáu ·ª©ng lung linh khi hover */
  .suggestions:hover {
    background-color: #e0e0e0;
    /* Thay ƒë·ªïi m√†u n·ªÅn khi hover */
    box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
    /* TƒÉng ƒë·ªô b√≥ng khi hover */
  }


  /* CSS cho t·ª´ng m·ª•c g·ª£i √Ω */
  .suggestion-item {
    padding: 8px 12px;
    /* Kho·∫£ng c√°ch b√™n trong t·ª´ng m·ª•c */
    cursor: pointer;
    /* Con tr·ªè chu·ªôt thay ƒë·ªïi khi hover */
    transition: background-color 0.2s ease;
    /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† khi hover */
  }

  /* Hi·ªáu ·ª©ng khi ng∆∞·ªùi d√πng di chu·ªôt v√†o m·ª•c g·ª£i √Ω */
  .suggestion-item:hover {
    background-color: #f0f0f0;
    /* M√†u n·ªÅn khi hover */
  }

  /* ƒê·∫∑t l·∫°i m·ªôt s·ªë thu·ªôc t√≠nh khi input m·∫•t focus */
  input:focus+.suggestions {
    display: block;
    /* ƒê·∫£m b·∫£o khung hi·ªÉn th·ªã khi input ƒë∆∞·ª£c focus */
  }

  /* ƒê·∫£m b·∫£o container g·ª£i √Ω kh√¥ng b·ªã tr√†n ra ngo√†i khung n·∫øu c√≥ */
  .suggestions {
    overflow: hidden;
  }

  /* Ph·∫ßn ng√†y b·∫Øt ƒë·∫ßu, ng√†y k·∫øt th√∫c */
  .input-group-group {
  display: flex;
  align-items: center;
  gap: 16px; /* Kho·∫£ng c√°ch gi·ªØa hai √¥ */
  width: fit-content; /* Ch·ªâ chi·∫øm kh√¥ng gian theo n·ªôi dung */
  }

  .input-group {
    display: flex;
    align-items: center;
    border: 1px solid #ccc; /* ƒê∆∞·ªùng vi·ªÅn */
    border-radius: 8px; /* G√≥c bo */
    padding: 5px; /* Kho·∫£ng c√°ch trong */
    background-color: #42c2f5; /* M√†u n·ªÅn nh·∫°t */
    width: 350px; /* Chi·ªÅu r·ªông t·ª´ng √¥ */
  }

  .input-group-text {
    font-weight: bold;
    background-color: transparent; /* N·ªÅn trong su·ªët */
    border: none; /* Lo·∫°i b·ªè vi·ªÅn */
  }

  .form-control {
    border: none;
    outline: none; /* B·ªè vi·ªÅn focus m·∫∑c ƒë·ªãnh */
    width: 100%; /* Chi·∫øm h·∫øt kh√¥ng gian c√≤n l·∫°i */
  }

  /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·∫£ input[type="date"] v√† input[type="text"] */
  input[type="date"],
  input[type="text"] {
    width: 120px;
    /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y theo mong mu·ªën */
    box-sizing: border-box;
    padding: 5px;
    /* Gi·ªØ padding nh∆∞ c≈© */
  }

</style>

<body>
  <!-- Ph·∫ßn tr√™n c·ªßa navbar ch·ª©a logo v√† ti√™u ƒë·ªÅ -->

  <nav class="navbar-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <img src="/Logo-Hoc-Vien-Ky-Thuat-Mat-Ma-ACTVN.webp" alt="Logo" />
        <div class="navbar-title">
          <img src="/dongchu_banner.png" alt="banner" />
        </div>
      </a>
    </div>
  </nav>

  <!-- Ph·∫ßn d∆∞·ªõi c·ªßa navbar ch·ª©a c√°c m·ª•c n·∫±m ngang -->

  <nav class="navbar navbar-expand-lg navbar-bottom sticky-top">
    <div class="" style="width: 100%">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" style="width: 100%" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" id="Home" href=""><i class="fa-solid fa-house"></i></a>
          </li>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Gi·∫£ng Vi√™n M·ªùi
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" href="/gvmList">Danh s√°ch gi·∫£ng vi√™n m·ªùi</a>
                <a class="nav-link" id="actionButton1" href="/importGvmList" style="width: 100%;">Th√™m gi·∫£ng vi√™n m·ªùi
                  b·∫±ng file</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                B·∫£ng Quy Chu·∫©n
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link active" href="/import" id="actionButton2" style="width: 100%;">Th√™m file quy
                  chu·∫©n</a>
                <a class="nav-link" href="/tableTam">B·∫£ng quy chu·∫©n d·ª± ki·∫øn</a>
                <a class="nav-link" href="/tableQC">B·∫£ng quy chu·∫©n ch√≠nh th·ª©c</a>
                <a class="nav-link" id="ThongTinGD" href="">Th√¥ng tin gi·∫£ng vi√™n theo l·ªõp</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                M·ªùi Gi·∫£ng
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" href="/xemCacLopGvm">Xem c√°c l·ªõp m·ªùi</a>

                <a class="nav-link" href="/classInfoGvm">Th√¥ng tin l·ªõp gi·∫£ng vi√™n m·ªùi</a>
                <a class="nav-link" href="/hopDongDuKien" role="button">H·ª£p ƒë·ªìng d·ª± ki·∫øn</a>
                <a class="nav-link" href="/infoHDGvm" role="button">Th√¥ng tin h·ª£p ƒë·ªìng</a>
                <li class="nav-item"></li>
                <a class="nav-link " href="/phuLucHD">Ph·ª• l·ª•c h·ª£p ƒë·ªìng</a>
                </li>
                <a class="nav-link " href="/exportHD">H·ª£p ƒê·ªìng</a>
                <a class="nav-link" id="suaHD" style="display: none;" href="/suaHD">S·ª≠a Th√¥ng Tin H·ª£p ƒê·ªìng</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                V∆∞·ª£t Gi·ªù
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="/infoclassvuotgio">Th√¥ng tin l·ªõp v∆∞·ª£t gi·ªù c·ªßa t√¥i</a>
                <a class="nav-link" id="" href="/addclass">Th√™m l·ªõp gi·∫£ng d·∫°y</a>
                <a class="nav-link" id="" href="/addclassgiuaky">Th√™m l·ªõp ki·ªÉm tra gi·ªØa k·ª≥</a>
                <a class="nav-link" id="actionButton3" href="/duyetgk">Duy·ªát c√°c l·ªõp gi·ªØa k√¨</a>
                <a class="nav-link" id="" href="/vuotGioExport">Xu·∫•t th√¥ng tin v∆∞·ª£t gi·ªù</a>              

              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Nghi√™n C·ª©u Khoa H·ªçc
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="#">COMING SOON</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle active" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                ƒê·ªì √Ån
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="importDoAn" style="display: none;" href="/importDoAn">Import ƒë·ªì √°n</a>
                <a class="nav-link" id="" href="/getVuotGioDoAnDuKienSite">ƒê·ªì √°n d·ª± ki·∫øn</a>
                <a class="nav-link" id="" href="/doAnChinhThuc">ƒê·ªì √°n t·ªët nghi·ªáp</a>
                <a class="nav-link" id="" href="/doAnHopDongDuKienSite">H·ª£p ƒë·ªìng d·ª± ki·∫øn</a>
                <a class="nav-link" id="" href="/exportPhuLucDA">Ph·ª• l·ª•c ƒë·ªì √°n</a>
                <a class="nav-link " id="" href="/hopDongDA">H·ª£p ƒë·ªìng ƒë·ªì √°n</a>
              </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                Th·ªëng K√™
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <div class="dropdown-submenu">
                  <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownTeaching" data-bs-toggle="dropdown" aria-expanded="false">Gi·∫£ng D·∫°y</a>
                  <div class="dropdown-menu1" aria-labelledby="navbarDropdownTeaching">
                    <a class="dropdown-item1" href="/ThongkeMG">M·ªùi Gi·∫£ng</a>
                    <a class="dropdown-item1" href="/thongkevuotgio">V∆∞·ª£t Gi·ªù</a>
                    <a class="dropdown-item1" href="/thongketonghop">T·ªïng h·ª£p</a>
                  </div>
                </div>
                <a class="nav-link" id="" href="/thongkedoan">ƒê·ªì √Ån</a>
                <a class="nav-link" id="" href="/thongkenckh">Nghi√™n c·ª©u khoa h·ªçc</a>
              </div>
            </div>
          </div>
          <div class="navbar-nav">
            <div class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownUser" data-bs-toggle="dropdown"
                aria-expanded="false">
                H·ªá Th·ªëng
              </a>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="nav-link" id="" href="log">Xem File Log</a>
              </div>
            </div>
          </div>
        </ul>
        <div class="navbar-nav">
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle fullname" href="/login" id="navbarDropdownUser" data-bs-toggle="dropdown"
              aria-expanded="false">
              Hi, L√™ ƒê·ª©c Thu·∫≠n
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <a class="dropdown-item"id="infome">Th√¥ng tin c√° nh√¢n</a>
              <a class="dropdown-item" id="changePasswordLink">ƒê·ªïi m·∫≠t kh·∫©u</a>
                <a class="dropdown-item" id="changeMessage">Th√™m th√¥ng b√°o</a>
              <a class="dropdown-item" href="/">ƒêƒÉng xu·∫•t</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid m-4 box d-flex justify-content-start">
    <div class="mx-2">
      <div class="d-flex align-items-center mb-3">
        <input type="file" id="fileInput" accept=".pdf, .docx" style="display: none;" />

        <!-- Combo ch·ªçn ƒë·ª£t -->
        <select class="selectop w-100px mx-1 " id="combobox-dot">
          <option value="">ƒê·ª£t</option>
        </select>

        <!-- Combo box NƒÉm -->
        <select class="selectop mx-1" id="NamHoc">
          <option value="">Ch·ªçn nƒÉm h·ªçc</option>
        </select>

        <!-- Combo box v·ªõi c√°c gi√° tr·ªã CNTT, ATTT, DTVT -->
        <select class=" selectop" id="MaPhongBan">
          <option value="">Khoa</option>
        </select>

        <button id="infoDoAn" class="btn text-nowrap mx-2">Hi·ªÉn th·ªã</button>
        <button class="btn mx-2" id="updateDoAn">C·∫≠p nh·∫≠t</button>

        <button class="btn mx-2 ms-auto" id="saveDataDoAn" style="display: none; height: 45px;">
          L∆∞u d·ªØ li·ªáu h·ª£p ƒë·ªìng
        </button>

      </div>

      <div class="d-flex my-3" style="height: 70px;">
        <input type="text" id="filterName" placeholder="T√¨m theo t√™n sinh vi√™n" class="form-control m-2 search"
          style="width: 200px;" />
        <input type="text" id="filterClass" placeholder="T√¨m theo t√™n ƒë·ªÅ t√†i" class="form-control m-2 search"
          style="width: 200px;" />

            <div class="date-all-container" style="display: none;">
              <div class="input-group my-2 mx-1" style="width: 350px;" id="batdau">
                <label for="startDateAll" class="input-group-text">Ng√†y b·∫Øt ƒë·∫ßu</label>
                <input required type="date" id="startDateAll" class="form-control" />
              </div>
              <div class="input-group my-2 mx-1" style="width: 350px;" id="ketthuc">
        
                <label for="endDateAll" class="input-group-text">Ng√†y k·∫øt th√∫c</label>
                <input required type="date" id="endDateAll" class="form-control" />
              </div>
              <button id="fillDay" class="btn text-nowrap my-2 mx-1" style="height: 54px;">Ch√®n ng√†y</button> 
            </div>     
          
      </div>


      <div id="renderInfo">
        <table class="text-center">
          <thead>
            <tr>
              <th style="width: 30px;">TT</th>
              <th style="width: 200px;">Sinh Vi√™n</th>
              <th style="width: 100px;">M√£ SV</th>
              <th style="width: 50px;">Khoa</th>
              <th style="width: 400px;">T√™n ƒë·ªÅ t√†i</th>
              <th style="width: 200px;">Gi·∫£ng Vi√™n H∆∞·ªõng D·∫´n</th>
              <th style="width: 200px;">Gi·∫£ng Vi√™n H∆∞·ªõng D·∫´n 1</th>
              <th style="width: 200px;">Gi·∫£ng Vi√™n H∆∞·ªõng D·∫´n 2</th>
              <th style="min-width: 90px;">Ng√†y b·∫Øt ƒë·∫ßu</th>
              <th style="min-width: 90px;">Ng√†y k·∫øt th√∫c</th>
              <th style="width: 50px;">Ghi ch√∫</th>
              <th style="width: 80px; " id="khoaColumn">
                <div class="form-check d-flex ">
                  <input class="check" type="checkbox" id="checkAllKhoa" onclick="checkAll('khoa')">
                  <label class="form-check-label" for="checkAllKhoa">Khoa</label>
                </div>
              </th>
              <th style="width: 50px;" id="daoTaoColumn">
                <div class="form-check d-flex">
                  <input class="check" type="checkbox" id="checkAllDaoTao" onclick="checkAll('daoTao')">
                  <label class="form-check-label text-nowrap" for="checkAllDaoTao">ƒê√†o T·∫°o</label>
                </div>
              </th>
              <th style="width: 50px;" id="taiChinhColumn">
                <div class="form-check d-flex">
                  <input class="check" type="checkbox" id="checkAllTaiChinh" onclick="checkAll('taiChinh')">
                  <label class="form-check-label text-nowrap" for="checkAllTaiChinh">T√†i Ch√≠nh</label>
                </div>
              </th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td id="ankhoa"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div id="dataTableContainer" class="h-75"></div>
        <!-- Modal form -->
  <div id="modalBackdrop" style="display: none;"></div> <!-- N·ªÅn t·ªëi -->
  <div id="noteForm" style="display: none;">
    <h3>Ghi ch√∫</h3>
    <label for="noteInput">N·ªôi dung:</label>
    <textarea id="noteInput"></textarea> <!-- S·ª≠ d·ª•ng textarea cho ghi ch√∫ d√†i -->
    <br />
    <label for="deadlineInput">H·∫°n:</label>
    <input type="date" id="deadlineInput"
      style="width: 100%; padding: 5px; border: 1px solid #ccc; border-radius: 4px;" />
    <br />
    <div class="d-flex text-nowrap" style="text-align: right;">
      <button onclick="saveNote()">L∆∞u</button>
      <button onclick="doneNote()">Ho√†n Th√†nh</button>
      <button class="cancel" onclick="closeNoteForm()">ƒê√≥ng</button>
    </div>
  </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Link script Sweet alert 2 -->
  <!-- SweetAlert2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css" rel="stylesheet">

  <!-- SweetAlert2 JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const isKhoa = localStorage.getItem("isKhoa");
      const role = localStorage.getItem("userRole");

      // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
      const actionButton = document.getElementById('actionButton');
      const actionButton1 = document.getElementById('actionButton1');
      const actionButton2 = document.getElementById('actionButton2');
      const actionButton3 = document.getElementById('actionButton3');

      if (isKhoa == 0) {
        actionButton1.style.display = 'none'; // ·∫®n actionButton1 n·∫øu isKhoa = 0
        actionButton2.style.display = 'inline-block'; // Hi·ªán actionButton2

      } else {
        actionButton1.style.display = 'inline-block'; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
        actionButton2.style.display = 'none'; // ·∫®n actionButton2
        if (role.toLowerCase() == 'gv'){
          actionButton1.style.display = 'none'; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
        }
      }
      //·∫®n site duy·ªát l·ªõp gk
        if (role === "L√£nh ƒë·∫°o khoa" || role === "Duy·ªát") {
          actionButton3.style.display = '';
        } else {
          actionButton3.style.display = 'none';
        }
    });
  </script>

<script>
  var globalData = [];

    document.addEventListener('DOMContentLoaded', function () {
        const button = document.getElementById('infoDoAn');

        // G·ªçi h√†m hi·ªÉn th·ªã th√¥ng tin
        button.addEventListener('click', function () {
          loadData();
        });

        async function loadData() {
            const isKhoa = localStorage.getItem("isKhoa");
            const MaKhoaHienTai = localStorage.getItem("MaPhongBan");
        
            try {
              let Dot = document.getElementById("combobox-dot").value;
              let NamHoc = document.getElementById("NamHoc").value;
              let MaPhongBan = document.getElementById("MaPhongBan").value;
        
              if (isKhoa == 1){
                MaPhongBan = MaKhoaHienTai;
              }
              // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
              const requestData = {
                Dot: Dot,
                NamHoc: NamHoc,
                MaPhongBan: MaPhongBan,
              };
        
        
              // Fetch t√™n gi·∫£ng vi√™n m·ªùi
              const [infoGiangVienResponse, checkAllResponse, infoDoAnResponse] = await Promise.all([
                fetch('/getInfoGiangVien'),
                fetch(`/getCheckAllDoantotnghiep`, {
                  method: 'POST', // S·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c POST
                  headers: {
                    'Content-Type': 'application/json', // ƒê·∫∑t Content-Type l√† application/json
                  },
                  body: JSON.stringify(requestData), // Chuy·ªÉn ƒë·ªïi ƒë·ªëi t∆∞·ª£ng th√†nh chu·ªói JSON
                }),
                fetch('/getInfoDoAn', {
                  method: 'POST', // S·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c POST
                  headers: {
                    'Content-Type': 'application/json', // ƒê·∫∑t Content-Type l√† application/json
                  },
                  body: JSON.stringify(requestData), // Chuy·ªÉn ƒë·ªïi ƒë·ªëi t∆∞·ª£ng th√†nh chu·ªói JSON
                }),
              ]);
        
        
              if (!infoDoAnResponse.ok || !infoGiangVienResponse.ok) {
                Swal.fire({
                  title: 'Th√¥ng b√°o',
                  html: "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
                  icon: 'success',
                  confirmButtonText: 'OK',
                  width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              } 
        
              const infoDoAn = await infoDoAnResponse.json();
              const infoGiangVien = await infoGiangVienResponse.json();
              const checkAll = await checkAllResponse.json();

              //
              localStorage.setItem("KhoaCheck", JSON.stringify(checkAll.KhoaCheck));
              localStorage.setItem("DaoTaoCheck", JSON.stringify(checkAll.DaoTaoCheck));
              localStorage.setItem("TaiChinhCheck", JSON.stringify(checkAll.TaiChinhCheck));
        
              globalData = infoDoAn;
              localStorage.setItem("tableData", JSON.stringify(infoDoAn));
              localStorage.setItem("allGV", JSON.stringify(infoGiangVien.data.allGV));
              localStorage.setItem("duplicateGV", JSON.stringify(infoGiangVien.data.duplicateGV));
        
              renderTable(globalData); // G·ªçi h√†m renderTable sau khi ƒë√£ c√≥ ƒë·ªß d·ªØ li·ªáu
        
        
            } catch (error) {
              console.error('ƒê√£ c√≥ l·ªói x·∫£y ra:', error);
            }
          }
        

    });

    // H√†m l·ªçc th√¥ng tin trong b·∫£ng
    function filterTable() {
      const nameFilter = document.getElementById('filterName').value.toLowerCase();
      const classFilter = document.getElementById('filterClass').value.toLowerCase();

      const tableRows = document.querySelectorAll('#tableBody tr');

      tableRows.forEach(row => {
        const nameCell = row.querySelector('td:nth-child(2)'); // C·ªôt t√™n sinh vi√™n
        const classCell = row.querySelector('td:nth-child(5)'); // C·ªôt t√™n ƒë·ªÅ t√†i

        const name = nameCell ? nameCell.textContent.toLowerCase() : '';
        const className = classCell ? classCell.textContent.toLowerCase() : '';

        // Ki·ªÉm tra ƒëi·ªÅu ki·ªán l·ªçc
        const matchesName = name.includes(nameFilter);
        const matchesClass = className.includes(classFilter);

        // Hi·ªán ho·∫∑c ·∫©n h√†ng d·ª±a tr√™n ƒëi·ªÅu ki·ªán l·ªçc
        if (matchesName && matchesClass) {
          row.style.display = ''; // Hi·ªán h√†ng n·∫øu t·∫•t c·∫£ c√°c ƒëi·ªÅu ki·ªán ƒë·ªÅu kh·ªõp
        } else {
          row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
        }
      });

      //calculateTotals(); // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt sau khi l·ªçc
    }

    // G√°n s·ª± ki·ªán cho c√°c input filter
    document.getElementById('filterName').addEventListener('input', filterTable);
    document.getElementById('filterClass').addEventListener('input', filterTable);

    // H√†m format l·∫°i Ng√†y ph√π h·ª£p v·ªõi m√∫i gi·ªù 
      // H√†m chuy·ªÉn ƒë·ªãnh d·∫°ng chu·ªói t·ª´ ISO sang ƒë·ªãnh d·∫°ng YYYY-MM-DD
    function formatDateToInput(dateString) {
      if (!dateString) return ''; // Ki·ªÉm tra n·∫øu kh√¥ng c√≥ gi√° tr·ªã

      const utcBatDau = new Date(dateString);
      dateString = utcBatDau.toLocaleDateString("vi-VN"); // Ch·ªâ l·∫•y ph·∫ßn ng√†y

      // Chia t√°ch chu·ªói ng√†y th√†nh c√°c ph·∫ßn: nƒÉm, th√°ng, ng√†y
      const parts = dateString.split('/'); // T√°ch theo d·∫•u '-'
      if (parts.length != 3) return ''; // ƒê·∫£m b·∫£o ƒë·ªãnh d·∫°ng ƒë√∫ng

      const year = parts[2];
      const month = ('0' + parts[1]).slice(-2); // ƒê·∫£m b·∫£o th√°ng c√≥ 2 ch·ªØ s·ªë
      const day = ('0' + parts[0]).slice(-2); // ƒê·∫£m b·∫£o ng√†y c√≥ 2 ch·ªØ s·ªë

      // Tr·∫£ v·ªÅ chu·ªói ng√†y theo ƒë·ªãnh d·∫°ng "YYYY-MM-DD"
      return `${year}-${month}-${day}`;
    }

    function addDoubleClickEvents() {
      // get all date input fields
      let dateInputs = document.querySelectorAll('[type="date"]');
  
      dateInputs.forEach(el => {
        // register double-click event to change date input to text input and select the value
        el.addEventListener('dblclick', () => {
          el.type = "text";
  
          // After changing input type with JS, .select() needs a timeout to work
          setTimeout(() => {
            el.select();
          });
        });
  
        // register the focusout event to reset the input back to a date input field
        el.addEventListener('focusout', () => {
          el.type = "date";
        });
      });
    }
  

    // H√†m hi·ªÉn th·ªã th√¥ng tin ra m√†n h√¨nh
      function renderTable(data) {
        const role = localStorage.getItem("userRole");
        const MaPhongBan = localStorage.getItem("MaPhongBan")
        const isKhoa = localStorage.getItem("isKhoa");
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©

        // id truy·ªÅn v√†o ƒë·ªÉ ƒë√°nh d·∫•u m·ªói d√≤ng, m·ª•c ƒë√≠ch l·∫•y ph·∫ßn t·ª≠ v√† so s√°nh v·ªõi b·∫£ng trong localStorage
        data.forEach((row, id) => {
          const tableRow = document.createElement('tr');
          // G√°n ID trong csdl th√†nh attribute c·ªßa t·ª´ng h√†ng
          tableRow.setAttribute("data-id", row.ID);

          // TT
          const ttTd = document.createElement('td');
          ttTd.textContent = `${row.TT}` || '';
          tableRow.appendChild(ttTd);

          // Sinh Vi√™n
          const sinhVienTd = document.createElement('td');
          sinhVienTd.textContent = row.SinhVien || '';
          tableRow.appendChild(sinhVienTd);

          // M√£ SV
          const maSVTd = document.createElement('td');
          maSVTd.textContent = row.MaSV || '';
          tableRow.appendChild(maSVTd);

          // T·∫°o c·ªôt Khoa ƒë·ªÉ ki·ªÉm tra check
          const MaPhongBanTd = document.createElement('td');
          MaPhongBanTd.textContent = row.MaPhongBan || ''; // L·∫•y gi√° tr·ªã Khoa tr·ª±c ti·∫øp t·ª´ row
          tableRow.appendChild(MaPhongBanTd);

          // T√™n ƒë·ªÅ t√†i
          const tenDeTaiTd = document.createElement('td');
          tenDeTaiTd.textContent = row.TenDeTai || '';
          tableRow.appendChild(tenDeTaiTd);

          // Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n
          const giangVienTd = document.createElement('td');

          // Thay th·∫ø xu·ªëng d√≤ng (\n) b·∫±ng th·∫ª <br> v√† g√°n v√†o innerHTML
          giangVienTd.innerHTML = (row.GiangVienDefault || '').replace(/\n/g, '<br>');

          tableRow.appendChild(giangVienTd);


          // Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n 1
          const giaoVienHuongDan1Td = document.createElement('td');
          const giaoVienHuongDan1Input = document.createElement('input');
          giaoVienHuongDan1Input.type = 'text';
          giaoVienHuongDan1Input.placeholder = 'Nh·∫≠p t√™n gi·∫£ng vi√™n 1';
          giaoVienHuongDan1Input.value = row.GiangVien1 || '';
          // G√°n id cho input
          giaoVienHuongDan1Input.id = `GiangVien1-${id}`;

          giaoVienHuongDan1Td.appendChild(giaoVienHuongDan1Input);
          tableRow.appendChild(giaoVienHuongDan1Td);
          giaoVienHuongDan1Input.onclick = () => {
            showSuggestions(giaoVienHuongDan1Input, row.GiangVien1Real, 1, row.ID, id);
          };

          giaoVienHuongDan1Td.oninput = () => {
            showSuggestions(giaoVienHuongDan1Input, row.GiangVien1Real, 1, row.ID, id);
          };

          giaoVienHuongDan1Td.appendChild(giaoVienHuongDan1Input);
          tableRow.appendChild(giaoVienHuongDan1Td);

          // Gi·∫£ng vi√™n h∆∞·ªõng d·∫´n 2

          const giaoVienHuongDan2Td = document.createElement('td');
          const giaoVienHuongDan2Input = document.createElement('input');
          giaoVienHuongDan2Input.type = 'text';
          giaoVienHuongDan2Input.placeholder = 'Nh·∫≠p t√™n gi·∫£ng vi√™n 2';
          giaoVienHuongDan2Input.value = row.GiangVien2 || '';
          // G√°n id cho input
          giaoVienHuongDan2Input.id = `GiangVien2-${id}`;

          giaoVienHuongDan2Td.appendChild(giaoVienHuongDan2Input);
          tableRow.appendChild(giaoVienHuongDan2Td);
          giaoVienHuongDan2Input.onclick = () => {
            showSuggestions(giaoVienHuongDan2Input, row.GiangVien2Real, 2,row.ID, id);
          };

          giaoVienHuongDan2Td.oninput = () => {
            showSuggestions(giaoVienHuongDan2Input, row.GiangVien2Real, 2,row.ID, id);
          };

          giaoVienHuongDan2Td.appendChild(giaoVienHuongDan2Input);
          tableRow.appendChild(giaoVienHuongDan2Td);

          // T·∫°o 2 c·ªôt l∆∞u t√™n gi·∫£ng vi√™n ƒë·ªÉ so s√°nh
          const GiangVien1Real = document.createElement('td');
          GiangVien1Real.textContent = row.GiangVien1Real || '';
          GiangVien1Real.id = `GiangVien1Real-${id}`;
          GiangVien1Real.style.display = 'none'; // ·∫®n input b·∫±ng CSS
          tableRow.appendChild(GiangVien1Real);

          const GiangVien2Real = document.createElement('td');
          GiangVien2Real.textContent = row.GiangVien2Real || '';
          GiangVien2Real.id = `GiangVien2Real-${id}`;
          GiangVien2Real.style.display = 'none'; // ·∫®n input b·∫±ng CSS
          tableRow.appendChild(GiangVien2Real);

          // Ng√†y B·∫Øt ƒê·∫ßu
          
          const NgayBatDauTd = document.createElement('td');
          const NgayBatDauInput = document.createElement('input');
          NgayBatDauInput.type = 'date';
          NgayBatDauInput.id = `NgayBatDau-${id}`; // Th√™m id
          NgayBatDauInput.value = formatDateToInput(row.NgayBatDau);
          NgayBatDauTd.appendChild(NgayBatDauInput);
          tableRow.appendChild(NgayBatDauTd);

          // Ng√†y K·∫øt Th√∫c
          const NgayKetThucTd = document.createElement('td');
          const NgayKetThucInput = document.createElement('input');
          NgayKetThucInput.type = 'date';
          NgayKetThucInput.id = `NgayKetThuc-${id}`; // Th√™m id
          NgayKetThucInput.value = formatDateToInput(row.NgayKetThuc);
          NgayKetThucTd.appendChild(NgayKetThucInput);
          tableRow.appendChild(NgayKetThucTd);

          // Ghi ch√∫
          const ghiChuTd = document.createElement("td");
          const ghiChuValue = row.GhiChu && row.GhiChu.trim() !== "" ? row.GhiChu : false;
          const deadlineValue = row.Deadline || ""; // L·∫•y gi√° tr·ªã Deadline
          const hoanThanh = row.HoanThanh;
          if (role === 'GV' || role === 'Th∆∞·ªùng') {
            ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu role l√† GV ho·∫∑c Th∆∞·ªùng
            ghiChuTd.style.cursor = "not-allowed"; // Thay ƒë·ªïi con tr·ªè chu·ªôt th√†nh 'not-allowed' ƒë·ªÉ b√°o hi·ªáu kh√¥ng th·ªÉ t∆∞∆°ng t√°c
            ghiChuTd.title = "B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p"; // Th√™m tooltip ƒë·ªÉ gi·∫£i th√≠ch l√Ω do kh√¥ng th·ªÉ nh·∫•n
          } else {

            if (ghiChuValue) {
              if (hoanThanh) {
                ghiChuTd.innerHTML = `üìú <span class="bi bi-check2-circle" style="color: green;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
              } else {
                ghiChuTd.innerHTML = `üìú <span class="bi bi-circle" style="color: red;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
              }

            } else {
              ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu kh√¥ng c√≥ ghi ch√∫
            }
            ghiChuTd.style.cursor = "pointer"; // Thay ƒë·ªïi con tr·ªè chu·ªôt khi di chu·ªôt qua bi·ªÉu t∆∞·ª£ng
            ghiChuTd.onclick = () => openNoteForm(tableRow, ghiChuValue, deadlineValue); // G·ªçi h√†m m·ªü form khi nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng
          }
          tableRow.appendChild(ghiChuTd); // Th√™m √¥ ghi ch√∫ v√†o h√†ng

          let khoaCheckboxTd, khoaCheckbox;
          // Checkbox cho Khoa
          khoaCheckboxTd = document.createElement('td');
          khoaCheckbox = document.createElement('input');
          khoaCheckbox.type = 'checkbox';
          khoaCheckbox.style.marginLeft = '30px';
          khoaCheckbox.name = 'khoa'; // Th√™m thu·ªôc t√≠nh name
          khoaCheckbox.checked = row.KhoaDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          khoaCheckbox.onchange = () => updateCheckAll('khoa'); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          khoaCheckboxTd.appendChild(khoaCheckbox);
          tableRow.appendChild(khoaCheckboxTd);
          // ·∫©n ƒëi 
          khoaCheckbox.style.display = "none";
    
          let daoTaoCheckboxTd, daoTaoCheckbox;
    
          // Checkbox cho ƒê√†o T·∫°o
          daoTaoCheckboxTd = document.createElement('td');
          daoTaoCheckbox = document.createElement('input');
          daoTaoCheckbox.type = 'checkbox';
          daoTaoCheckbox.style.marginLeft = '30px';
          daoTaoCheckbox.name = 'daoTao'; // Th√™m thu·ªôc t√≠nh name
          daoTaoCheckbox.checked = row.DaoTaoDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          daoTaoCheckbox.onchange = () => updateCheckAll('daoTao'); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          daoTaoCheckboxTd.appendChild(daoTaoCheckbox);
          tableRow.appendChild(daoTaoCheckboxTd);
          // ·∫©n ƒëi 
          daoTaoCheckbox.style.display = "none";
    
          // Checkbox t√†i ch√≠nh
          let taiChinhCheckboxTd, taiChinhCheckbox;
    
          taiChinhCheckboxTd = document.createElement('td');
          taiChinhCheckbox = document.createElement('input');
          taiChinhCheckbox.type = 'checkbox';
          taiChinhCheckbox.style.marginLeft = '30px';
          taiChinhCheckbox.name = 'taiChinh'; // Th√™m thu·ªôc t√≠nh name
          taiChinhCheckbox.checked = row.TaiChinhDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          taiChinhCheckbox.onchange = () => updateCheckAll('taiChinh'); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          taiChinhCheckboxTd.appendChild(taiChinhCheckbox);
          tableRow.appendChild(taiChinhCheckboxTd);
          // ·∫®n ƒëi
          taiChinhCheckbox.style.display = "none";

          if (isKhoa == 1 && role == 'L√£nh ƒë·∫°o khoa') {
            khoaCheckbox.style.display = "block";
          } else if (isKhoa == 0 && role == 'Duy·ªát') {
            if (MaPhongBan == 'DAOTAO') {
              khoaCheckbox.style.display = "block";
    
              daoTaoCheckbox.style.display = "block";
              taiChinhCheckboxTd.style.display = "none";
            } else if (MaPhongBan == 'TAICHINH') {
              // Checkbox cho ƒê√†o T·∫°o
              daoTaoCheckbox.style.display = "block";
              khoaCheckboxTd.style.display = "none";
              // Checkbox cho T√†i Ch√≠nh
              taiChinhCheckbox.style.display = "block";
            }
          }

          // N·∫øu kh√¥ng ph·∫£i khoa -> kh√¥ng c√≥ quy·ªÅn nh·∫≠p

          if (isKhoa == 0) {
            giaoVienHuongDan1Input.disabled = true; // Ch·ªâ xem
            giaoVienHuongDan2Input.disabled = true; // Ch·ªâ xem
            NgayBatDauInput.disabled = true;
            NgayKetThucInput.disabled = true;
          }

          if ((isKhoa == 1 && role == "GV") || (isKhoa == 1 && row.KhoaDuyet == 1)) {
            giaoVienHuongDan1Input.disabled = true;
            giaoVienHuongDan2Input.disabled = true;
            NgayBatDauInput.disabled = true;
            NgayKetThucInput.disabled = true;
          }

          const KhoaCheck = localStorage.getItem("KhoaCheck");
          const DaoTaoCheck = localStorage.getItem("DaoTaoCheck");
          const TaiChinhCheck = localStorage.getItem("TaiChinhCheck");
          // Ph√¢n quy·ªÅn theo ph√≤ng ban
          if (isKhoa == 1) { // N·∫øu l√† khoa
            if (KhoaCheck.includes(MaPhongBan)) {
              //giaoVienGiangDayInput.disabled = true;
              giaoVienHuongDan1Input.disabled = true;
    
              giaoVienHuongDan2Input.disabled = true;
              khoaCheckbox.disabled = true;

              disableCheckAll('khoa');
    
            }
          }
    
          if (MaPhongBan.toLowerCase() === "daotao" && role.toLowerCase() !== "th∆∞·ªùng") {
            // N·∫øu khoa ƒë√£ check th√¨ hi·ªán check b√™n ƒë√†o t·∫°o
            if (!KhoaCheck.includes(row.MaPhongBan)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              khoaCheckbox.disabled = true
              daoTaoCheckbox.disabled = true
    
            }
    
            // N·∫øu ƒë√†o t·∫°o ƒë√£ check th√¨ disable check ƒë√†o t·∫°o
            if (DaoTaoCheck.includes(row.MaPhongBan)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              khoaCheckbox.disabled = true
              daoTaoCheckbox.disabled = true;
            }
          }
    
          if (MaPhongBan.toLowerCase() === "taichinh" && role.toLowerCase() !== "th∆∞·ªùng") {
            // N·∫øu khoa ƒë√£ check th√¨ hi·ªán check b√™n ƒë√†o t·∫°o
            if (!DaoTaoCheck.includes(row.MaPhongBan)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              daoTaoCheckbox.disabled = true
              taiChinhCheckbox.disabled = true;
            }
    
            // N·∫øu ƒë√†o t·∫°o ƒë√£ check th√¨ disable check ƒë√†o t·∫°o
            if (TaiChinhCheck.includes(row.MaPhongBan)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              daoTaoCheckbox.disabled = true
              taiChinhCheckbox.disabled = true;
            }
          }

          // Th√™m h√†ng v√†o body c·ªßa b·∫£ng
          tableBody.appendChild(tableRow);
        });
      
        // Th√™m ƒë·ªÉ chuy·ªÉn ki·ªÉu d·ªØ li·ªáu ng√†y th√†nh text khi double click v√†o
        addDoubleClickEvents();
      }

        // Fill all startDate and endDate
  document.getElementById('fillDay').addEventListener('click', function () {
    const startDateValue = document.getElementById('startDateAll').value;
    const endDateValue = document.getElementById('endDateAll').value;

    // Ch·ªâ ti·∫øp t·ª•c n·∫øu ng∆∞·ªùi d√πng ƒë√£ ch·ªçn c·∫£ ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c
    if (!startDateValue || !endDateValue) {
      Swal.fire({
        title: 'Th√¥ng b√°o',
        html: "Vui l√≤ng ch·ªçn c·∫£ ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c.",
        icon: 'info',
        confirmButtonText: 'OK',
        width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
        padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
      });
      return;
    }

    // Ch√®n ng√†y b·∫Øt ƒë·∫ßu, b·ªè qua c√°c √¥ b·ªã disable
    document.querySelectorAll("input[id^='NgayBatDau-']").forEach(input => {
      if (!input.disabled && input.offsetParent !== null) {
        input.value = startDateValue;
      }
    });

    // Ch√®n ng√†y k·∫øt th√∫c, b·ªè qua c√°c √¥ b·ªã disable
    document.querySelectorAll("input[id^='NgayKetThuc-']").forEach(input => {
      if (!input.disabled && input.offsetParent !== null) {
        input.value = endDateValue;
      }
    });

    let data = getDataToStored();

    fetch('/updateDoAnDateAll', {
      method: 'POST', // Ph∆∞∆°ng th·ª©c POST
      headers: {
        'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
      },
      body: JSON.stringify(data) // Chuy·ªÉn ƒë·ªïi data ƒë√£ c·∫≠p nh·∫≠t th√†nh chu·ªói JSON
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
        }
        return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
      })
      .then(data => {
        // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: data.message,
          icon: 'success',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });

      })
      .catch(error => {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.",
          icon: 'info',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      });

  });


      function checkAll(type) {
        const checkboxes = document.querySelectorAll(
          `input[type="checkbox"][name="${type}"]`
        );
        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );
    
        for (const checkbox of checkboxes) {
          if (checkbox.disabled || !checkbox.offsetParent) {
            continue; // B·ªè qua checkbox b·ªã v√¥ hi·ªáu h√≥a
          }
    
          const row = checkbox.closest('tr');
          if (row.style.display == 'none') { // Ki·ªÉm tra n·∫øu d√≤ng hi·ªán tr√™n m√†n h√¨nh
            continue; // G√°n tr·∫°ng th√°i checkbox "Check All" cho checkbox hi·ªÉn th·ªã
          }
    
          checkbox.checked = checkAllCheckbox.checked; // G√°n gi√° tr·ªã checked cho checkbox kh√¥ng b·ªã v√¥ hi·ªáu h√≥a
        }
      }    

      function updateCheckAll(type) {
        const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${type}"]`);
        const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
    
        // Ki·ªÉm tra n·∫øu t·∫•t c·∫£ checkbox c√° nh√¢n ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn
        const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
        checkAllCheckbox.checked = allChecked; // C·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All"
      }
    
      function disableCheckAll(type) {
        const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);
    
        if (checkAllCheckbox) {
          // NgƒÉn kh√¥ng cho ng∆∞·ªùi d√πng thay ƒë·ªïi checkbox t·ªïng
          checkAllCheckbox.addEventListener('click', function (e) {
            e.preventDefault(); // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i
          });
        }
      }

  // L·∫•y d·ªØ li·ªáu ƒë·ªÉ l∆∞u
  function getDataToStored() {
    const isKhoa = localStorage.getItem("isKhoa");
    const rows = document.querySelectorAll('#tableBody tr'); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng
    const data = JSON.parse(localStorage.getItem("tableData"));

    rows.forEach((row, id) => {
      // L·∫•y gi√° tr·ªã ng√†y b·∫Øt ƒë·∫ßu, ng√†y k·∫øt th√∫c
      
      const NgayBatDau = document.getElementById(`NgayBatDau-${id}`);
      const NgayKetThuc = document.getElementById(`NgayKetThuc-${id}`);

      // L·∫•y c√°c gi√° tr·ªã t·ª´ c√°c √¥ nh·∫≠p Gi·∫£ng vi√™n
      const GiangVien1 = document.getElementById(`GiangVien1-${id}`);
      const GiangVien2 = document.getElementById(`GiangVien2-${id}`);

      // L·∫•y gi√° tr·ªã c·ªßa checkbox "Khoa", "ƒê√†o T·∫°o", v√† "T√†i Ch√≠nh"
      const khoaCheckbox = row.querySelector('input[type="checkbox"][name="khoa"]');
      const daoTaoCheckbox = row.querySelector('input[type="checkbox"][name="daoTao"]');
      const taiChinhCheckbox = row.querySelector('input[type="checkbox"][name="taiChinh"]');

      // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "Khoa"
      let khoaDuyet = khoaCheckbox ? khoaCheckbox.checked : false;

      // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "ƒê√†o T·∫°o"
      const daoTaoDuyet = daoTaoCheckbox ? daoTaoCheckbox.checked : false;

      // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "T√†i Ch√≠nh"
      let taiChinhDuyet = taiChinhCheckbox ? taiChinhCheckbox.checked : false;

      if (isKhoa == 1) {
        // C·∫≠p nh·∫≠t v√†o m·∫£ng globalData t∆∞∆°ng ·ª©ng v·ªõi ch·ªâ m·ª•c h√†ng (index)

        data[id].GiangVien1 = GiangVien1.value;
        data[id].GiangVien2 = GiangVien2.value;

        data[id].NgayBatDau = NgayBatDau.value;
        data[id].NgayKetThuc = NgayKetThuc.value;
      }

      data[id].KhoaDuyet = khoaDuyet; // C·∫≠p nh·∫≠t Khoa

      data[id].DaoTaoDuyet = daoTaoDuyet; // C·∫≠p nh·∫≠t ƒê√†o T·∫°o

      data[id].TaiChinhDuyet = taiChinhDuyet; // C·∫≠p nh·∫≠t T√†i Ch√≠nh
  
    });

    return data;
  }
  
  // L∆∞u d·ªØ li·ªáu v√†o table doantotnghiep
  document.getElementById("updateDoAn").addEventListener("click", function () {
    const NamHoc = document.getElementById("NamHoc").value;
    const MaPhongBan = document.getElementById("MaPhongBan").value;
    const Dot = document.getElementById("combobox-dot").value;
  
    let data = getDataToStored();
    
    // G·ª≠i d·ªØ li·ªáu qua API
    fetch(
      `/updateDoAn?NamHoc=${encodeURIComponent(NamHoc)}&MaPhongBan=${encodeURIComponent(MaPhongBan)}&Dot=${encodeURIComponent(Dot)}`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      }
    )
    .then(response => {
      if (!response.ok) {
        throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
      }
      return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
    })
    .then(data => {
      let thongBao = 'info';
      if (data.message.toLowerCase() == "c·∫≠p nh·∫≠t th√†nh c√¥ng"){
        thongBao = 'success';
      }
      Swal.fire({
        title: 'Th√¥ng b√°o',
        html: data.message,
        icon: thongBao,
        confirmButtonText: 'OK',
        width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
        padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
      });
    })
    .catch(error => {
      console.error('C√≥ l·ªói x·∫£y ra:', error);
      Swal.fire({
        title: 'Th√¥ng b√°o',
        html: 'C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.',
        icon: 'info',
        confirmButtonText: 'OK',
        width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
        padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
      });
    });
  });
  
  // L∆∞u d·ªØ li·ªáu sau khi t√†i ch√≠nh ƒë√£ duy·ªát v√†o table exportdoan
  document.getElementById("saveDataDoAn").addEventListener("click", function () {
    const NamHoc = document.getElementById("NamHoc").value;
    const MaPhongBan = document.getElementById("MaPhongBan").value;
    const Dot = document.getElementById("combobox-dot").value;
  
    const requestData = {
      Dot: Dot,
      NamHoc: NamHoc,
      MaPhongBan: MaPhongBan,
    };
    
    // G·ª≠i d·ªØ li·ªáu qua API
    fetch(
      `/saveToExportDoAn`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(requestData),
      }
    )
    .then(response => {
      if (!response.ok) {
        throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
      }
      return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
    })
    .then(data => {
      Swal.fire({
        title: 'Th√¥ng b√°o',
        html: data.message,
        icon: 'success',
        confirmButtonText: 'OK',
        width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
        padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
      });
    })
    .catch(error => {
      console.error('C√≥ l·ªói x·∫£y ra:', error);
      Swal.fire({
        title: 'Th√¥ng b√°o',
        html: 'C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.',
        icon: 'info',
        confirmButtonText: 'OK',
        width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
        padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
      });
    });
  });
  
      // H√†m hi·ªÉn th·ªã g·ª£i √Ω ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
      function showSuggestions(input, GiangVienDefault, position, id, stt) { // id ƒë·ªÉ l·∫•y ch√≠nh x√°c d·ªØ li·ªáu gi·∫£ng vi√™n trong csdl, stt ƒë·ªÉ l·∫•y thu·ªôc t√≠nh id c·ªßa d√≤ng
        const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
        hideSuggestions(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω

        // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
        const suggestionsContainer = document.createElement('div');
        suggestionsContainer.className = 'suggestions'; // ƒê·∫∑t class cho khung g·ª£i √Ω

        // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
        const { bottom, left, width } = input.getBoundingClientRect();
        suggestionsContainer.style.position = 'absolute';
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`;
        suggestionsContainer.style.left = `${left + window.scrollX}px`;
        suggestionsContainer.style.width = `${width}px`;
        suggestionsContainer.style.zIndex = '1000';
        suggestionsContainer.style.maxHeight = '200px';
        suggestionsContainer.style.overflowY = 'auto';

        // Th√™m suggestionsContainer v√†o DOM
        document.body.appendChild(suggestionsContainer);

        let suggestions = [];

        // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
        const duplicateGV = JSON.parse(localStorage.getItem("duplicateGV")) || [];
        const allGV = JSON.parse(localStorage.getItem("allGV")) || [];

        // So s√°nh xem gi·∫£ng vi√™n c√≥ b·ªã tr√πng kh√¥ng
        /*
        if (position == '1') {
          suggestions = duplicateGV
          .filter(item => item.HoTenReal == GiangVienDefault)  // ƒêi·ªÅu ki·ªán l·ªçc
          .map(item => `${item.HoTen} - ${item.BienChe} - ${item.CCCD}`);
        } else if (position == '2') {
          suggestions = duplicateGV
          .filter(item => item.HoTenReal == GiangVienDefault)  // ƒêi·ªÅu ki·ªán l·ªçc
          .map(item => `${item.HoTen} - ${item.BienChe} - ${item.CCCD}`);
        }
          */

        let isAll = false;
        if (suggestions.length < 1){
          isAll = true;
          suggestions = allGV
          .map(item => `${item.HoTen} - ${item.BienChe} - ${item.CCCD}`);
        }

        // L·ªçc g·ª£i √Ω theo gi√° tr·ªã nh·∫≠p v√†o
        if (value) {
          suggestions = suggestions.filter(name => name.toLowerCase().includes(value));
        }

        // N·∫øu kh√¥ng c√≥ g·ª£i √Ω, ·∫©n container
        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return;
        }

        // T·∫°o c√°c suggestionItem cho m·ªói g·ª£i √Ω
        suggestions.forEach(name => {
          const suggestionItem = document.createElement('div'); // T·∫°o m·ªõi ph·∫ßn t·ª≠ cho g·ª£i √Ω
          suggestionItem.className = 'suggestion-item'; // ƒê·∫∑t class cho g·ª£i √Ω
          suggestionItem.textContent = name; // Thi·∫øt l·∫≠p n·ªôi dung cho g·ª£i √Ω

          // Th√™m s·ª± ki·ªán click
          suggestionItem.onclick = function () {

            const tableData = JSON.parse(localStorage.getItem("tableData"));
            // T√¨m item d·ª±a tr√™n `TT` (ho·∫∑c b·∫•t k·ª≥ thu·ªôc t√≠nh n√†o b·∫°n so s√°nh)
            const itemID = tableData.find(item => item.ID == id);

            // L·∫•y t√™n gi·∫£ng vi√™n t·ª´ g·ª£i √Ω ƒë√£ ch·ªçn
            const selectedName = name.split(" - ")[0]; // T√°ch t√™n ra kh·ªèi Bi√™n ch·∫ø v√† CCCD
            const selectedCCCD = name.split(" - ")[2];

            let arrayGV;

            if (isAll){
              arrayGV = Array.isArray(allGV) ? allGV : Object.values(allGV);

            } else {
              arrayGV = Array.isArray(duplicateGV) ? duplicateGV : Object.values(duplicateGV);
            }

            const lecturerFound = arrayGV.find(lecturer => lecturer.CCCD.trim() == selectedCCCD.trim());
            
            if (lecturerFound) {

              if (itemID !== -1) { // Ki·ªÉm tra n·∫øu c√≥ id
                if (position == 1){
                  const GiangVien1 = document.getElementById(`GiangVien1-${stt}`);
                  GiangVien1.value = lecturerFound.HoTen + ' - ' + lecturerFound.BienChe + ' - ' + lecturerFound.CCCD;
                } else {
                  const GiangVien2 = document.getElementById(`GiangVien2-${stt}`);
                  GiangVien2.value = lecturerFound.HoTen + ' - ' + lecturerFound.BienChe + ' - ' + lecturerFound.CCCD;
                }
              }
            }


            hideSuggestions(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
          };

          suggestionsContainer.appendChild(suggestionItem); // Th√™m suggestionItem v√†o container
        });

        // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
        input.onblur = function () {
          setTimeout(() => {
            hideSuggestions();
          }, 100);
        };
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestions() {
        const existingSuggestions = document.querySelectorAll('.suggestions');
        existingSuggestions.forEach(suggestion => suggestion.remove());
      }



  </script>

  <script>
    let currentRow; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u h√†ng hi·ªán t·∫°i
  
    function openNoteForm(row, GhiChu, Deadline) {
      currentRow = row; // L∆∞u h√†ng hi·ªán t·∫°i
      document.getElementById("noteForm").style.display = "block"; // Hi·ªÉn th·ªã form
      document.getElementById("modalBackdrop").style.display = "block"; // Hi·ªÉn th·ªã n·ªÅn t·ªëi
  
      // Hi·ªÉn th·ªã gi√° tr·ªã ghi ch√∫ v√† h·∫°n
      document.getElementById("noteInput").value = GhiChu || ""; // Hi·ªÉn th·ªã ghi ch√∫
      document.getElementById("deadlineInput").value = formatInputDate(Deadline) || ""; // Hi·ªÉn th·ªã h·∫°n
    }
  
  
    function closeNoteForm() {
      document.getElementById("noteForm").style.display = "none"; // ·∫®n form
      document.getElementById("modalBackdrop").style.display = "none"; // ·∫®n n·ªÅn t·ªëi
    }
    
    window.onclick = function (event) {
      const modal = document.getElementById("noteForm");
      const modalBackdrop = document.getElementById("modalBackdrop");
      if (event.target === modalBackdrop) {
        closeNoteForm();
      }
    }

    async function saveNote() {
      const note = document.getElementById("noteInput").value;
      const deadline = document.getElementById("deadlineInput").value;
  
      if (currentRow) {
        const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng
        console.log("id = ", id);
  
        // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
        if (id) {
  
  
          // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
          try {
            const response = await fetch('/saveNoteDoAn', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ id, ghiChu: note, deadline }),
            });
            const result = await response.json();
            if (!result.success) {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                icon: 'info',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });
            } else {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                icon: 'success',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });
            }
          } catch (error) {
            Swal.fire({
              title: 'Th√¥ng b√°o',
              html: "L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error,
              icon: 'info',
              confirmButtonText: 'OK',
              width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
          }
        } else {
          Swal.fire({
            title: 'Th√¥ng b√°o',
            html: "ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i",
            icon: 'info',
            confirmButtonText: 'OK',
            width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
        }
      } else {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh",
          icon: 'info',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      }
  
      closeNoteForm();
    }
    async function doneNote() {
      const note = document.getElementById("noteInput").value;
      const deadline = document.getElementById("deadlineInput").value;
  
      if (currentRow) {
        const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng
  
        // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
        if (id) {
  
  
          // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
          try {
            const response = await fetch('/doneNoteDoAn', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ id, ghiChu: note, deadline }),
            });
            const result = await response.json();
            if (!result.success) {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                icon: 'info',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });
            } else {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                icon: 'success',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });
            }
          } catch (error) {
            Swal.fire({
              title: 'Th√¥ng b√°o',
              html: "L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error,
              icon: 'success',
              confirmButtonText: 'OK',
              width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
          }
        } else {
          Swal.fire({
            title: 'Th√¥ng b√°o',
            html: "ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.",
            icon: 'info',
            confirmButtonText: 'OK',
            width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
        }
      } else {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.",
          icon: 'info',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      }
  
      closeNoteForm();
    }
  
  
    // H√†m ƒë·ªÉ chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y
    function formatInputDate(dateString) {
      const date = new Date(dateString);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0'); // L·∫•y th√°ng (0-11) v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë
      const day = String(date.getDate()).padStart(2, '0'); // L·∫•y ng√†y v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë
  
      return `${year}-${month}-${day}`; // Tr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng yyyy-mm-dd cho input
    }
  
  
  
    // S·ª± ki·ªán click ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
    window.onclick = function (event) {
      const modal = document.getElementById("noteForm");
      const modalBackdrop = document.getElementById("modalBackdrop");
      if (event.target === modalBackdrop) {
        closeNoteForm();
      }
    }
  </script>

  <!-- link  -->
  <script>

    document.addEventListener("DOMContentLoaded", () => {
      const role = localStorage.getItem("userRole")
      const MaPhongBan = localStorage.getItem("MaPhongBan")
      const isKhoa = localStorage.getItem("isKhoa");

      // ·∫®n button import ƒë·ªì √°n
      const importDoAn = document.getElementById('importDoAn');
      const suaHD = document.getElementById('suaHD');

      if (isKhoa == 0 && role == 'Duy·ªát'){
        importDoAn.style.display = 'block';
        suaHD.style.display = 'block';
      }

      // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="ThongTinGD"
      const ThongTinGD = document.getElementById("ThongTinGD");

      ThongTinGD.addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

        const isKhoa = localStorage.getItem("isKhoa"); // L·∫•y role t·ª´ localStorage

        if (isKhoa == 0) {
          // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
          window.location.href = "/info2";
        } else {
          window.location.href = "/info";
        }
      });

      // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="Home"

      const Home = document.getElementById("Home");

      Home.addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

        const isKhoa = localStorage.getItem("isKhoa");

        if (isKhoa == 0) {
          // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
          window.location.href = "/maindt";
        } else {
          window.location.href = "/mainkhoa";
        }
      });


    // N·∫øu l√† ph√≤ng ban th√¨ hi·ªán l·ªçc theo khoa
    if (isKhoa == 1) {
      document.getElementById('MaPhongBan').style.display = 'none';
    }

    if (role == 'Th∆∞·ªùng' || role.includes('GV')) {
      // ·∫®n t·∫•t c·∫£ c√°c c·ªôt
      document.getElementById('khoaColumn').style.display = 'none';
      document.getElementById('daoTaoColumn').style.display = 'none';
      document.getElementById('taiChinhColumn').style.display = 'none';
      if (!role.includes('CNBM')) {
        document.getElementById('updateDoAn').style.display = 'none';
      }
    }

    if (isKhoa == 1 && role == 'L√£nh ƒë·∫°o khoa') {
      document.getElementById('daoTaoColumn').style.display = 'none';
      document.getElementById('taiChinhColumn').style.display = 'none';

      document.getElementById('khoaColumn').style.display = 'block';

    }

    if (isKhoa == 0 && role == 'Duy·ªát') {
      if (MaPhongBan == 'DAOTAO') {
        // ·∫®n c·ªôt 'taiChinhColumn'
        document.getElementById('taiChinhColumn').style.display = 'none';
        document.getElementById('updateDoAn').style.display = 'inline-block'; // S·ª≠ d·ª•ng 'inline-block' ƒë·ªÉ hi·ªÉn th·ªã n√∫t
      } else if (MaPhongBan == 'TAICHINH') {
        // ·∫®n c·ªôt 'khoaColumn'
        document.getElementById('khoaColumn').style.display = 'none';
        document.getElementById('updateDoAn').style.display = 'inline-block'; // S·ª≠ d·ª•ng 'inline-block' ƒë·ªÉ hi·ªÉn th·ªã n√∫t
        document.getElementById('saveDataDoAn').style.display = 'inline-block';
      }
    }

    // Ph√¢n quy·ªÅn, n·∫øu kh√¥ng c√≥ quy·ªÅn khoa ch·ªânh s·ª≠a s·∫Ω ·∫©n ng√†y all ƒëi
    const dateContainer = document.querySelector(".date-all-container");
      if (isKhoa == 1 && role != 'GV') {
        dateContainer.style.display = "flex";
      }

    });
  </script>

  <script>
    window.onload = function () {
      const TenNhanVien = localStorage.getItem("TenNhanVien"); // L·∫•y t√™n ng∆∞·ªùi d√πng t·ª´ localStorage
      const Role = localStorage.getItem("userRole");

      if (TenNhanVien) {
        // Hi·ªÉn th·ªã t√™n ng∆∞·ªùi d√πng tr√™n ph·∫ßn t·ª≠ HTML
        document.querySelector(
          ".fullname"
        ).innerText = `${TenNhanVien} - ${Role}`;
      } else {
        document.querySelector(".fullname").innerText = "Hi, Guest"; // Hi·ªÉn th·ªã n·∫øu kh√¥ng c√≥ t√™n ng∆∞·ªùi d√πng
      }

      //document.querySelector(".role").innerText = `${Role}`;
    };
  </script>
  <script>
    document.getElementById("changePasswordLink").addEventListener("click", function (event) {
      event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
      const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

      if (tenDangNhap) {
        // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
        window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(tenDangNhap)}`;
      } else {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.",
          icon: 'info',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      }
    });
  </script>
  <script>
    $(document).ready(function () {
      $('#NamHoc option[value=""]').remove();
      $('#comboboxki option[value=""]').remove();
      $('#combobox-dot option[value=""]').remove();

      $.ajax({
        url: '/getNamHoc',
        method: 'GET',
        success: function (response) {
          if (response.success) {

            response.NamHoc.forEach(function (item) {
              $('#NamHoc').append(
                `<option value="${item.NamHoc}">${item.NamHoc}</option>`
              );
            });

            response.Ki.forEach(function (item) {
              $('#comboboxki').append(
                `<option value="${item.value}">${item.Ki}</option>`
              );
            });
            response.Dot.forEach(function (item) {
              $('#combobox-dot').append(
                `<option value="${item.value}">${item.Dot}</option>`
              );
            });
          } else {
            console.error("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu nƒÉm h·ªçc:", response.message);
          }
        },
        error: function (error) {
          console.error("L·ªói khi l·∫•y d·ªØ li·ªáu nƒÉm h·ªçc:", error);
        }
      });
    });
  </script>
  
  <script>
    $(document).ready(function () {
      $('#MaPhongBan option[value=""]').remove();
      // G·ªçi AJAX ƒë·ªÉ l·∫•y d·ªØ li·ªáu JSON t·ª´ API
      $.ajax({
        url: '/getPhongBan', // ƒê∆∞·ªùng d·∫´n t·ªõi API getPhongBan
        method: 'GET',
        success: function (response) {
          // Ki·ªÉm tra n·∫øu response th√†nh c√¥ng
          const MaPhongBan = response.MaPhongBan;
          if (response.success) {
            $('#MaPhongBan').prepend('<option value="ALL">T·∫•t c·∫£ khoa</option>');
            // L·∫∑p qua t·ª´ng m·ª•c trong m·∫£ng MaPhongBan
            response.MaPhongBan.forEach(function (item) {
              // N·∫øu item.MaPhongBan b·∫±ng boMon.MaPhongBan, hi·ªÉn th·ªã tr∆∞·ªõc
              $('#MaPhongBan').append(
                `<option value="${item.MaPhongBan}">${item.MaPhongBan}</option>`
              );
            }
            );

            // N·∫øu kh√¥ng c√≥ ph√≤ng ban n√†o t∆∞∆°ng ·ª©ng, b·∫°n c√≥ th·ªÉ th√™m t√πy ch·ªçn m·∫∑c ƒë·ªãnh ·ªü ƒë√¢y
            if (!$('#MaPhongBan option:selected').length) {
              $('#MaPhongBan').prepend('<option value="">Ch·ªçn Ph√≤ng Ban</option>');
            }
          } else {
            console.error("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu phongBan:", response.message);
          }
        },
        error: function (error) {
          console.error("L·ªói khi l·∫•y d·ªØ li·ªáu phongBan:", error);
        }
      });
    });
  </script>
  <script>
    document.getElementById("infome").addEventListener("click", function(event) {
      event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
      const id_User = localStorage.getItem("id_User"); // L·∫•y id_User t·ª´ localStorage\
      if (id_User) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang infome v√† truy·ªÅn id_User trong URL
          window.location.href = `/infome/${id_User}`;
      } else {
          Swal.fire({
            title: 'Th√¥ng b√°o',
            html: "Kh√¥ng t√¨m th·∫•y id_User trong localStorage.",
            icon: 'info',
            confirmButtonText: 'OK',
            width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
      }
    });
  </script>
<script>
      document.addEventListener("DOMContentLoaded", () => {
        const role = localStorage.getItem("userRole");

        // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
        const actionButton = document.getElementById('changeMessage');
        //·∫®n site th√™m th√¥ng b√°o
        if (role === "Duy·ªát") {
          actionButton.style.display = '';
        } else {
          actionButton.style.display = 'none';
        }
      });
    </script>
  <script>
      document.getElementById("changeMessage").addEventListener("click", function(event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const MaPhongBan = localStorage.getItem("MaPhongBan"); // L·∫•y MaPhongBan t·ª´ localStorage

        if (MaPhongBan) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changeMessage v√† truy·ªÅn MaPhongBan trong URL
            window.location.href = `/changeMessage/${MaPhongBan}`;
        } else {
            Swal.fire({
              title: 'Th√¥ng b√°o',
              html: "Kh√¥ng t√¨m th·∫•y MaPhongBan trong localStorage.",
              icon: 'success',
              confirmButtonText: 'OK',
              width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
        }
      });
    </script>
  </body>

</html>