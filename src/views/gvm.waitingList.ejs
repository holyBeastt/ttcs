<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/gvmList.css" />
    <link rel="stylesheet" href="/css/table.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <!-- <style>
      .teacher-group {
        border: 2px solid black;
        /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */
        border-collapse: separate;
        margin-bottom: 10px;
      }

      .teacher-group td,
      .teacher-group th {
        padding: 8px;
        text-align: left;
        border: 2px solid black;
        /* Vi·ªÅn ƒëen xung quanh nh√≥m gi·∫£ng vi√™n */
      }

      /* ph·∫ßn css cho label t·ªïng s·ªë ti·∫øt ki*/
      .total-label {
        margin-left: auto;
        /* CƒÉn ph·∫£i cho th·∫ª total-label */
        margin-right: 0;
        font-family: Arial, sans-serif;
        font-size: 16px;
        background-color: #f4f4f4;
        padding: 10px;
        border-radius: 8px;
        width: fit-content;
        /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); */
        display: block;
        /* ƒê·∫£m b·∫£o th·∫ª div l√† kh·ªëi ƒë·ªÉ cƒÉn ph·∫£i ho·∫°t ƒë·ªông */
      }

      .total-label label {
        font-weight: bold;
        /* Gi·ªØ ch·ªØ in ƒë·∫≠m */
        color: #000;
        /* M√†u ch·ªØ ƒëen */
        margin-right: 8px;
        /* Th√™m kho·∫£ng c√°ch b√™n ph·∫£i */
        cursor: pointer;
        /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn v√† m√†u ch·ªØ m·ªÅm m·∫°i */
        padding: 5px 10px;
        /* Th√™m padding cho label ƒë·ªÉ t·∫°o kh√¥ng gian */
        border: 1px solid #ccc;
        /* Khung cho label */
        border-radius: 4px;
        /* Bo g√≥c cho khung */
      }

      .total-label label,
      .total-label label span {
        background-color: #007bff;
        /* M√†u n·ªÅn khi hover */
        color: #fff;
        /* M√†u ch·ªØ tr·∫Øng khi hover */
      }

      .total-label span {
        font-weight: bold;
        /* Gi·ªØ ch·ªØ trong span c≈©ng in ƒë·∫≠m */
        color: #333;
        /* M√†u ch·ªØ ƒë·∫≠m cho gi√° tr·ªã */
      }

      .btn {
        height: 45px !important;
      }

      .table {
        border-collapse: collapse;
        width: 100%;
        /*border: 2px solid #333 !important; /* Vi·ªÅn ngo√†i ƒë·∫≠m */
      }

      .table th,
      .table td {
        border: 1px solid #ccc; /* Vi·ªÅn gi·ªØa c√°c √¥ nh·∫°t h∆°n */
        padding: 8px;
        text-align: center;
      }

      .table-dark th {
        background-color: #343a40;
        color: white;
      }
    </style> -->
    <style>
      /* T√πy ch·ªânh danh s√°ch g·ª£i √Ω */
      .ui-autocomplete {
        background: white;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        padding: 5px;
        width: 200px;
        /* Gi·∫£m ƒë·ªô r·ªông */
        font-size: 12px !important;
      }

      /* Hi·ªÉn th·ªã ƒë·∫πp h∆°n, kh√¥ng c·∫ßn hover */
      .ui-menu-item {
        padding: 8px;
        cursor: default;
      }

      .ui-helper-hidden-accessible {
        display: none !important;
      }
    </style>
  </head>

  <body>
    <!-- Ph·∫ßn header -->
    <%- include('header') %>

    <!-- Ph·∫ßn n·ªôi dung -->

    <div class="container-fluid m-4 no-shadow-page">
      <div class="d-flex">
        <!-- Main content -->
        <div class="gvmList hd_du_kien_css">
          <div class="m-3 reCss">
            <h1>DANH S√ÅCH CH·ªú DUY·ªÜT</h1>

            <div class="controls-container">
              <select
                class="form-select mx-1 selectop"
                style="width: max-content"
                id="MaPhongBan"
              >
                <option value="">Ch·ªçn khoa</option>
              </select>

              <select
                class="form-select mx-1 selectop"
                style="width: max-content"
                id="checkOrder"
              >
                <option value="ALL">T·∫•t c·∫£</option>
                <option value="khoaChecked">Khoa ƒë√£ duy·ªát</option>
                <option value="daoTaoChecked">ƒê√†o t·∫°o ƒë√£ duy·ªát</option>
                <option value="unChecked">Khoa ch∆∞a duy·ªát</option>
              </select>

              <button id="viewDataBtnDetail" class="btn mx-3">
                Xem d·ªØ li·ªáu
              </button>

              <input
                type="text"
                placeholder="T√¨m ki·∫øm theo T√™n..."
                class="search"
                id="searchInput"
              />
              <input
                type="text"
                placeholder="T√¨m ki·∫øm theo B·ªô m√¥n"
                class="search"
                id="searchBoMon"
              />

              <button id="update-unapproved-list" class="btn mx-3 luu">
                C·∫≠p nh·∫≠t
              </button>
            </div>

            <div id="tableContainer" style="display: none">
              <div class="table-responsive">
                <div class="over-f">
                  <table
                    id="dataTable"
                    class="table table-striped table-hover table-bordered table-css"
                  >
                    <thead class="table-dark">
                      <tr>
                        <th>STT</th>
                        <th>Danh x∆∞ng</th>
                        <th>H·ªç t√™n</th>
                        <th>Ng√†y sinh</th>
                        <th>CCCD</th>
                        <th>Ng√†y c·∫•p CCCD</th>
                        <th style="min-width: 150px">ƒê·ªãa ch·ªâ</th>
                        <th>H·ªçc v·ªã</th>
                        <th>Ch·ª©c v·ª•</th>
                        <th style="display: none">Khoa</th>
                        <th style="min-width: 150px">N∆°i c√¥ng t√°c</th>
                        <th>B·ªô m√¥n</th>
                        <th>S·ª≠a</th>
                        <th>Xem</th>
                        <th id="khoaColumn">
                          <div class="form-check">
                            <label for="">Khoa</label>

                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="checkAllKhoa"
                              onclick="checkAll('khoa')"
                            />
                          </div>
                        </th>
                        <th id="daoTaoColumn">
                          <div class="form-check">
                            ƒê√†o t·∫°o
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="checkAllDaoTao"
                              onclick="checkAll('daoTao')"
                            />
                          </div>
                        </th>
                        <th id="hocVienColumn">
                          <div class="form-check">
                            H·ªçc vi·ªán
                            <input
                              class="form-check-input"
                              type="checkbox"
                              id="checkAllHocVien"
                              onclick="checkAll('hocVien')"
                            />
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Link script Sweet alert 2 -->
    <!-- SweetAlert2 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css"
      rel="stylesheet"
    />

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

    <!-- auto complete -->
    <!-- Th√™m jQuery v√† jQuery UI -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- jQuery UI CSS -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <script>
      // H√†m l·ªçc chung
      function filterTable() {
        let nameInput = document
          .getElementById("searchInput")
          .value.toLowerCase();
        let boMonInput = document
          .getElementById("searchBoMon")
          .value.toLowerCase();

        let table = document.getElementById("dataTable");
        let tr = table.getElementsByTagName("tr");

        for (let i = 1; i < tr.length; i++) {
          // B·ªè qua h√†ng ti√™u ƒë·ªÅ
          let nameCell = tr[i].getElementsByTagName("td")[3]; // T√™n gi·∫£ng vi√™n
          let boMonCell = tr[i].getElementsByTagName("td")[11]; // B·ªô m√¥n

          // L·∫•y gi√° tr·ªã t·ª´ c√°c √¥
          let nameValue = nameCell ? nameCell.textContent.toLowerCase() : "";
          let boMonValue = boMonCell ? boMonCell.textContent.toLowerCase() : "";

          // Ki·ªÉm tra ƒëi·ªÅu ki·ªán l·ªçc
          let nameMatch = nameValue.includes(nameInput);
          let boMonMatch = boMonValue.includes(boMonInput);

          // Hi·ªán ho·∫∑c ·∫©n h√†ng d·ª±a tr√™n c√°c ƒëi·ªÅu ki·ªán
          if (nameMatch && boMonMatch) {
            tr[i].style.display = ""; // Hi·ªán h√†ng n·∫øu t·∫•t c·∫£ c√°c ƒëi·ªÅu ki·ªán ƒë·ªÅu kh·ªõp
          } else {
            tr[i].style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        }
      }

      // G·ªçi h√†m l·ªçc khi c√≥ thay ƒë·ªïi trong c√°c √¥ t√¨m ki·∫øm
      document
        .getElementById("searchInput")
        .addEventListener("keyup", filterTable);
      document
        .getElementById("searchBoMon")
        .addEventListener("keyup", filterTable);

      $(document).ready(function () {
        // Ki·ªÉm tra xem jQuery UI c√≥ ƒë∆∞·ª£c load kh√¥ng
        if (!$.fn.autocomplete) {
          console.error("jQuery UI Autocomplete ch∆∞a ƒë∆∞·ª£c load!");
          return;
        }

        // C·∫•u h√¨nh autocomplete
        $("#searchBoMon").autocomplete({
          source: function (request, response) {
            const value = request.term.toLowerCase();
            const khoaValue = $("#MaPhongBan").val() || "ALL";
            let boMon = JSON.parse(localStorage.getItem("boMon")) || [];

            let suggestions = boMon
              .filter(
                (item) => khoaValue === "ALL" || item.MaPhongBan === khoaValue
              )
              .map((item) => ({
                label: `${item.MaPhongBan} - ${item.TenBoMon} - ${item.MaBoMon}`,
                value: item.MaBoMon, // Ch·ªâ l·∫•y m√£ b·ªô m√¥n khi ch·ªçn
              }));

            // N·∫øu c√≥ gi√° tr·ªã nh·∫≠p v√†o th√¨ l·ªçc
            if (value) {
              suggestions = suggestions.filter((item) =>
                item.label.toLowerCase().includes(value)
              );
            }

            response(suggestions);
          },
          minLength: 0, // Hi·ªÉn th·ªã ngay khi nh·∫•n v√†o √¥ input
          select: function (event, ui) {
            $("#searchBoMon").val(ui.item.value); // Ch·ªâ l·∫•y m√£ b·ªô m√¥n
            filterTable();
            return false;
          },
          /*
          focus: function (event, ui) {
            $("#searchBoMon").val(ui.item.value); // Khi hover c≈©ng hi·ªÉn th·ªã m√£ b·ªô m√¥n
            return false;
          }, */
        });

        // Khi click v√†o √¥ input, hi·ªÉn th·ªã danh s√°ch g·ª£i √Ω ngay l·∫≠p t·ª©c
        $("#searchBoMon").on("focus", function () {
          $(this).autocomplete("search", ""); // G·ªçi autocomplete v·ªõi chu·ªói r·ªóng ƒë·ªÉ hi·ªÉn th·ªã to√†n b·ªô
        });
      });
    </script>
    <script>
      function checkAll(type) {
        const checkboxes = document.querySelectorAll(
          `input[type="checkbox"][name="${type}CheckBox"]`
        );
        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );

        if (!checkAllCheckbox) return; // Ki·ªÉm tra n·∫øu checkbox "Ch·ªçn t·∫•t c·∫£" kh√¥ng t·ªìn t·∫°i

        for (const checkbox of checkboxes) {
          if (checkbox.disabled || !checkbox.offsetParent) {
            continue; // B·ªè qua checkbox b·ªã v√¥ hi·ªáu h√≥a ho·∫∑c b·ªã ·∫©n ho√†n to√†n
          }

          checkbox.checked = checkAllCheckbox.checked; // G√°n tr·∫°ng th√°i checked cho checkbox hi·ªÉn th·ªã v√† kh√¥ng b·ªã v√¥ hi·ªáu h√≥a
        }
      }

      // h√†m x·ª≠ l√≠ check all
      function updateCheckAll(type) {
        const checkboxes = document.querySelectorAll(
          `input[type="checkbox"][name="${type}CheckBox"]`
        );

        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );

        if (!checkAllCheckbox) return; // Ki·ªÉm tra n·∫øu checkbox "Ch·ªçn t·∫•t c·∫£" kh√¥ng t·ªìn t·∫°i
        if (checkboxes.length === 0) {
          checkAllCheckbox.checked = false;
          return;
        }

        // Ki·ªÉm tra n·∫øu t·∫•t c·∫£ checkbox c√° nh√¢n ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn
        const allChecked = Array.from(checkboxes).every(
          (checkbox) => checkbox.checked
        );
        checkAllCheckbox.checked = allChecked; // C·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All"
      }
    </script>
    <!-- ph·∫ßn d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã tr√™n b·∫£ng -->
    <script>
      // Bi·∫øn to√†n c·ª•c
      let globalData = {};

      // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
      const role = localStorage.getItem("userRole");
      const MaPhongBan = localStorage.getItem("MaPhongBan");
      const isKhoa = localStorage.getItem("isKhoa");
      document.addEventListener("DOMContentLoaded", function () {
        const tableContainer = document.getElementById("tableContainer");
        const dataTable = document.getElementById("dataTable");

        const viewDataBtnDetail = document.getElementById("viewDataBtnDetail");

        // K√≠ch ho·∫°t s·ª± ki·ªán click ngay khi trang load n·∫øu l√† khoa
        requestAnimationFrame(() => {
          if (isKhoa == 1 && viewDataBtnDetail) {
            console.log("T·ª± ƒë·ªông click n√∫t viewDataBtnDetail");
            viewDataBtnDetail.click();
          }
        });

        viewDataBtnDetail.addEventListener("click", async function () {
          try {
            const khoa = document.getElementById("MaPhongBan").value;
            const checkOrder = document.getElementById("checkOrder").value;

            const response = await fetch(
              `/api/gvm/waiting-list/data?khoa=${encodeURIComponent(
                khoa
              )}&checkOrder=${encodeURIComponent(checkOrder)}`,
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );

            if (!response.ok) {
              throw new Error("Network response was not ok");
            }

            const data = await response.json();

            // X√≥a d·ªØ li·ªáu c≈© trong b·∫£ng
            const tbody = dataTable.querySelector("tbody");

            // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
            if (data.length == 0) {
              tbody.innerHTML = `
              <tr>
                <td colspan="10" style="text-align: center;">Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ hi·ªÉn th·ªã</td>
              </tr>`;
              return;
            }

            // N·∫øu c√≥ d·ªØ li·ªáu => ti·∫øp t·ª•c
            tbody.innerHTML = "";

            document.querySelectorAll(".reCss").forEach((el) => {
              el.style.setProperty("margin-left", "0px", "important");
            });

            data.forEach((item, index) => {
              // L∆∞u d·ªØ li·ªáu ƒë·ªÉ so s√°nh khi c·∫≠p nh·∫≠t (ch·ªâ g·ª≠i nh·ªØng d√≤ng c√≥ thay ƒë·ªïi)
              globalData[`${item.id_Gvm}`] = {
                khoa_duyet: item.khoa_duyet,
                dao_tao_duyet: item.dao_tao_duyet,
                hoc_vien_duyet: item.hoc_vien_duyet,
              };

              // Hi·ªÉn th·ªã d·ªØ li·ªáu
              const row = tbody.insertRow();
              let colIndex = 0; // Bi·∫øn ƒë·∫øm c·ªôt

              const idCell = row.insertCell(colIndex++);
              idCell.textContent = item.id_Gvm;
              idCell.style.display = "none"; // ·∫®n c·ªôt

              row.insertCell(colIndex++).textContent = index + 1; // STT
              row.insertCell(colIndex++).textContent =
                item.GioiTinh.toLowerCase() == "nam" ? "√îng" : "B√†";
              row.insertCell(colIndex++).textContent = item.HoTen;
              row.insertCell(colIndex++).textContent = item.NgaySinh
                ? new Date(item.NgaySinh).toLocaleDateString("vi-VN", {
                    day: "2-digit",
                    month: "2-digit",
                    year: "numeric",
                  })
                : "";
              row.insertCell(colIndex++).textContent = item.CCCD;
              row.insertCell(colIndex++).textContent = item.NgayCapCCCD
                ? new Date(item.NgayCapCCCD).toLocaleDateString("vi-VN", {
                    day: "2-digit",
                    month: "2-digit",
                    year: "numeric",
                  })
                : "";

              row.insertCell(colIndex++).textContent = item.DiaChi;
              row.insertCell(colIndex++).textContent = item.HocVi;
              row.insertCell(colIndex++).textContent = item.ChucVu;
              row.insertCell(colIndex++).textContent = item.NoiCongTac;
              row.insertCell(colIndex++).textContent = item.MonGiangDayChinh;

              // C·ªôt ch·ªânh s·ª≠a gvm
              const cellActionEdit = row.insertCell(colIndex++);
              cellActionEdit.innerHTML = `
                <td>
                  <button class="action-button edit"
                    onclick="editClass(this, '${parseInt(item.id_Gvm)}')"
                    ${
                      item.khoa_duyet === 1 || isKhoa == 0 || role == "GV"
                        ? "disabled style='cursor: not-allowed;'"
                        : ""
                    }>
                    ‚úèÔ∏è
                  </button>
                </td>
              `;

              // C·ªôt h√†nh ƒë·ªông
              const cellActionView = row.insertCell(colIndex++);
              cellActionView.innerHTML = `
                <td>
                    <button class="action-button view" onclick="viewClass(this, '${
                      parseInt(item.id_Gvm) - 1
                    }')">üëÅÔ∏è</button>
                </td>
                `;

              // C·ªôt checkbox Khoa
              const khoaCheckboxTd = row.insertCell(colIndex++); // Th√™m c·ªôt m·ªõi
              const khoaCheckbox = document.createElement("input");
              khoaCheckbox.type = "checkbox";
              khoaCheckbox.name = "khoaCheckBox";
              khoaCheckbox.checked = item.khoa_duyet; // Ki·ªÉm tra tr·∫°ng th√°i duy·ªát
              khoaCheckbox.onchange = () => updateCheckAll("khoa"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi

              let isDisabled = true;

              if (item.khoa_duyet == 0 && role === "L√£nh ƒë·∫°o khoa")
                isDisabled = false;

              if (
                item.khoa_duyet == 1 &&
                (MaPhongBan === "HV" ||
                  (MaPhongBan == "DAOTAO" &&
                    role == "Duy·ªát" &&
                    item.dao_tao_duyet == 0))
              ) {
                isDisabled = false;
              }

              khoaCheckbox.disabled = isDisabled;
              khoaCheckboxTd.appendChild(khoaCheckbox);

              // C·ªôt checkbox ƒê√†o t·∫°o
              const daoTaoCheckboxTd = row.insertCell(colIndex++); // Th√™m c·ªôt m·ªõi
              const daoTaoCheckbox = document.createElement("input");
              daoTaoCheckbox.type = "checkbox";
              daoTaoCheckbox.name = "daoTaoCheckBox";
              daoTaoCheckbox.checked = item.dao_tao_duyet; // Ki·ªÉm tra tr·∫°ng th√°i duy·ªát
              daoTaoCheckbox.onchange = () => updateCheckAll("daoTao"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi

              // ƒêi·ªÅu ki·ªán disable ƒë√†o t·∫°o
              isDisabled = true;

              if (
                item.khoa_duyet == 1 &&
                item.dao_tao_duyet == 0 &&
                role === "Duy·ªát" &&
                MaPhongBan === "DAOTAO"
              ) {
                isDisabled = false;
              }

              if (item.dao_tao_duyet == 1 && MaPhongBan === "HV") {
                isDisabled = false;
              }

              daoTaoCheckbox.disabled = isDisabled;

              daoTaoCheckboxTd.appendChild(daoTaoCheckbox);

              // C·ªôt checkbox H·ªçc vi·ªán
              const hocVienCheckboxTd = row.insertCell(colIndex++); // Th√™m c·ªôt m·ªõi
              const hocVienCheckbox = document.createElement("input");
              hocVienCheckbox.type = "checkbox";
              hocVienCheckbox.name = "hocVienCheckBox";
              hocVienCheckbox.checked = item.hoc_vien_duyet; // Ki·ªÉm tra tr·∫°ng th√°i duy·ªát
              hocVienCheckbox.onchange = () => updateCheckAll("hocVien"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi

              hocVienCheckbox.disabled =
                MaPhongBan != "HV" || // Ch·ªâ b·∫≠t n·∫øu l√† H·ªçc vi·ªán
                item.dao_tao_duyet === 0; // Kh√≥a n·∫øu ƒë√†o t·∫°o ch∆∞a duy·ªát
              hocVienCheckboxTd.appendChild(hocVienCheckbox);
            });

            // Hi·ªÉn th·ªã b·∫£ng
            tableContainer.style.display = "block";
          } catch (error) {
            console.error("Error:", error);
            alert("ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu");
          }
        });
      });

      // G·∫Øn s·ª± ki·ªán click cho n√∫t
      document
        .getElementById("update-unapproved-list")
        .addEventListener("click", submitData);

      function submitData() {
        // L·∫•y d·ªØ li·ªáu ƒë·ªÉ ti·∫øn h√†nh c·∫≠p nh·∫≠t
        const updatedData = getUpdatedData();

        if (updatedData.length === 0) {
          Swal.fire({
            title: "C·∫£nh b√°o",
            text: "Kh√¥ng c√≥ d·ªØ li·ªáu thay ƒë·ªïi",
            icon: "warning",
            confirmButtonText: "OK",
            width: "auto", // T·ª± ƒëÔøΩÔøΩng ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
          return;
        }

        // G·ª≠i d·ªØ li·ªáu l√™n server
        fetch("/api/gvm/waiting-list/update", {
          method: "PUT", // Ph∆∞∆°ng th·ª©c PUT
          headers: {
            "Content-Type": "application/json", // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
          },
          body: JSON.stringify(updatedData), // Chuy·ªÉn ƒë·ªïi globalData th√†nh chu·ªói JSON
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("L·ªói khi g·ª≠i d·ªØ li·ªáu");
            }
            return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
          })
          .then((data) => {
            // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
            const messageWithLineBreaks = data.message.replace(/\n/g, "<br>");

            Swal.fire({
              title: "Th√¥ng b√°o",
              html: messageWithLineBreaks,
              icon: "success",
              confirmButtonText: "OK",
              width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            }).then(() => {
              // Hi·ªÉn th·ªã l·∫°i b·∫£ng
              viewDataBtnDetail.click();
            });
          })
          .catch((error) => {
            console.error("C√≥ l·ªói x·∫£y ra:", error);
            alert("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.");
          });
      }

      function getUpdatedData() {
        const rows = document.querySelectorAll("#dataTable tbody tr");
        const updatedData = [];

        rows.forEach((row) => {
          const id_Gvm = row.cells[0].textContent;

          const khoaChecked = row.querySelector('input[name="khoaCheckBox"]')
            .checked
            ? 1
            : 0;
          const daoTaoChecked = row.querySelector(
            'input[name="daoTaoCheckBox"]'
          ).checked
            ? 1
            : 0;
          const hocVienChecked = row.querySelector(
            'input[name="hocVienCheckBox"]'
          ).checked
            ? 1
            : 0;

          // So s√°nh v·ªõi tr·∫°ng th√°i ban ƒë·∫ßu
          if (
            globalData[id_Gvm].khoa_duyet !== khoaChecked ||
            globalData[id_Gvm].dao_tao_duyet !== daoTaoChecked ||
            globalData[id_Gvm].hoc_vien_duyet !== hocVienChecked
          ) {
            let unchecked = false;

            if (
              MaPhongBan === "HV" &&
              globalData[id_Gvm].dao_tao_duyet == 1 &&
              daoTaoChecked == 0
            ) {
              unchecked = true;
            } // N·∫øu H·ªçc vi·ªán b·ªè duy·ªát ƒë√†o t·∫°o => b·ªè c·∫£ khoa
            updatedData.push({
              id_Gvm,
              khoa_duyet: khoaChecked,
              dao_tao_duyet: daoTaoChecked,
              hoc_vien_duyet: hocVienChecked,
              unchecked,
            });
          }
        });

        return updatedData;
      }
    </script>

    <!-- <script src="/bootstrap/dist/js/jquery-3.7.1.min.js"></script> -->
    <script src="/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Ch·ªânh s·ª≠a gvm
      function editClass(button, index) {
        var hre = "/updateGvm/" + index;
        window.location.href = hre;
      }
      function viewClass(button, index) {
        var hre = "/viewGvm/" + index;
        window.location.href = hre;
      }
    </script>

    <script>
      $(document).ready(function () {
        const isKhoa = localStorage.getItem("isKhoa");
        if (isKhoa == 1) {
          document.getElementById("MaPhongBan").style.display = "none"; // JavaScript thu·∫ßn
          return;
        }

        $('#MaPhongBan option[value=""]').remove();
        // G·ªçi AJAX ƒë·ªÉ l·∫•y d·ªØ li·ªáu JSON t·ª´ API
        $.ajax({
          url: "/api/TKB/getKhoaList", // ƒê∆∞·ªùng d·∫´n t·ªõi API getPhongBan
          method: "GET",
          success: function (response) {
            // Ki·ªÉm tra n·∫øu response th√†nh c√¥ng
            const MaPhongBan = response.MaPhongBan;
            if (response.success) {
              $("#MaPhongBan").prepend(
                '<option value="ALL">T·∫•t c·∫£ khoa</option>'
              );
              // L·∫∑p qua t·ª´ng m·ª•c trong m·∫£ng MaPhongBan
              response.MaPhongBan.forEach(function (item) {
                // N·∫øu item.MaPhongBan b·∫±ng boMon.MaPhongBan, hi·ªÉn th·ªã tr∆∞·ªõc
                $("#MaPhongBan").append(
                  `<option value="${item.MaPhongBan}">${item.MaPhongBan}</option>`
                );
              });

              // N·∫øu kh√¥ng c√≥ ph√≤ng ban n√†o t∆∞∆°ng ·ª©ng, b·∫°n c√≥ th·ªÉ th√™m t√πy ch·ªçn m·∫∑c ƒë·ªãnh ·ªü ƒë√¢y
              if (!$("#MaPhongBan option:selected").length) {
                $("#MaPhongBan").prepend(
                  '<option value="">Ch·ªçn Ph√≤ng Ban</option>'
                );
              }
            } else {
              console.error(
                "Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu phongBan:",
                response.message
              );
            }
          },
          error: function (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu phongBan:", error);
          },
        });
      });
    </script>
    <script>
      // L·∫•y query string t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get("message");

      // L·∫•y ph·∫ßn t·ª≠ div ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
      const messageDiv = document.getElementById("message");

      // Hi·ªÉn th·ªã th√¥ng b√°o d·ª±a tr√™n gi√° tr·ªã c·ªßa message

      if (message === "insertSuccess") {
        Swal.fire({
          title: "Th√¥ng b√°o",
          html: "C·∫≠p nh·∫≠t gi·∫£ng vi√™n th√†nh c√¥ng",
          icon: "success",
          confirmButtonText: "OK",
          width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message === "insertFalse") {
        Swal.fire({
          title: "Th√¥ng b√°o",
          html: "ƒê√£ x·∫£y ra l·ªói trong qu√° tr√¨nh th√™m gi·∫£ng vi√™n.",
          icon: "error",
          confirmButtonText: "OK",
          width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message == null) {
        // alert(message);
      } else {
        alert(message);
      }

      // Sau khi hi·ªÉn th·ªã th√¥ng b√°o, x√≥a query string ƒë·ªÉ tr√°nh hi·ªÉn th·ªã l·∫°i khi refresh
      if (message) {
        // S·ª≠ d·ª•ng window.history ƒë·ªÉ x√≥a query string m√† kh√¥ng refresh l·∫°i trang
        const newUrl = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
      }
    </script>
  </body>
</html>
