<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
    <link rel="stylesheet" href="/css/table.css" />
    <link rel="stylesheet" href="/css/teachingInfo.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <style>
      .table > :not(caption) > * > * {
        border-bottom-width: 2px;
      }

      /* CSS ƒë·ªÉ cƒÉn ch·ªânh label t·ªïng s·ªë ti·∫øt */
      .table {
        border-color: #ffffff;
        z-index: 1;
      }

      /* CSS ƒë·ªÉ cƒÉn ch·ªânh label t·ªïng s·ªë ti·∫øt */
      .total-label {
        position: relative;
        /* Change this if necessary */
        z-index: 1;
        /* Ensure this is lower than .suggestions */
        margin-top: 10px;
        /* Adjust spacing if needed */
        text-align: right;
      }

      .suggestions {
        position: absolute;
        /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m b√™n tr√™n c√°c th√†nh ph·∫ßn kh√°c */
        top: calc(100% + 5px);
        /* ƒê·∫∑t g·ª£i √Ω ph√≠a tr√™n input v·ªõi m·ªôt kho·∫£ng c√°ch */
        left: 0;
        font-size: 12px;
        background-color: #f0f0f0;
        color: #000;
        border: 1px solid #ccc;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m tr√™n c√°c th√†nh ph·∫ßn kh√°c */
        border-radius: 4px;
        max-height: 300px;
        overflow-y: auto;
      }

      /* Hi·ªáu ·ª©ng lung linh khi hover */
      .suggestions:hover {
        background-color: #e0e0e0;
        /* Thay ƒë·ªïi m√†u n·ªÅn khi hover */
        box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
        /* TƒÉng ƒë·ªô b√≥ng khi hover */
      }

      /* CSS cho t·ª´ng m·ª•c g·ª£i √Ω */
      .suggestion-item {
        padding: 8px 12px;
        /* Kho·∫£ng c√°ch b√™n trong t·ª´ng m·ª•c */
        cursor: pointer;
        /* Con tr·ªè chu·ªôt thay ƒë·ªïi khi hover */
        transition: background-color 0.2s ease;
        /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† khi hover */
      }

      /* Hi·ªáu ·ª©ng khi ng∆∞·ªùi d√πng di chu·ªôt v√†o m·ª•c g·ª£i √Ω */
      .suggestion-item:hover {
        background-color: #f0f0f0;
        /* M√†u n·ªÅn khi hover */
      }

      /* ƒê·∫∑t l·∫°i m·ªôt s·ªë thu·ªôc t√≠nh khi input m·∫•t focus */
      input:focus + .suggestions {
        display: block;
        /* ƒê·∫£m b·∫£o khung hi·ªÉn th·ªã khi input ƒë∆∞·ª£c focus */
      }

      /* ƒê·∫£m b·∫£o container g·ª£i √Ω kh√¥ng b·ªã tr√†n ra ngo√†i khung n·∫øu c√≥ */
      .suggestions {
        overflow: hidden;
      }

      /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·∫£ input[type="date"] v√† input[type="text"] */
      input[type="date"],
      input[type="text"] {
        width: 120px;
        /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y theo mong mu·ªën */
        box-sizing: border-box;
        padding: 5px;
        /* Gi·ªØ padding nh∆∞ c≈© */
      }

      /* ph·∫ßn css cho label t·ªïng s·ªë ti·∫øt  ki*/
      .total-label {
        margin-left: auto;
        /* CƒÉn ph·∫£i cho th·∫ª total-label */
        margin-right: 0;
        font-family: Arial, sans-serif;
        font-size: 16px;
        background-color: #f4f4f4;
        padding: 10px;
        border-radius: 8px;
        width: fit-content;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        display: block;
        /* ƒê·∫£m b·∫£o th·∫ª div l√† kh·ªëi ƒë·ªÉ cƒÉn ph·∫£i ho·∫°t ƒë·ªông */
      }

      .total-label label {
        font-weight: bold;
        /* Gi·ªØ ch·ªØ in ƒë·∫≠m */
        color: #000;
        /* M√†u ch·ªØ ƒëen */
        margin-right: 8px;
        /* Th√™m kho·∫£ng c√°ch b√™n ph·∫£i */
        cursor: pointer;
        /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn v√† m√†u ch·ªØ m·ªÅm m·∫°i */
        padding: 5px 10px;
        /* Th√™m padding cho label ƒë·ªÉ t·∫°o kh√¥ng gian */
        border: 1px solid #ccc;
        /* Khung cho label */
        border-radius: 4px;
        /* Bo g√≥c cho khung */
      }

      .total-label label,
      .total-label label span {
        background-color: #007bff;
        /* M√†u n·ªÅn khi hover */
        color: #fff;
        /* M√†u ch·ªØ tr·∫Øng khi hover */
      }

      .total-label span {
        font-weight: bold;
        /* Gi·ªØ ch·ªØ trong span c≈©ng in ƒë·∫≠m */
        color: #333;
        /* M√†u ch·ªØ ƒë·∫≠m cho gi√° tr·ªã */
      }

      .btn {
        margin-bottom: 0px;
        height: 45px;
      }
    </style>
    <style>
      /* T√πy ch·ªânh danh s√°ch g·ª£i √Ω */
      .ui-autocomplete {
        background: white;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        font-size: 14px;
        padding: 5px;
        width: 200px; /* Gi·∫£m ƒë·ªô r·ªông */
        font-size: 12px !important;
      }

      /* Hi·ªÉn th·ªã ƒë·∫πp h∆°n, kh√¥ng c·∫ßn hover */
      .ui-menu-item {
        padding: 8px;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <!-- Ph·∫ßn header -->
    <%- include('header') %>

    <!-- Ph·∫ßn n·ªôi dung -->

    <div class="container-fluid box m-4">
      <div class="">
        <div class="d-flex">
          <div class="cbb d-flex" style="margin-top: 20px">
            <select class="selectop mx-1" id="combobox-dot">
              <option value="">ƒê·ª£t</option>
            </select>

            <!-- Combo box K·ª≥ -->
            <select class="selectop mx-1" id="comboboxki">
              <option value="">K·ª≥</option>
            </select>

            <!-- Combo box NƒÉm -->
            <select class="selectop mx-1" id="NamHoc">
              <option value="">NƒÉm h·ªçc</option>
            </select>

            <select
              id="loaiHopDong"
              name="loaiHopDong"
              class="w-200px mx-2 selectop"
            >
              <option value="ALL">T·∫•t c·∫£</option>
              <option value="ƒê·∫°i h·ªçc">ƒê·∫°i h·ªçc</option>
              <option value="Sau ƒë·∫°i h·ªçc">Sau ƒë·∫°i h·ªçc</option>
            </select>

            <button id="infoGvm" class="btn text-nowrap mx-2">Hi·ªÉn th·ªã</button>
            <button onclick="submitData()" class="btn mx-2" id="update-qc">
              C·∫≠p nh·∫≠t
            </button>
            <!-- <button onclick="submitData2()" class="btn mx-2" id="save-data-all" style="display: none;">L∆∞u</button> -->
          </div>
        </div>

        <div class="date-all-container" style="display: none">
          <div class="input-group m-2" style="width: 350px" id="batdau">
            <label for="startDate" class="input-group-text">Ng√†y b·∫Øt ƒë·∫ßu</label>
            <input required type="date" id="startDate" class="form-control" />
          </div>
          <div class="input-group m-2" style="width: 350px" id="ketthuc">
            <label for="endDate" class="input-group-text">Ng√†y k·∫øt th√∫c</label>
            <input required type="date" id="endDate" class="form-control" />
          </div>
          <button id="fillDay" class="btn text-nowrap" style="margin: 8px">
            Ch√®n ng√†y
          </button>
        </div>

        <!-- Ph·∫ßn t√¨m ki·∫øm xu·ªëng d∆∞·ªõi -->
        <div class="d-flex my-3" style="height: 70px">
          <input
            type="text"
            id="filterName"
            placeholder="T√¨m theo t√™n gi·∫£ng vi√™n"
            class="form-control m-2 search"
            style="width: 200px"
          />
          <input
            type="text"
            id="filterClass"
            placeholder="T√¨m theo t√™n h·ªçc ph·∫ßn"
            class="form-control m-2 search"
            style="width: 200px"
          />
          <input
            type="text"
            id="filterKhoa"
            placeholder="T√¨m theo khoa"
            class="form-control m-2 search"
            style="width: 200px; display: none"
          />
          <!-- <input type="text" id="filterKhoa" placeholder="T√¨m theo khoa" onclick="showSuggestionsKhoa(this)"
        class="form-control m-2 search" /> -->

          <!-- T√¨m ki·∫øm theo b·ªô m√¥n -->
          <input
            type="text"
            id="filterBoMon"
            placeholder="T√¨m theo t√™n b·ªô m√¥n"
            onkeyup=" showSuggestionsBoMon(this)"
            onclick="showSuggestionsBoMon(this)"
            class="form-control m-2 search"
            style="width: 180px"
          />
        </div>

        <div id="renderInfo">
          <table class="text-center" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 200px">H·ªçc ph·∫ßn</th>
                <th style="width: 50px">S·ªë TC</th>
                <th style="width: 200px">GV theo TKB</th>
                <th style="width: 50px">M·ªùi gi·∫£ng?</th>
                <th style="width: 100px">GV gi·∫£ng d·∫°y</th>
                <th style="width: 50px">Khoa</th>
                <th style="width: 100px">B·ªô m√¥n</th>
                <th style="width: 100px">H·ªá ƒë√†o t·∫°o</th>
                <th>Ng√†y b·∫Øt ƒë·∫ßu</th>
                <th>Ng√†y k·∫øt th√∫c</th>
                <th style="width: 50px">S·ªë ti·∫øt LL</th>
                <th style="width: 50px">S·ªë ti·∫øt QC</th>
                <th style="width: 50px">Ghi ch√∫</th>

                <th style="width: 80px" id="khoaColumn">
                  <div class="form-check d-flex">
                    <input
                      class="check"
                      type="checkbox"
                      id="checkAllKhoa"
                      onclick="checkAll('khoa')"
                    />
                    <label class="form-check-label" for="checkAllKhoa"
                      >Khoa</label
                    >
                  </div>
                </th>
                <th style="width: 50px" id="daoTaoColumn">
                  <div class="form-check d-flex">
                    <input
                      class="check"
                      type="checkbox"
                      id="checkAllDaoTao"
                      onclick="checkAll('daoTao')"
                    />
                    <label
                      class="form-check-label text-nowrap"
                      for="checkAllDaoTao"
                      >ƒê√†o T·∫°o</label
                    >
                  </div>
                </th>
                <th style="width: 50px" id="taiChinhColumn">
                  <div class="form-check d-flex">
                    <input
                      class="check"
                      type="checkbox"
                      id="checkAllTaiChinh"
                      onclick="checkAll('taiChinh')"
                    />
                    <label
                      class="form-check-label text-nowrap"
                      for="checkAllTaiChinh"
                      >T√†i Ch√≠nh</label
                    >
                  </div>
                </th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c ch√®n v√†o ƒë√¢y -->
            </tbody>
          </table>
        </div>
        <!-- Label t·ªïng s·ªë ti·∫øt t√°ch ri√™ng v·ªõi b·∫£ng -->
        <div class="total-label">
          <label
            >T·ªïng s·ªë ti·∫øt L√™n L·ªõp:
            <span class="value" id="totalLL">0</span></label
          >
          <label
            >T·ªïng s·ªë ti·∫øt Quy Chu·∫©n:
            <span class="value" id="totalQC">0</span></label
          >
        </div>
      </div>
    </div>
    <!-- Modal form -->
    <div id="modalBackdrop" style="display: none"></div>
    <!-- N·ªÅn t·ªëi -->
    <div id="noteForm" style="display: none">
      <h3>Ghi ch√∫</h3>
      <label for="noteInput">N·ªôi dung:</label>
      <textarea id="noteInput"></textarea>
      <!-- S·ª≠ d·ª•ng textarea cho ghi ch√∫ d√†i -->
      <br />
      <label for="deadlineInput">H·∫°n:</label>
      <input
        type="date"
        id="deadlineInput"
        style="
          width: 100%;
          padding: 5px;
          border: 1px solid #ccc;
          border-radius: 4px;
        "
      />
      <br />
      <div class="d-flex text-nowrap" style="text-align: right">
        <button onclick="saveNote()">L∆∞u</button>
        <button onclick="doneNote()">Ho√†n Th√†nh</button>
        <button class="cancel" onclick="closeNoteForm()">ƒê√≥ng</button>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Link script Sweet alert 2 -->
    <!-- SweetAlert2 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css"
      rel="stylesheet"
    />

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

    <!-- Th√™m jQuery v√† jQuery UI -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- jQuery UI CSS -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const role = localStorage.getItem("userRole");
        const isKhoa = localStorage.getItem("isKhoa");

        // ·∫®n button import ƒë·ªì √°n
        const importDoAn = document.getElementById("importDoAn");
        const suaHD = document.getElementById("suaHD");

        if (isKhoa == 0 && role == "Duy·ªát") {
          importDoAn.style.display = "block";
          suaHD.style.display = "block";
        }
        // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
        const actionButton = document.getElementById("changeMessage");
        //·∫®n site th√™m th√¥ng b√°o
        if (role === "L√£nh ƒë·∫°o khoa" || role === "Duy·ªát") {
          actionButton.style.display = "";
        } else {
          actionButton.style.display = "none";
        }
      });
    </script>

    <script>
      function filterTable() {
        const nameFilter = document
          .getElementById("filterName")
          .value.toLowerCase();
        const classFilter = document
          .getElementById("filterClass")
          .value.toLowerCase();
        const departmentInput = document
          .getElementById("filterKhoa")
          .value.toLowerCase();
        const boMonFilter = document
          .getElementById("filterBoMon")
          .value.toLowerCase();
        const tableRows = document.querySelectorAll("#tableBody tr");

        tableRows.forEach((row) => {
          const nameCell = row.querySelector("td:nth-child(3)"); // C·ªôt t√™n gi·∫£ng vi√™n
          const classCell = row.querySelector("td:nth-child(1)"); // C·ªôt h·ªçc ph·∫ßn
          const departmentCell = row.querySelector("td:nth-child(6)"); // Khoa
          const boMonInput = row.querySelector(
            'td:nth-child(7) input[name="bomon"]'
          ); // C·ªôt b·ªô m√¥n

          const name = nameCell ? nameCell.textContent.toLowerCase() : "";
          const className = classCell
            ? classCell.textContent.toLowerCase()
            : "";
          const departmentValue = departmentCell
            ? departmentCell.textContent.toLowerCase()
            : "";
          const boMon = boMonInput ? boMonInput.value.toLowerCase() : "";

          // Ki·ªÉm tra ƒëi·ªÅu ki·ªán l·ªçc
          const matchesName = name.includes(nameFilter);
          const matchesClass = className.includes(classFilter);
          const departmentMatch = departmentValue.includes(departmentInput);
          const matchesBoMon = boMon.includes(boMonFilter);

          // Hi·ªán ho·∫∑c ·∫©n h√†ng d·ª±a tr√™n ƒëi·ªÅu ki·ªán l·ªçc
          if (matchesName && matchesClass && departmentMatch && matchesBoMon) {
            row.style.display = ""; // Hi·ªán h√†ng n·∫øu t·∫•t c·∫£ c√°c ƒëi·ªÅu ki·ªán ƒë·ªÅu kh·ªõp
          } else {
            row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        });

        calculateTotals(); // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt sau khi l·ªçc
      }

      // G√°n s·ª± ki·ªán cho c√°c input filter
      document
        .getElementById("filterName")
        .addEventListener("input", filterTable);
      document
        .getElementById("filterClass")
        .addEventListener("input", filterTable);
      document
        .getElementById("filterKhoa")
        .addEventListener("input", filterTable);
      document
        .getElementById("filterBoMon")
        .addEventListener("input", filterTable);
    </script>
    <!-- auto fill  -->
    <script>
      var boMon = [];
      async function loadData() {
        const MaPhongBan = localStorage.getItem("MaPhongBan");

        try {
          const response = await fetch("/api/get-khoa-list", {
            method: "GET",
          });

          if (!response.ok) {
            throw new Error(
              `Error: ${response.status} - ${response.statusText}`
            );
          }

          const phongBanData = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          localStorage.setItem("phongBanList", JSON.stringify(phongBanData));

          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n
        } catch (error) {
          console.error("C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:", error);
        }

        try {
          const response = await fetch("/bo-mon-theo-gv", {
            method: "GET", // Thay ƒë·ªïi th√†nh POST
            // headers: {
            //   'Content-Type': 'application/json'
            // },
            // body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
          });

          if (!response.ok) {
            throw new Error(
              `Error: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          localStorage.setItem("boMonTheoGiangVien", JSON.stringify(data));
          const boMonTheoGiangVien =
            JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n
        } catch (error) {
          console.error("C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:", error);
        }

        try {
          const response = await fetch("/bo-mon", {
            method: "POST", // Thay ƒë·ªïi th√†nh POST
          });

          if (!response.ok) {
            throw new Error(
              `Error: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          boMon = data;
          // localStorage.setItem('boMon', JSON.stringify(data));
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n
        } catch (error) {
          console.error("C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:", error);
        }
      }
      loadData();
    </script>

    <script>
      let globalData = []; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u d·ªØ li·ªáu t·ª´ server
      let nameGv = []; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u t·∫•t c·∫£ t√™n gi·∫£ng vi√™n
      let nameGvm = []; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u t√™n gi·∫£ng vi√™n theo khoa
      let rs = [];

      // H√†m kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
      function init() {
        document.getElementById("infoGvm").addEventListener("click", loadData);
      }

      async function loadData() {
        const MaPhongBan = localStorage.getItem("MaPhongBan");

        try {
          const response = await fetch("/bo-mon-theo-gv", {
            method: "GET", // Thay ƒë·ªïi th√†nh POST
            // headers: {
            //   'Content-Type': 'application/json'
            // },
            // body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
          });

          if (!response.ok) {
            throw new Error(
              `Error: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          localStorage.setItem("boMonTheoGiangVien", JSON.stringify(data));
          const boMonTheoGiangVien =
            JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n
        } catch (error) {
          console.error("C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:", error);
        }

        try {
          const response = await fetch("/bo-mon", {
            method: "POST", // Thay ƒë·ªïi th√†nh POST
          });

          if (!response.ok) {
            throw new Error(
              `Error: ${response.status} - ${response.statusText}`
            );
          }
          // alert(MaPhongBan)
          const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
          // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n
        } catch (error) {
          console.error("C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:", error);
        }

        try {
          // L·∫•y gi√° tr·ªã t·ª´ c√°c combobox
          const dotValue = document.getElementById("combobox-dot").value;
          const kiValue = document.getElementById("comboboxki").value;
          const namValue = document.getElementById("NamHoc").value;
          const he_dao_tao = document.getElementById("loaiHopDong").value;

          // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
          const requestData = {
            Dot: dotValue,
            Ki: kiValue,
            Nam: namValue,
            he_dao_tao: he_dao_tao,
          };

          // Fetch t√™n gi·∫£ng vi√™n m·ªùi
          const [gvmResponse, khoaResponse, teachingResponse] =
            await Promise.all([
              fetch("/gv-cohuu"),
              fetch("/gv-moi"),
              fetch("/xemCacLopMoi", {
                method: "POST", // S·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c POST
                headers: {
                  "Content-Type": "application/json", // ƒê·∫∑t Content-Type l√† application/json
                },
                body: JSON.stringify(requestData), // Chuy·ªÉn ƒë·ªïi ƒë·ªëi t∆∞·ª£ng th√†nh chu·ªói JSON
              }),
            ]);

          if (!gvmResponse.ok || !khoaResponse.ok || !teachingResponse.ok) {
            Swal.fire({
              title: "Th√¥ng b√°o",
              html: "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
              icon: "info",
              confirmButtonText: "OK",
              width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
          }

          // L∆∞u d·ªØ li·ªáu gi·∫£ng vi√™n c√πng v·ªõi m√£ ph√≤ng ban
          nameGv = await gvmResponse.json();

          nameGvm = await khoaResponse.json();
          localStorage.setItem("nameGvm", JSON.stringify(nameGvm));

          rs = await teachingResponse.json();
          // Th√™m check
          globalData = rs.results.map((item) => ({
            ...item,
            ghiChu: "", // Kh·ªüi t·∫°o ghi ch√∫ r·ªóng
          }));

          const check = rs.check; // D·ªØ li·ªáu check
          const DaoTaoCheck = rs.DaoTaoCheck;
          const TaiChinhCheck = rs.TaiChinhCheck;

          localStorage.setItem("check", check);
          localStorage.setItem("DaoTaoCheck", DaoTaoCheck);
          localStorage.setItem("TaiChinhCheck", TaiChinhCheck);

          renderTable(globalData); // G·ªçi h√†m renderTable sau khi ƒë√£ c√≥ ƒë·ªß d·ªØ li·ªáu

          calculateTotals();
        } catch (error) {
          console.error("ƒê√£ c√≥ l·ªói x·∫£y ra:", error);
        }
      }

      // H√†m chuy·ªÉn ƒë·ªãnh d·∫°ng chu·ªói t·ª´ ISO sang ƒë·ªãnh d·∫°ng YYYY-MM-DD
      function formatDateToInput(dateString) {
        if (!dateString) return ""; // Ki·ªÉm tra n·∫øu kh√¥ng c√≥ gi√° tr·ªã

        const utcBatDau = new Date(dateString);
        dateString = utcBatDau.toLocaleDateString("vi-VN"); // Ch·ªâ l·∫•y ph·∫ßn ng√†y

        // Chia t√°ch chu·ªói ng√†y th√†nh c√°c ph·∫ßn: nƒÉm, th√°ng, ng√†y
        const parts = dateString.split("/"); // T√°ch theo d·∫•u '-'
        if (parts.length != 3) return ""; // ƒê·∫£m b·∫£o ƒë·ªãnh d·∫°ng ƒë√∫ng

        const year = parts[2];
        const month = ("0" + parts[1]).slice(-2); // ƒê·∫£m b·∫£o th√°ng c√≥ 2 ch·ªØ s·ªë
        const day = ("0" + parts[0]).slice(-2); // ƒê·∫£m b·∫£o ng√†y c√≥ 2 ch·ªØ s·ªë

        // Tr·∫£ v·ªÅ chu·ªói ng√†y theo ƒë·ªãnh d·∫°ng "YYYY-MM-DD"
        return `${year}-${month}-${day}`;
      }

      // Fill all startDate and endDate
      document.getElementById("fillDay").addEventListener("click", function () {
        const startDateValue = document.getElementById("startDate").value;
        const endDateValue = document.getElementById("endDate").value;

        // Ch·ªâ ti·∫øp t·ª•c n·∫øu ng∆∞·ªùi d√πng ƒë√£ ch·ªçn c·∫£ ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c
        if (!startDateValue || !endDateValue) {
          Swal.fire({
            title: "Th√¥ng b√°o",
            html: "Vui l√≤ng ch·ªçn c·∫£ ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c",
            icon: "info",
            confirmButtonText: "OK",
            width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
            padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
          });
          return;
        }

        // Ch√®n ng√†y b·∫Øt ƒë·∫ßu, b·ªè qua c√°c √¥ b·ªã disable
        document
          .querySelectorAll("input[id^='NgayBatDau_']")
          .forEach((input) => {
            if (!input.disabled && input.offsetParent !== null) {
              input.value = startDateValue;
            }
          });

        // Ch√®n ng√†y k·∫øt th√∫c, b·ªè qua c√°c √¥ b·ªã disable
        document
          .querySelectorAll("input[id^='NgayKetThuc_']")
          .forEach((input) => {
            if (!input.disabled && input.offsetParent !== null) {
              input.value = endDateValue;
            }
          });

        submitData();
      });

      // H√†m render b·∫£ng
      function renderTable(data) {
        const role = localStorage.getItem("userRole");
        const MaPhongBan = localStorage.getItem("MaPhongBan");
        const isKhoa = localStorage.getItem("isKhoa");
        let tableRowData = [];

        const tableBody = document.getElementById("tableBody");
        tableBody.innerHTML = ""; // X√≥a n·ªôi dung c≈©
        //let index = -1;
        data.forEach((row, index) => {
          const tableRow = document.createElement("tr");

          // Th√™m id v√†o d·ªØ li·ªáu row ƒë·ªÉ l∆∞u tr·ªØ
          let rowWithId = {
            id: index,
            ...row,
          };
          tableRowData.push(rowWithId);

          if (row.MoiGiang == 0) {
            tableRow.style.display = "none"; // ·∫®n h√†ng
          }
          tableRow.setAttribute("data-id", row.ID);

          // L·ªõp h·ªçc ph·∫ßn
          const lopHocPhanTd = document.createElement("td");
          lopHocPhanTd.textContent = `${row.LopHocPhan} (${row.TenLop})` || "";
          tableRow.appendChild(lopHocPhanTd);

          // S·ªë t√≠n ch·ªâ
          const soTcTd = document.createElement("td");
          soTcTd.textContent = row.SoTinChi || "";
          tableRow.appendChild(soTcTd);

          // Gi√°o vi√™n theo th·ªùi kh√≥a bi·ªÉu
          const giaoVienTd = document.createElement("td");
          giaoVienTd.textContent = row.GiaoVien || "";
          tableRow.appendChild(giaoVienTd);

          // M·ªùi gi·∫£ng
          const moiGiangTd = document.createElement("td");
          // Thay th·∫ø checkbox b·∫±ng vƒÉn b·∫£n "C√≥" ho·∫∑c "Kh√¥ng"
          const inviteText = document.createElement("span");
          inviteText.textContent = row.MoiGiang ? "C√≥" : "Kh√¥ng";
          moiGiangTd.appendChild(inviteText);
          tableRow.appendChild(moiGiangTd);

          // Chuy·ªÉn √¥ input gi·∫£ng vi√™n th√†nh d·∫°ng xem

          let giaoVienGiangDayTd;
          let giaoVienGiangDayInput;

          giaoVienGiangDayTd = document.createElement("td");
          giaoVienGiangDayInput = document.createElement("input");
          giaoVienGiangDayInput.type = "text";
          giaoVienGiangDayInput.placeholder = "Nh·∫≠p t√™n gi·∫£ng vi√™n";
          giaoVienGiangDayInput.value = row.GiaoVienGiangDay || "";

          giaoVienGiangDayInput.onclick = () => {
            showSuggestions(giaoVienGiangDayInput, index, row.ID);
          };

          giaoVienGiangDayInput.oninput = () => {
            showSuggestions(giaoVienGiangDayInput, index, row.ID);
          };

          // Th√™m id ƒë·ªÉ l·∫•y d·ªØ li·ªáu
          giaoVienGiangDayInput.id = `giaoVienGiangDay_${index}`;

          giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
          tableRow.appendChild(giaoVienGiangDayTd);

          if (isKhoa == 0 || role == "GV") {
            // N·∫øu kh√¥ng ph·∫£i khoa th√¨ ko nh·∫≠p th√¥ng tin gvm
            giaoVienGiangDayInput.disabled = true;
          }

          // Khoa
          const khoaTd = document.createElement("td");
          khoaTd.textContent = row.Khoa || ""; // L·∫•y gi√° tr·ªã Khoa tr·ª±c ti·∫øp t·ª´ row
          tableRow.appendChild(khoaTd);

          let boMonTd;
          let boMonInput;
          boMonTd = document.createElement("td");
          boMonInput = document.createElement("input");
          boMonInput.type = "text";
          boMonInput.name = "bomon";
          boMonInput.value = row.BoMon || "";
          boMonInput.placeholder = "Nh·∫≠p t√™n b·ªô m√¥n";

          // Th√™m id ƒë·ªÉ l·∫•y d·ªØ li·ªáu
          boMonInput.id = `boMon_${index}`;

          // g·ª£i √Ω b·ªô m√¥n
          boMonInput.onclick = () => {
            showSuggestionsBoMon(boMonInput);
          };

          boMonTd.appendChild(boMonInput);
          tableRow.appendChild(boMonTd);

          //Th·∫ª select h√¨nh th·ª©c thi gi·ªØa k·ª≥
          let he_dao_taoTd;
          let he_dao_taoSelect;
          he_dao_taoTd = document.createElement("td");
          he_dao_taoSelect = document.createElement("select");
          he_dao_taoSelect.name = "he_dao_tao";

          // T·∫°o c√°c t√πy ch·ªçn cho select (c√≥ th·ªÉ thay ƒë·ªïi t√πy theo y√™u c·∫ßu)
          const options = [
            { value: "ƒê·∫°i h·ªçc (M·∫≠t m√£)", text: "M·∫≠t m√£" },
            { value: "ƒê·∫°i h·ªçc (ƒê√≥ng h·ªçc ph√≠)", text: "ƒê√≥ng h·ªçc ph√≠" },
            { value: "Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)", text: "Cao h·ªçc" },
            {
              value: "Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)",
              text: "Nghi√™n c·ª©u sinh",
            },
          ];

          // Th√™m c√°c t√πy ch·ªçn v√†o select
          options.forEach((optionData) => {
            const option = document.createElement("option");
            option.value = optionData.value;
            option.textContent = optionData.text;
            if (row.he_dao_tao === optionData.value) {
              option.selected = true;
            }
            he_dao_taoSelect.appendChild(option);
          });
          // Th√™m style tr·ª±c ti·∫øp
          he_dao_taoSelect.style.setProperty(
            "background-color",
            "white",
            "important"
          );
          he_dao_taoSelect.style.setProperty("color", "black", "important");
          he_dao_taoSelect.style.padding = "5px";

          he_dao_taoTd.appendChild(he_dao_taoSelect);
          // Th√™m id ƒë·ªÉ l·∫•y d·ªØ li·ªáu
          he_dao_taoSelect.id = `he_dao_tao-${row.ID}`;
          tableRow.appendChild(he_dao_taoTd);

          // Ki·ªÉm tra ng√†y b·∫Øt ƒë·∫ßu

          const utcBatDau = new Date(row.NgayBatDau);
          const tet = utcBatDau.toLocaleDateString("vi-VN"); // Ch·ªâ l·∫•y ph·∫ßn ng√†y

          // Ng√†y B·∫Øt ƒê·∫ßu
          const NgayBatDauTd = document.createElement("td");
          const NgayBatDauInput = document.createElement("input");
          NgayBatDauInput.type = "date";
          NgayBatDauInput.id = `NgayBatDau_${index}`; // Th√™m id
          NgayBatDauInput.value = formatDateToInput(row.NgayBatDau);
          NgayBatDauTd.appendChild(NgayBatDauInput);
          tableRow.appendChild(NgayBatDauTd);

          // Ng√†y K·∫øt Th√∫c
          const NgayKetThucTd = document.createElement("td");
          const NgayKetThucInput = document.createElement("input");
          NgayKetThucInput.type = "date";
          NgayKetThucInput.id = `NgayKetThuc_${index}`; // Th√™m id
          NgayKetThucInput.value = formatDateToInput(row.NgayKetThuc);
          NgayKetThucTd.appendChild(NgayKetThucInput);
          tableRow.appendChild(NgayKetThucTd);

          // N·∫øu kh√¥ng ph·∫£i khoa -> kh√¥ng c√≥ quy·ªÅn nh·∫≠p
          if (isKhoa == 0) {
            NgayBatDauInput.disabled = true; // Ch·ªâ xem
            NgayKetThucInput.disabled = true; // Ch·ªâ xem
            boMonInput.disabled = true;
            he_dao_taoSelect.disabled = true;
          }

          const soTietLLTd = document.createElement("td");
          soTietLLTd.textContent = row.LL || "";
          tableRow.appendChild(soTietLLTd);

          const soTietQCTd = document.createElement("td");
          soTietQCTd.textContent = row.QuyChuan || "";
          tableRow.appendChild(soTietQCTd);

          // N·∫øu L√£nh ƒë·∫°o khoa ƒë√£ duy·ªát, thi h√†nh s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
          // N·∫øu role l√† gi·∫£ng vi√™n th∆∞·ªùng c≈©ng s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
          if (
            (isKhoa == 1 && role == "GV") ||
            (isKhoa == 1 && row.KhoaDuyet == 1)
          ) {
            giaoVienGiangDayInput.disabled = true;
            boMonInput.disabled = true;
            he_dao_taoSelect.disabled = true;
            NgayBatDauInput.disabled = true;
            // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
            NgayKetThucInput.disabled = true;
          }

          // Ghi ch√∫
          const ghiChuTd = document.createElement("td");
          const ghiChuValue =
            row.GhiChu && row.GhiChu.trim() !== "" ? row.GhiChu : false;
          const deadlineValue = row.Deadline || ""; // L·∫•y gi√° tr·ªã Deadline
          const hoanThanh = row.HoanThanh;
          if (role === "GV" || role === "Th∆∞·ªùng") {
            ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu role l√† GV ho·∫∑c Th∆∞·ªùng
            ghiChuTd.style.cursor = "not-allowed"; // Thay ƒë·ªïi con tr·ªè chu·ªôt th√†nh 'not-allowed' ƒë·ªÉ b√°o hi·ªáu kh√¥ng th·ªÉ t∆∞∆°ng t√°c
            ghiChuTd.title = "B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p"; // Th√™m tooltip ƒë·ªÉ gi·∫£i th√≠ch l√Ω do kh√¥ng th·ªÉ nh·∫•n
          } else {
            if (ghiChuValue) {
              if (hoanThanh) {
                ghiChuTd.innerHTML = `üìú <span class="bi bi-check2-circle" style="color: green;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
              } else {
                ghiChuTd.innerHTML = `üìú <span class="bi bi-circle" style="color: red;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
              }
            } else {
              ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu kh√¥ng c√≥ ghi ch√∫
            }
            ghiChuTd.style.cursor = "pointer"; // Thay ƒë·ªïi con tr·ªè chu·ªôt khi di chu·ªôt qua bi·ªÉu t∆∞·ª£ng
            ghiChuTd.onclick = () =>
              openNoteForm(tableRow, ghiChuValue, deadlineValue); // G·ªçi h√†m m·ªü form khi nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng
          }
          tableRow.appendChild(ghiChuTd); // Th√™m √¥ ghi ch√∫ v√†o h√†ng
          tableBody.appendChild(tableRow);

          let khoaCheckboxTd, khoaCheckbox;
          // Checkbox cho Khoa
          khoaCheckboxTd = document.createElement("td");
          khoaCheckbox = document.createElement("input");
          khoaCheckbox.type = "checkbox";
          khoaCheckbox.style.marginLeft = "30px";
          khoaCheckbox.name = "khoa"; // Th√™m thu·ªôc t√≠nh name
          khoaCheckbox.checked = row.KhoaDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          khoaCheckbox.onchange = () => updateCheckAll("khoa"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          khoaCheckboxTd.appendChild(khoaCheckbox);
          tableRow.appendChild(khoaCheckboxTd);
          // ·∫©n ƒëi
          khoaCheckbox.style.display = "none";

          let daoTaoCheckboxTd, daoTaoCheckbox;

          // Checkbox cho ƒê√†o T·∫°o
          daoTaoCheckboxTd = document.createElement("td");
          daoTaoCheckbox = document.createElement("input");
          daoTaoCheckbox.type = "checkbox";
          daoTaoCheckbox.style.marginLeft = "30px";
          daoTaoCheckbox.name = "daoTao"; // Th√™m thu·ªôc t√≠nh name
          daoTaoCheckbox.checked = row.DaoTaoDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          daoTaoCheckbox.onchange = () => updateCheckAll("daoTao"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          daoTaoCheckboxTd.appendChild(daoTaoCheckbox);
          tableRow.appendChild(daoTaoCheckboxTd);
          // ·∫©n ƒëi
          daoTaoCheckbox.style.display = "none";

          // Checkbox t√†i ch√≠nh
          let taiChinhCheckboxTd, taiChinhCheckbox;

          taiChinhCheckboxTd = document.createElement("td");
          taiChinhCheckbox = document.createElement("input");
          taiChinhCheckbox.type = "checkbox";
          taiChinhCheckbox.style.marginLeft = "30px";
          taiChinhCheckbox.name = "taiChinh"; // Th√™m thu·ªôc t√≠nh name
          taiChinhCheckbox.checked = row.TaiChinhDuyet || false; // D√πng m·ªôt tr∆∞·ªùng cho checkbox
          taiChinhCheckbox.onchange = () => updateCheckAll("taiChinh"); // G·ªçi h√†m khi checkbox thay ƒë·ªïi
          taiChinhCheckboxTd.appendChild(taiChinhCheckbox);
          tableRow.appendChild(taiChinhCheckboxTd);
          // ·∫®n ƒëi
          taiChinhCheckbox.style.display = "none";

          // Hi·ªán checkbox
          if (isKhoa == 1 && role == "L√£nh ƒë·∫°o khoa") {
            khoaCheckbox.style.display = "block";
          } else if (isKhoa == 0 && role == "Duy·ªát") {
            if (MaPhongBan == "DAOTAO") {
              khoaCheckbox.style.display = "block";

              daoTaoCheckbox.style.display = "block";
              taiChinhCheckboxTd.style.display = "none";
            } else if (MaPhongBan == "TAICHINH") {
              // Checkbox cho ƒê√†o T·∫°o
              daoTaoCheckbox.style.display = "block";
              khoaCheckboxTd.style.display = "none";
              // Checkbox cho T√†i Ch√≠nh
              taiChinhCheckbox.style.display = "block";
            }
          }
          const check = localStorage.getItem("check");
          // Ph√¢n quy·ªÅn theo ph√≤ng ban
          if (isKhoa == 1) {
            // N·∫øu l√† khoa
            if (check.includes(MaPhongBan)) {
              //giaoVienGiangDayInput.disabled = true;
              boMonInput.disabled = true;
              he_dao_taoSelect.disabled = true;

              NgayBatDauInput.disabled = true;
              // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
              NgayKetThucInput.disabled = true;
              // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i checkbox
              khoaCheckbox.disabled = true;
              // NgƒÉn checkbox t·ªïng c·ªßa 'khoa' kh√¥ng cho thay ƒë·ªïi
              disableCheckAll("khoa");
            }
          }
          const DaoTaoCheck = localStorage.getItem("DaoTaoCheck");
          const TaiChinhCheck = localStorage.getItem("TaiChinhCheck");

          if (
            MaPhongBan.toLowerCase() === "daotao" &&
            role.toLowerCase() !== "th∆∞·ªùng"
          ) {
            // N·∫øu khoa ƒë√£ check th√¨ hi·ªán check b√™n ƒë√†o t·∫°o
            he_dao_taoSelect.disabled = true;

            if (!check.includes(row.Khoa)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              khoaCheckbox.disabled = true;
              daoTaoCheckbox.disabled = true;
            }

            // N·∫øu ƒë√†o t·∫°o ƒë√£ check th√¨ disable check ƒë√†o t·∫°o
            if (DaoTaoCheck.includes(row.Khoa)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              khoaCheckbox.disabled = true;
              daoTaoCheckbox.disabled = true;
            }
          }

          if (
            MaPhongBan.toLowerCase() === "taichinh" &&
            role.toLowerCase() !== "th∆∞·ªùng"
          ) {
            // N·∫øu khoa ƒë√£ check th√¨ hi·ªán check b√™n ƒë√†o t·∫°o
            if (!DaoTaoCheck.includes(row.Khoa)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              daoTaoCheckbox.disabled = true;
              taiChinhCheckbox.disabled = true;
            }

            // N·∫øu ƒë√†o t·∫°o ƒë√£ check th√¨ disable check ƒë√†o t·∫°o
            if (TaiChinhCheck.includes(row.Khoa)) {
              // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i check box khoa
              daoTaoCheckbox.disabled = true;
              taiChinhCheckbox.disabled = true;
            }
          }
        });
        // L∆∞u d·ªØ li·ªáu v·ªõi id v√†o localStorage
        localStorage.setItem("tableData", JSON.stringify(tableRowData));

        // Th√™m ƒë·ªÉ chuy·ªÉn ki·ªÉu d·ªØ li·ªáu ng√†y th√†nh text khi double click v√†o
        addDoubleClickEvents();
      }

      function addDoubleClickEvents() {
        // get all date input fields
        let dateInputs = document.querySelectorAll('[type="date"]');

        dateInputs.forEach((el) => {
          // register double-click event to change date input to text input and select the value
          el.addEventListener("dblclick", () => {
            el.type = "text";

            // After changing input type with JS, .select() needs a timeout to work
            setTimeout(() => {
              el.select();
            });
          });

          // register the focusout event to reset the input back to a date input field
          el.addEventListener("focusout", () => {
            el.type = "date";
          });
        });
      }

      //
      function disableCheckAll(type) {
        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );

        if (checkAllCheckbox) {
          // NgƒÉn kh√¥ng cho ng∆∞·ªùi d√πng thay ƒë·ªïi checkbox t·ªïng
          checkAllCheckbox.addEventListener("click", function (e) {
            e.preventDefault(); // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i
          });
        }
      }

      // H√†m hi·ªÉn th·ªã g·ª£i √Ω ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
      function showSuggestions(input, id, ID_trongDB) {
        // const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng

        const rawValue = input.value.trim(); // L·∫•y to√†n b·ªô gi√° tr·ªã trong √¥ input
        const values = rawValue.split(",").map((val) => val.trim()); // T√°ch c√°c t√™n ƒë√£ nh·∫≠p
        const value = values.pop().toLowerCase(); // L·∫•y gi√° tr·ªã cu·ªëi c√πng (t√™n m·ªõi nh·∫≠p)
        hideSuggestions(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω m·ªõi

        const bangDuLieu = JSON.parse(localStorage.getItem("tableData")) || [];
        const boMonTheoGiangVien = JSON.parse(
          localStorage.getItem("boMonTheoGiangVien")
        );

        // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
        const suggestionsContainer = document.createElement("div");
        suggestionsContainer.className = "suggestions"; // ƒê·∫∑t class cho khung g·ª£i √Ω

        // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
        const { bottom, left, width } = input.getBoundingClientRect(); // L·∫•y v·ªã tr√≠ c·ªßa input
        suggestionsContainer.style.position = "absolute"; // ƒê·ªÉ ƒë√® l√™n b·∫£ng
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`; // ƒê·∫∑t v·ªã tr√≠ ngay d∆∞·ªõi input
        suggestionsContainer.style.left = `${left + window.scrollX}px`; // CƒÉn tr√°i v·ªõi input
        suggestionsContainer.style.width = `${width}px`; // Chi·ªÅu r·ªông b·∫±ng v·ªõi input
        suggestionsContainer.style.zIndex = "1000"; // ƒê·∫£m b·∫£o lu√¥n hi·ªÉn th·ªã tr√™n c√°c th√†nh ph·∫ßn kh√°c
        suggestionsContainer.style.maxHeight = "200px"; // Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ kh√¥ng qu√° l·ªõn
        suggestionsContainer.style.overflowY = "auto"; // Cho ph√©p cu·ªôn d·ªçc n·∫øu qu√° nhi·ªÅu g·ª£i √Ω

        // Th√™m suggestionsContainer v√†o DOM
        document.body.appendChild(suggestionsContainer); // ƒê·∫∑t suggestionsContainer v√†o body thay v√¨ cha c·ªßa input

        let suggestions = []; // Kh·ªüi t·∫°o m·∫£ng g·ª£i √Ω

        // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
        const nameGvm = JSON.parse(localStorage.getItem("nameGvm")) || []; // Gi·∫£ng vi√™n m·ªùi
        const nameGv = JSON.parse(localStorage.getItem("nameGv")) || []; // Gi·∫£ng vi√™n

        // Ki·ªÉm tra id trong bangDuLieu
        const currentObject = bangDuLieu.find((item) => item.ID === ID_trongDB);
        if (!currentObject) {
          console.warn("Kh√¥ng t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng v·ªõi ID n√†y trong bangDuLieu.");
          return;
        }

        const he_dao_tao = currentObject.he_dao_tao;
        const validhe_dao_tao = [
          "Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)",
          "Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)",
        ];

        // Ki·ªÉm tra ƒëi·ªÅu ki·ªán ƒë·ªÉ g·ª£i √Ω
        if (values.length > 0 && !validhe_dao_tao.includes(he_dao_tao)) {
          console.warn("Kh√¥ng th·ªÉ g·ª£i √Ω t√™n th·ª© 2 do he_dao_tao kh√¥ng h·ª£p l·ªá.");
          suggestionsContainer.remove();
          return;
        }

        // G·ª£i √Ω t·ª´ nameGvm n·∫øu l√† t√™n th·ª© 2 v√† he_dao_tao h·ª£p l·ªá
        if (values.length > 0 && validhe_dao_tao.includes(he_dao_tao)) {
          suggestions = nameGvm
            .map((item) => `${item.HoTen} - ${item.MaPhongBan}`)
            .filter((name) => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
        } else if (values.length === 0) {
          // N·∫øu ch∆∞a c√≥ t√™n n√†o, g·ª£i √Ω t√™n gvm
          suggestions = nameGvm.map(
            (item) => `${item.HoTen} - ${item.MaPhongBan}`
          );
        }

        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return;
        }

        // N·∫øu ng∆∞·ªùi d√πng nh·∫≠p d·ªØ li·ªáu, l·ªçc k·∫øt qu·∫£ theo t√™n gi·∫£ng vi√™n
        if (value) {
          suggestions = suggestions.filter((name) =>
            name.toLowerCase().includes(value)
          );
        }

        // T·∫°o g·ª£i √Ω d∆∞·ªõi d·∫°ng danh s√°ch (list)
        suggestions.forEach((name) => {
          const suggestionItem = document.createElement("div"); // T·∫°o m·ªõi ph·∫ßn t·ª≠ cho g·ª£i √Ω
          suggestionItem.className = "suggestion-item"; // ƒê·∫∑t class cho g·ª£i √Ω
          suggestionItem.textContent = name; // Thi·∫øt l·∫≠p n·ªôi dung cho g·ª£i √Ω

          // Th√™m s·ª± ki·ªán click
          suggestionItem.onclick = function () {
            // input.value = name; // ƒêi·ªÅn t√™n g·ª£i √Ω v√†o √¥ input

            // alert(id)
            // T√¨m ki·∫øm trong bangDuLieu
            const itemIndex = bangDuLieu.findIndex((item) => item.id === id);
            const ID = bangDuLieu[itemIndex].ID;
            // L·∫•y t√™n gi·∫£ng vi√™n t·ª´ g·ª£i √Ω ƒë√£ ch·ªçn
            const selectedName = name.split(" - ")[0]; // T√°ch t√™n ra kh·ªèi m√£ ph√≤ng ban
            // console.log(selectedName)

            // C·∫≠p nh·∫≠t gi√° tr·ªã c·ªßa input
            input.value =
              values.length > 0
                ? `${values.join(", ")}, ${selectedName}`
                : selectedName;

            // So s√°nh v·ªõi boMonTheoGiangVien
            const lecturerFound = boMonTheoGiangVien.find(
              (lecturer) => lecturer.HoTen === selectedName.trim()
            );

            if (lecturerFound) {
              // alert('T√¨m th·∫•y gi·∫£ng vi√™n : ' + lecturerFound.HoTen); // Hi·ªÉn th·ªã th√¥ng b√°o n·∫øu t√¨m th·∫•y

              if (itemIndex !== -1) {
                // Ki·ªÉm tra n·∫øu c√≥ id

                var data = {
                  GiaoVienGiangDay: input.value,
                  BoMon: lecturerFound.MonGiangDayChinh,
                  ID: ID,
                };

                input.value = input.value;
                const boMonInput = document.getElementById(
                  `boMon_${itemIndex}`
                );
                boMonInput.value = lecturerFound.MonGiangDayChinh;
              }

              // G·ª≠i d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t l√™n server
              fetch("/update-name", {
                method: "POST", // Ph∆∞∆°ng th·ª©c POST
                headers: {
                  "Content-Type": "application/json", // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
                },
                body: JSON.stringify(data), // Chuy·ªÉn ƒë·ªïi data ƒë√£ c·∫≠p nh·∫≠t th√†nh chu·ªói JSON
              })
                .then((response) => {
                  if (!response.ok) {
                    throw new Error("L·ªói khi g·ª≠i d·ªØ li·ªáu");
                  }
                  return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
                })
                .then((data) => {
                  console.log(data.message); // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
                })
                .catch((error) => {
                  console.error("C√≥ l·ªói x·∫£y ra:", error);
                });
            }

            hideSuggestions(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
            // loadData(); // load l·∫°i data
            // viewData(); // hi·ªÉn th·ªã b·∫£ng
          };

          suggestionsContainer.appendChild(suggestionItem); // Th√™m suggestionItem v√†o container
        });

        // H√†m ƒë·ªãnh d·∫°ng ng√†y th√†nh chu·ªói YYYY-MM-DD
        function format(dateStr) {
          const date = new Date(dateStr);
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, "0");
          const day = String(date.getDate()).padStart(2, "0");
          return `${year}-${month}-${day}`;
        }

        // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
        input.onblur = function () {
          setTimeout(() => {
            hideSuggestions();
          }, 100); // Th·ªùi gian ch·ªù ƒë·ªÉ nh·∫≠n di·ªán click
        };
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestions() {
        const existingSuggestions = document.querySelectorAll(".suggestions");
        existingSuggestions.forEach((suggestion) => suggestion.remove());
      }

      //
      async function submitData() {
        const isKhoa = localStorage.getItem("isKhoa");
        const role = localStorage.getItem("userRole");
        const MaPhongBan = localStorage.getItem("MaPhongBan");
        const rows = document.querySelectorAll("#tableBody tr"); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

        rows.forEach((row, index) => {
          // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
          //if (row.style.display === 'none') {
          //  return;
          //}

          // L·∫•y gi√° tr·ªã nh·∫≠p v√†o
          //const giaoVienGiangDayInput = row.querySelector('input[type="text"][placeholder="Nh·∫≠p t√™n gi·∫£ng vi√™n"]');
          const giaoVienGiangDayInput = document.getElementById(
            `giaoVienGiangDay_${index}`
          );
          const giaoVienGiangDay = giaoVienGiangDayInput
            ? giaoVienGiangDayInput.value
            : "";

          // L·∫•y gi√° tr·ªã c·ªßa √¥ nh·∫≠p "b·ªô m√¥n"
          const boMonInput = document.getElementById(`boMon_${index}`);
          const boMon = boMonInput ? boMonInput.value : "";

          // L·∫•y gi√° tr·ªã "Ng√†y B·∫Øt ƒê·∫ßu" cho t·ª´ng h√†ng
          const ngayBatDauInput = document.getElementById(
            `NgayBatDau_${index}`
          );
          const ngayBatDauValue = ngayBatDauInput ? ngayBatDauInput.value : "";

          // L·∫•y gi√° tr·ªã "Ng√†y K·∫øt Th√∫c" cho t·ª´ng h√†ng
          const ngayKetThucInput = document.getElementById(
            `NgayKetThuc_${index}`
          );
          const ngayKetThucValue = ngayKetThucInput
            ? ngayKetThucInput.value
            : "";

          // L·∫•y gi√° tr·ªã c·ªßa checkbox "Khoa", "ƒê√†o T·∫°o", v√† "T√†i Ch√≠nh"
          const khoaCheckbox = row.querySelector(
            'input[type="checkbox"][name="khoa"]'
          );
          const daoTaoCheckbox = row.querySelector(
            'input[type="checkbox"][name="daoTao"]'
          );
          const taiChinhCheckbox = row.querySelector(
            'input[type="checkbox"][name="taiChinh"]'
          );

          // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "Khoa"
          let khoaDuyet = khoaCheckbox ? khoaCheckbox.checked : false;

          // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "ƒê√†o T·∫°o"
          const daoTaoDuyet = daoTaoCheckbox ? daoTaoCheckbox.checked : false;

          // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "T√†i Ch√≠nh"
          let taiChinhDuyet = taiChinhCheckbox
            ? taiChinhCheckbox.checked
            : false;

          /*
      // ƒêi·ªÅu ch·ªânh theo role
      if (MaPhongBan == 'DAOTAO' && role == 'Duy·ªát') {
        // Khi role l√† DAOTAO_ALL
        khoaDuyet = khoaCheckbox ? khoaCheckbox.checked : false; // C·∫≠p nh·∫≠t Khoa
      } else if (MaPhongBan == 'TAICHINH' && role == 'Duy·ªát') {
        // Khi role l√† TAICHINH_ALL
        khoaDuyet = globalData[index].KhoaDuyet; // Gi·ªØ nguy√™n gi√° tr·ªã c≈© c·ªßa Khoa
        
        taiChinhDuyet = taiChinhCheckbox ? taiChinhCheckbox.checked : false; // C·∫≠p nh·∫≠t T√†i Ch√≠nh
      }
*/
          if (isKhoa == 1) {
            // C·∫≠p nh·∫≠t v√†o m·∫£ng globalData t∆∞∆°ng ·ª©ng v·ªõi ch·ªâ m·ª•c h√†ng (index)

            globalData[index].GiaoVienGiangDay = giaoVienGiangDay;

            globalData[index].BoMon = boMon;
            globalData[index].NgayBatDau = ngayBatDauValue;
            globalData[index].NgayKetThuc = ngayKetThucValue;
          }

          globalData[index].KhoaDuyet = khoaDuyet; // C·∫≠p nh·∫≠t Khoa

          globalData[index].DaoTaoDuyet = daoTaoDuyet; // C·∫≠p nh·∫≠t ƒê√†o T·∫°o

          globalData[index].TaiChinhDuyet = taiChinhDuyet; // C·∫≠p nh·∫≠t T√†i Ch√≠nh
        });

        // G·ª≠i d·ªØ li·ªáu l√™n server

        fetch("/check-teaching-gvm", {
          method: "POST", // Ph∆∞∆°ng th·ª©c POST
          headers: {
            "Content-Type": "application/json", // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
          },
          body: JSON.stringify(globalData), // Chuy·ªÉn ƒë·ªïi globalData th√†nh chu·ªói JSON
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("L·ªói khi g·ª≠i d·ªØ li·ªáu");
            }
            return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
          })
          .then((data) => {
            // console.log('D·ªØ li·ªáu ph·∫£n h·ªìi t·ª´ server:', data);
            Swal.fire({
              title: "Th√¥ng b√°o",
              html: data.message,
              icon: "info",
              confirmButtonText: "OK",
              width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
          })
          .catch((error) => {
            console.error("C√≥ l·ªói x·∫£y ra:", error);
            Swal.fire({
              title: "Th√¥ng b√°o",
              html: "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu",
              icon: "error",
              confirmButtonText: "OK",
              width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
          });
      }

      // H√†m applyFilters ƒë·ªÉ ƒë·ªìng nh·∫•t c·∫£ ba b·ªô l·ªçc
      function applyFilters() {
        const nameFilter = document
          .getElementById("filterName")
          .value.toLowerCase();
        const classFilter = document
          .getElementById("filterClass")
          .value.toLowerCase();
        const khoaFilter = document
          .getElementById("filterBoMon")
          .value.toLowerCase();
        const tableRows = document.querySelectorAll("#tableBody tr");

        tableRows.forEach((row) => {
          const nameCell = row.querySelector("td:nth-child(3)"); // C·ªôt t√™n gi·∫£ng vi√™n
          const classCell = row.querySelector("td:nth-child(1)"); // C·ªôt h·ªçc ph·∫ßn
          const khoaCell = row.querySelector("td:nth-child(6)"); // C·ªôt b·ªô m√¥n

          // Ki·ªÉm tra kh·ªõp v·ªõi t·ª´ng b·ªô l·ªçc, √°p d·ª•ng v·ªõi t·∫•t c·∫£ c√°c √¥ l·ªçc c√πng l√∫c
          const nameMatch =
            !nameFilter ||
            (nameCell &&
              nameCell.textContent.toLowerCase().includes(nameFilter));
          const classMatch =
            !classFilter ||
            (classCell &&
              classCell.textContent.toLowerCase().includes(classFilter));
          const khoaMatch =
            !khoaFilter ||
            (khoaCell &&
              khoaCell.textContent.toLowerCase().includes(khoaFilter));

          // Ch·ªâ hi·ªÉn th·ªã h√†ng n·∫øu t·∫•t c·∫£ b·ªô l·ªçc ƒë·ªÅu kh·ªõp
          row.style.display =
            nameMatch && classMatch && khoaMatch ? "" : "none";
        });

        calculateTotals();
      }

      // G·ªçi applyFilters trong c√°c h√†m l·ªçc ri√™ng ƒë·ªÉ ƒë·ªìng b·ªô
      function filterByName() {
        applyFilters();
      }

      function filterByClass() {
        applyFilters();
      }

      function filterBoMon() {
        applyFilters();
      }

      function filterByKhoa() {
        const input = document.getElementById("filterKhoa");
        const filter = input.value.toLowerCase();
        const tableRows = document.querySelectorAll("#tableBody tr");

        // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
        if (!filter) {
          tableRows.forEach((row) => {
            row.style.display = ""; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
          });
          return;
        }

        // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ khoa kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
        tableRows.forEach((row) => {
          const nameCell = row.querySelector("td:nth-child(6)"); // Khoa n·∫±m ·ªü c·ªôt th·ª© 6
          const name = nameCell.textContent.toLowerCase();

          if (name.includes(filter)) {
            row.style.display = ""; // Hi·ªán h√†ng n·∫øu kh·ªõp
          } else {
            row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        });
        calculateTotals();
      }

      function showSuggestionsBoMon(input) {
        $(input).autocomplete({
          source: function (request, response) {
            const value = request.term.toLowerCase();
            const boMon = JSON.parse(localStorage.getItem("boMon")) || [];

            suggestions = boMon.map(
              (item) => `${item.TenBoMon} - ${item.MaBoMon}`
            );

            if (value) {
              suggestions = suggestions.filter((name) =>
                name.toLowerCase().includes(value)
              );
            }

            response(suggestions);
          },
          minLength: 0,
          select: function (event, ui) {
            let parts = ui.item.value.split("-");
            let processedName = parts[1].trim();

            $(input).val(processedName); // G√°n gi√° tr·ªã v√†o input ƒë∆∞·ª£c truy·ªÅn v√†o
            return false;
          },
        });

        $(input).on("focus", function () {
          $(this).autocomplete("search", "");
        });
      }

      /*
      // H√†m g·ª£i √Ω b·ªô m√¥n v·ªõi c·∫£i ti·∫øn cho vi·ªác ƒëi·ªÅn gi√° tr·ªã v√†o input
      function showSuggestionsBoMon(input) {
        const value = input.value.toLowerCase();
        hideSuggestionsBoMon();

        const suggestionsContainer = document.createElement("div");
        suggestionsContainer.className = "suggestions";

        const { bottom, left, width } = input.getBoundingClientRect();
        suggestionsContainer.style.position = "absolute";
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`;
        suggestionsContainer.style.left = `${left + window.scrollX}px`;
        suggestionsContainer.style.width = `${width}px`;
        suggestionsContainer.style.zIndex = "1000";
        suggestionsContainer.style.maxHeight = "200px";
        suggestionsContainer.style.overflowY = "auto";

        document.body.appendChild(suggestionsContainer);

        let suggestions = [];
        // const boMon = JSON.parse(localStorage.getItem("boMon")) || [];
        console.log(boMon);

        suggestions = boMon.map((item) => `${item.TenBoMon} - ${item.MaBoMon}`);

        if (value) {
          suggestions = suggestions.filter((name) =>
            name.toLowerCase().includes(value)
          );
        }

        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return;
        }

        suggestions.forEach((name) => {
          const suggestionItem = document.createElement("div");
          suggestionItem.className = "suggestion-item";
          suggestionItem.textContent = name;

          suggestionItem.onclick = function () {
            const dashIndex = name.indexOf("-");
            let processedName = name;

            if (dashIndex !== -1) {
              processedName = name
                .slice(dashIndex + 1)
                .trim()
                .replace(/\s+/g, "");
            }

            input.value = processedName;
            filterBoMon(); // √Åp d·ª•ng b·ªô l·ªçc sau khi ch·ªçn g·ª£i √Ω
            hideSuggestionsBoMon();
          };

          suggestionsContainer.appendChild(suggestionItem);
        });

        input.onblur = function () {
          setTimeout(() => {
            hideSuggestionsBoMon();
          }, 100);
        };
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestionsBoMon() {
        const suggestions = document.querySelectorAll(".suggestions");
        suggestions.forEach((suggestion) => suggestion.remove());
      }
*/
      // H√†m t√≠nh t·ªïng s·ªë ti·∫øt t·ª´ globalData
      function calculateTotals() {
        let totalLL = 0; // Reset t·ªïng s·ªë ti·∫øt LL
        let totalQC = 0; // Reset t·ªïng s·ªë ti·∫øt QC

        const rows = document.querySelectorAll("#tableBody tr"); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

        rows.forEach((row) => {
          // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
          if (row.style.display === "none") {
            return;
          }

          // Gi·∫£ s·ª≠ c·ªôt LL l√† c·ªôt th·ª© 2 v√† c·ªôt QuyChuan l√† c·ªôt th·ª© 3
          const LLCell = row.querySelector("td:nth-child(11)"); // L·∫•y √¥ c·ªßa c·ªôt LL
          const QuyChuanCell = row.querySelector("td:nth-child(12)"); // L·∫•y √¥ c·ªßa c·ªôt QuyChuan

          // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã c·ªßa c√°c √¥ th√†nh s·ªë v√† c·ªông d·ªìn
          const LL = parseFloat(LLCell.textContent) || 0; // N·∫øu kh√¥ng ph·∫£i s·ªë, m·∫∑c ƒë·ªãnh l√† 0
          const QuyChuan = parseFloat(QuyChuanCell.textContent) || 0;

          totalLL += LL; // C·ªông d·ªìn s·ªë ti·∫øt LL
          totalQC += QuyChuan; // C·ªông d·ªìn s·ªë ti·∫øt QC
        });

        // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt v√†o HTML
        document.getElementById("totalLL").textContent = totalLL.toFixed(2);
        document.getElementById("totalQC").textContent = totalQC.toFixed(2);
      }
      /*
    function checkAll(type) {
      const checkboxes = document.querySelectorAll(
        `input[type="checkbox"][name="${type}"]`
      );
      const checkAllCheckbox = document.getElementById(
        `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
      );
  
      checkboxes.forEach((checkbox) => {
        if (!checkbox.disabled) { // Ki·ªÉm tra xem checkbox c√≥ b·ªã v√¥ hi·ªáu h√≥a kh√¥ng
          checkbox.checked = checkAllCheckbox.checked;
        }
      });
    }
  */

      function checkAll(type) {
        const checkboxes = document.querySelectorAll(
          `input[type="checkbox"][name="${type}"]`
        );
        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );

        for (const checkbox of checkboxes) {
          if (checkbox.disabled || !checkbox.offsetParent) {
            continue; // B·ªè qua checkbox b·ªã v√¥ hi·ªáu h√≥a
          }

          const row = checkbox.closest("tr");
          if (row.style.display == "none") {
            // Ki·ªÉm tra n·∫øu d√≤ng hi·ªán tr√™n m√†n h√¨nh
            continue; // G√°n tr·∫°ng th√°i checkbox "Check All" cho checkbox hi·ªÉn th·ªã
          }

          checkbox.checked = checkAllCheckbox.checked; // G√°n gi√° tr·ªã checked cho checkbox kh√¥ng b·ªã v√¥ hi·ªáu h√≥a
        }
      }

      // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All" khi checkbox c√° nh√¢n ƒë∆∞·ª£c ch·ªçn
      function updateCheckAll(type) {
        const checkboxes = document.querySelectorAll(
          `input[type="checkbox"][name="${type}"]`
        );
        const checkAllCheckbox = document.getElementById(
          `checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`
        );

        // Ki·ªÉm tra n·∫øu t·∫•t c·∫£ checkbox c√° nh√¢n ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn
        const allChecked = Array.from(checkboxes).every(
          (checkbox) => checkbox.checked
        );
        checkAllCheckbox.checked = allChecked; // C·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All"
      }

      // H√†m x·ª≠ l√Ω t√¨m ki·∫øm theo t√™n b·ªô m√¥n
      function filterBoMon() {
        const input = document.getElementById("filterBoMon");
        const filter = input.value.trim().toLowerCase(); // B·ªè kho·∫£ng tr·∫Øng v√† chuy·ªÉn ch·ªØ th∆∞·ªùng
        const tableRows = document.querySelectorAll("#tableBody tr");

        tableRows.forEach((row) => {
          const nameInput = row.querySelector(
            'td:nth-child(7) input[name="bomon"]'
          ); // L·∫•y input c√≥ name="bomon" ·ªü c·ªôt th·ª© 7
          const checkbox = row.querySelector('input[type="checkbox"]');

          if (nameInput) {
            const name = nameInput.value.toLowerCase(); // L·∫•y gi√° tr·ªã c·ªßa input c√≥ name="bomon"
            if (filter === "" || name.includes(filter)) {
              row.style.display = ""; // Hi·ªán h√†ng n·∫øu kh·ªõp ho·∫∑c filter tr·ªëng
            } else {
              row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
            }
          }
        });
        calculateTotals();
      }

      // Kh·ªüi t·∫°o s·ª± ki·ªán khi nh·∫≠p v√†o √¥ input (ho·∫∑c g·∫Øn s·ª± ki·ªán v√†o c√°c input c·ª• th·ªÉ)
      document
        .getElementById("filterBoMon")
        .addEventListener("input", function () {
          showSuggestionsBoMon(this);
          showSuggestionsKhoa(this);
        });

      // Kh·ªüi t·∫°o s·ª± ki·ªán c·ªßa khoa

      // H√†m kh·ªüi ƒë·ªông ·ª©ng d·ª•ng
      init();
    </script>

    <!-- l·ªçc b·ªô m√¥n -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // H√†m g·ª£i √Ω b·ªô m√¥n ·ªü √¥ nh·∫≠p
        function showSuggestionsBoMon(input) {
          const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
          hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω m·ªõi

          // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
          const suggestionsContainer = document.createElement("div");
          suggestionsContainer.className = "suggestions"; // ƒê·∫∑t class cho khung g·ª£i √Ω

          // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
          const { bottom, left, width } = input.getBoundingClientRect(); // L·∫•y v·ªã tr√≠ c·ªßa input
          suggestionsContainer.style.position = "absolute"; // ƒê·ªÉ ƒë√® l√™n b·∫£ng
          suggestionsContainer.style.top = `${bottom + window.scrollY}px`; // ƒê·∫∑t v·ªã tr√≠ ngay d∆∞·ªõi input
          suggestionsContainer.style.left = `${left + window.scrollX}px`; // CƒÉn tr√°i v·ªõi input
          suggestionsContainer.style.width = `${width}px`; // Chi·ªÅu r·ªông b·∫±ng v·ªõi input
          suggestionsContainer.style.zIndex = "1000"; // ƒê·∫£m b·∫£o lu√¥n hi·ªÉn th·ªã tr√™n c√°c th√†nh ph·∫ßn kh√°c
          suggestionsContainer.style.maxHeight = "200px"; // Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ kh√¥ng qu√° l·ªõn
          suggestionsContainer.style.overflowY = "auto"; // Cho ph√©p cu·ªôn d·ªçc n·∫øu qu√° nhi·ªÅu g·ª£i √Ω

          // Th√™m suggestionsContainer v√†o DOM
          document.body.appendChild(suggestionsContainer); // ƒê·∫∑t suggestionsContainer v√†o body thay v√¨ cha c·ªßa input

          let suggestions = []; // Kh·ªüi t·∫°o m·∫£ng g·ª£i √Ω

          // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
          const boMon = JSON.parse(localStorage.getItem("boMon")) || []; // Gi·∫£ng vi√™n m·ªùi

          suggestions = boMon.map(
            (item) => `${item.TenBoMon} - ${item.MaBoMon}`
          );

          // N·∫øu ng∆∞·ªùi d√πng nh·∫≠p d·ªØ li·ªáu, l·ªçc k·∫øt qu·∫£ theo t√™n gi·∫£ng vi√™n
          if (value) {
            suggestions = suggestions.filter((name) =>
              name.toLowerCase().includes(value)
            );
          }

          // N·∫øu kh√¥ng c√≥ g·ª£i √Ω, ·∫©n container
          if (suggestions.length === 0) {
            suggestionsContainer.remove();
            return; // K·∫øt th√∫c h√†m n·∫øu kh√¥ng c√≥ g·ª£i √Ω
          }

          // T·∫°o g·ª£i √Ω d∆∞·ªõi d·∫°ng danh s√°ch (list)
          suggestions.forEach((name) => {
            const suggestionItem = document.createElement("div"); // T·∫°o ph·∫ßn t·ª≠ cho t·ª´ng g·ª£i √Ω
            suggestionItem.className = "suggestion-item"; // ƒê·∫∑t class ƒë·ªÉ t√πy ch·ªânh giao di·ªán
            suggestionItem.textContent = name; // Hi·ªÉn th·ªã t√™n gi·∫£ng vi√™n k√®m theo khoa

            // Th√™m s·ª± ki·ªán click ƒë·ªÉ ƒëi·ªÅn t√™n v√†o √¥ input
            suggestionItem.onclick = function () {
              const name = suggestionItem.innerText; // Ho·∫∑c c√≥ th·ªÉ l√† suggestionItem.textContent
              const dashIndex = name.indexOf("-");
              let processedName = name;

              if (dashIndex !== -1) {
                // L·∫•y ph·∫ßn sau d·∫•u "-" v√† lo·∫°i b·ªè kho·∫£ng tr·∫Øng
                processedName = name
                  .slice(dashIndex + 1)
                  .trim()
                  .replace(/\s+/g, "");
              }

              // ƒêi·ªÅn t√™n g·ª£i √Ω ƒë√£ x·ª≠ l√Ω v√†o √¥ input
              input.value = processedName;
              filterBoMon();
              hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
            };

            suggestionsContainer.appendChild(suggestionItem); // Th√™m m·ª•c v√†o danh s√°ch g·ª£i √Ω
          });

          // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
          input.onblur = function () {
            setTimeout(() => {
              hideSuggestionsBoMon();
            }, 100); // Th·ªùi gian ch·ªù ƒë·ªÉ nh·∫≠n di·ªán click
          };
        }

        // H√†m ·∫©n g·ª£i √Ω
        function hideSuggestionsBoMon() {
          const existingSuggestions = document.querySelectorAll(".suggestions");
          existingSuggestions.forEach((suggestion) => suggestion.remove());
        }

        // H√†m x·ª≠ l√Ω t√¨m ki·∫øm theo t√™n b·ªô m√¥n
        function filterBoMon() {
          const input = document.getElementById("filterBoMon");
          const filter = input.value.trim().toLowerCase(); // B·ªè kho·∫£ng tr·∫Øng v√† chuy·ªÉn ch·ªØ th∆∞·ªùng
          const tableRows = document.querySelectorAll("#tableBody tr");

          tableRows.forEach((row) => {
            const nameInput = row.querySelector(
              'td:nth-child(7) input[name="bomon"]'
            ); // L·∫•y input c√≥ name="bomon" ·ªü c·ªôt th·ª© 7
            const checkbox = row.querySelector('input[type="checkbox"]');

            if (nameInput) {
              const name = nameInput.value.toLowerCase(); // L·∫•y gi√° tr·ªã c·ªßa input c√≥ name="bomon"
              if (filter === "" || name.includes(filter)) {
                row.style.display = ""; // Hi·ªán h√†ng n·∫øu kh·ªõp ho·∫∑c filter tr·ªëng
                //checkbox.disabled = false; // K√≠ch ho·∫°t checkbox
              } else {
                row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
                //checkbox.disabled = true; // V√¥ hi·ªáu h√≥a checkbox
              }
            }
          });
          calculateTotals();
        }

        // Kh·ªüi t·∫°o s·ª± ki·ªán khi nh·∫≠p v√†o √¥ input (ho·∫∑c g·∫Øn s·ª± ki·ªán v√†o c√°c input c·ª• th·ªÉ)
        document
          .getElementById("filterBoMon")
          .addEventListener("input", function () {
            showSuggestionsBoMon(this);
          });
      });
    </script>

    <!-- Ph·∫ßn ph√¢n quy·ªÅn -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="ThongTinGD"
        const ThongTinGD = document.getElementById("ThongTinGD");

        ThongTinGD.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

          const isKhoa = localStorage.getItem("isKhoa"); // L·∫•y role t·ª´ localStorage

          if (isKhoa == 0) {
            // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/info2";
          } else {
            window.location.href = "/info";
          }
        });

        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="Home"

        const Home = document.getElementById("Home");

        Home.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

          const isKhoa = localStorage.getItem("isKhoa");

          if (isKhoa == 0) {
            // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/maindt";
          } else {
            window.location.href = "/mainkhoa";
          }
        });

        ///
        const role = localStorage.getItem("userRole");
        const MaPhongBan = localStorage.getItem("MaPhongBan");
        const isKhoa = localStorage.getItem("isKhoa");

        // N·∫øu l√† ph√≤ng ban th√¨ hi·ªán l·ªçc theo khoa
        if (isKhoa == 0) {
          document.getElementById("filterKhoa").style.display = "block";
        }

        if (role == "Th∆∞·ªùng" || role.includes("GV")) {
          // ·∫®n t·∫•t c·∫£ c√°c c·ªôt
          document.getElementById("khoaColumn").style.display = "none";
          document.getElementById("daoTaoColumn").style.display = "none";
          document.getElementById("taiChinhColumn").style.display = "none";
          if (!role.includes("CNBM")) {
            document.getElementById("update-qc").style.display = "none";
          }
        }

        if (isKhoa == 1 && role == "L√£nh ƒë·∫°o khoa") {
          document.getElementById("daoTaoColumn").style.display = "none";
          document.getElementById("taiChinhColumn").style.display = "none";

          document.getElementById("khoaColumn").style.display = "block";
        } else if (isKhoa == 0 && role == "Duy·ªát") {
          if (MaPhongBan == "DAOTAO") {
            // ·∫®n c·ªôt 'taiChinhColumn'
            document.getElementById("taiChinhColumn").style.display = "none";
            document.getElementById("update-qc").style.display = "inline-block"; // S·ª≠ d·ª•ng 'inline-block' ƒë·ªÉ hi·ªÉn th·ªã n√∫t
          } else if (MaPhongBan == "TAICHINH") {
            // ·∫®n c·ªôt 'khoaColumn'
            document.getElementById("khoaColumn").style.display = "none";
            document.getElementById("update-qc").style.display = "inline-block"; // S·ª≠ d·ª•ng 'inline-block' ƒë·ªÉ hi·ªÉn th·ªã n√∫t
            // Hi·ªÉn th·ªã n√∫t 'C·∫≠p nh·∫≠t'
            //document.getElementById('save-data-all').style.display = 'inline-block'; // S·ª≠ d·ª•ng 'inline-block' ƒë·ªÉ hi·ªÉn th·ªã n√∫t
          }
        }

        // Ph√¢n quy·ªÅn, n·∫øu kh√¥ng c√≥ quy·ªÅn khoa ch·ªânh s·ª≠a s·∫Ω ·∫©n ng√†y all ƒëi
        const dateContainer = document.querySelector(".date-all-container");
        if (isKhoa == 1 && role != "GV") {
          dateContainer.style.display = "flex";
        }
      });
    </script>

    <script>
      document
        .getElementById("changePasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

          if (tenDangNhap) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
            window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(
              tenDangNhap
            )}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
          }
        });
    </script>
    <script>
      let currentRow; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u h√†ng hi·ªán t·∫°i

      function openNoteForm(row, GhiChu, Deadline) {
        currentRow = row; // L∆∞u h√†ng hi·ªán t·∫°i
        document.getElementById("noteForm").style.display = "block"; // Hi·ªÉn th·ªã form
        document.getElementById("modalBackdrop").style.display = "block"; // Hi·ªÉn th·ªã n·ªÅn t·ªëi

        // Hi·ªÉn th·ªã gi√° tr·ªã ghi ch√∫ v√† h·∫°n
        document.getElementById("noteInput").value = GhiChu || ""; // Hi·ªÉn th·ªã ghi ch√∫
        document.getElementById("deadlineInput").value =
          formatInputDate(Deadline) || ""; // Hi·ªÉn th·ªã h·∫°n
      }

      function closeNoteForm() {
        document.getElementById("noteForm").style.display = "none"; // ·∫®n form
        document.getElementById("modalBackdrop").style.display = "none"; // ·∫®n n·ªÅn t·ªëi
      }
      window.onclick = function (event) {
        const modal = document.getElementById("noteForm");
        const modalBackdrop = document.getElementById("modalBackdrop");
        if (event.target === modalBackdrop) {
          closeNoteForm();
        }
      };
      async function saveNote() {
        const note = document.getElementById("noteInput").value;
        const deadline = document.getElementById("deadlineInput").value;

        if (currentRow) {
          const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng

          // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
          if (id) {
            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
            try {
              const response = await fetch("/savenote", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ id, ghiChu: note, deadline }),
              });
              const result = await response.json();
              if (!result.success) {
                Swal.fire({
                  title: "Th√¥ng b√°o",
                  html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                  icon: "success",
                  confirmButtonText: "OK",
                  width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              } else {
                Swal.fire({
                  title: "Th√¥ng b√°o",
                  html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                  icon: "success",
                  confirmButtonText: "OK",
                  width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              }
            } catch (error) {
              alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
            }
          } else {
            alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
          }
        } else {
          alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
        }

        closeNoteForm();
      }
      async function doneNote() {
        const note = document.getElementById("noteInput").value;
        const deadline = document.getElementById("deadlineInput").value;

        if (currentRow) {
          const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng

          // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
          if (id) {
            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
            try {
              const response = await fetch("/donenote", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({ id, ghiChu: note, deadline }),
              });
              const result = await response.json();
              if (!result.success) {
                Swal.fire({
                  title: "Th√¥ng b√°o",
                  html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                  icon: "error",
                  confirmButtonText: "OK",
                  width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              } else {
                Swal.fire({
                  title: "Th√¥ng b√°o",
                  html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                  icon: "success",
                  confirmButtonText: "OK",
                  width: "auto", // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: "20px", // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              }
            } catch (error) {
              alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
            }
          } else {
            alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
          }
        } else {
          alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
        }

        closeNoteForm();
      }

      // H√†m ƒë·ªÉ chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y
      function formatInputDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0"); // L·∫•y th√°ng (0-11) v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë
        const day = String(date.getDate()).padStart(2, "0"); // L·∫•y ng√†y v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë

        return `${year}-${month}-${day}`; // Tr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng yyyy-mm-dd cho input
      }

      // S·ª± ki·ªán click ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
      window.onclick = function (event) {
        const modal = document.getElementById("noteForm");
        const modalBackdrop = document.getElementById("modalBackdrop");
        if (event.target === modalBackdrop) {
          closeNoteForm();
        }
      };
    </script>
    <script>
      $(document).ready(function () {
        $('#NamHoc option[value=""]').remove();
        $('#comboboxki option[value=""]').remove();
        $('#combobox-dot option[value=""]').remove();

        $.ajax({
          url: "/getNamHoc",
          method: "GET",
          success: function (response) {
            if (response.success) {
              response.NamHoc.forEach(function (item) {
                $("#NamHoc").append(
                  `<option value="${item.NamHoc}">${item.NamHoc}</option>`
                );
              });

              response.Ki.forEach(function (item) {
                $("#comboboxki").append(
                  `<option value="${item.value}">${item.Ki}</option>`
                );
              });
              response.Dot.forEach(function (item) {
                $("#combobox-dot").append(
                  `<option value="${item.value}">${item.Dot}</option>`
                );
              });
            } else {
              console.error(
                "Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu nƒÉm h·ªçc:",
                response.message
              );
            }
          },
          error: function (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu nƒÉm h·ªçc:", error);
          },
        });
      });
    </script>

    <script>
      // ƒê·ªãnh nghƒ©a h√†m showSuggestionsKhoa ·ªü ph·∫°m vi to√†n c·ª•c
      function showSuggestionsKhoa(input) {
        const value = input.value.toLowerCase();
        hideSuggestionsKhoa();

        const suggestionsContainer = document.createElement("div");
        suggestionsContainer.className = "suggestions";

        const { bottom, left, width } = input.getBoundingClientRect();
        suggestionsContainer.style.position = "absolute";
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`;
        suggestionsContainer.style.left = `${left + window.scrollX}px`;
        suggestionsContainer.style.width = `${width}px`;
        suggestionsContainer.style.zIndex = "1000";
        suggestionsContainer.style.maxHeight = "200px";
        suggestionsContainer.style.overflowY = "auto";

        document.body.appendChild(suggestionsContainer);

        let suggestions =
          JSON.parse(localStorage.getItem("phongBanList")) || [];
        suggestions = suggestions.map((item) => `${item.MaPhongBan}`);

        if (value) {
          suggestions = suggestions.filter((name) =>
            name.toLowerCase().includes(value)
          );
        }

        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return;
        }

        suggestions.forEach((name) => {
          const suggestionItem = document.createElement("div");
          suggestionItem.className = "suggestion-item";
          suggestionItem.textContent = name;

          suggestionItem.onclick = function () {
            const processedName = name.split("-").slice(-1)[0].trim();
            input.value = processedName;
            if (input.id == "filterKhoa") {
              filterKhoa();
            }
            hideSuggestionsKhoa();
          };

          suggestionsContainer.appendChild(suggestionItem);
        });

        input.onblur = function () {
          setTimeout(() => {
            hideSuggestionsKhoa();
          }, 100);
        };
      }

      function filterKhoa() {
        const input = document.getElementById("filterKhoa");
        const filter = input.value.toLowerCase();
        const tableRows = document.querySelectorAll("#tableBody tr");

        // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
        if (!filter) {
          tableRows.forEach((row) => {
            row.style.display = ""; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
          });
          return;
        }

        // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ t√™n gi·∫£ng vi√™n kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
        tableRows.forEach((row) => {
          const nameCell = row.querySelector("td:nth-child(6)"); // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n n·∫±m ·ªü c·ªôt th·ª© 5
          const name = nameCell.textContent.toLowerCase();

          if (name.includes(filter)) {
            row.style.display = ""; // Hi·ªán h√†ng n·∫øu kh·ªõp
          } else {
            row.style.display = "none"; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        });
        calculateTotals();
      }

      // ƒê·ªãnh nghƒ©a h√†m hideSuggestionsKhoa
      function hideSuggestionsKhoa() {
        const existingSuggestions = document.querySelectorAll(".suggestions");
        existingSuggestions.forEach((suggestion) => suggestion.remove());
      }

      // B√¢y gi·ªù b·ªçc ph·∫ßn c√≤n l·∫°i c·ªßa m√£ trong DOMContentLoaded
      document.addEventListener("DOMContentLoaded", function () {
        // H√†m filterKhoa (gi·ªØ nguy√™n)
        function filterKhoa() {
          const input = document.getElementById("filterKhoa");
          const filter = input.value.toLowerCase();
          const tableRows = document.querySelectorAll("#tableBody tr");

          if (!filter) {
            tableRows.forEach((row) => {
              row.style.display = ""; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
            });
            return;
          }

          tableRows.forEach((row) => {
            const nameCell = row.querySelector("td:nth-child(6)");
            const name = nameCell.textContent.toLowerCase();
            row.style.display = name.includes(filter) ? "" : "none";
          });
          calculateTotals();
        }
      });
    </script>
    <script>
      document
        .getElementById("infome")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const id_User = localStorage.getItem("id_User"); // L·∫•y id_User t·ª´ localStorage\
          if (id_User) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang infome v√† truy·ªÅn id_User trong URL
            window.location.href = `/infome/${id_User}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y id_User trong localStorage.");
          }
        });
    </script>

    <script>
      document
        .getElementById("changeMessage")
        .addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
          const MaPhongBan = localStorage.getItem("MaPhongBan"); // L·∫•y MaPhongBan t·ª´ localStorage

          if (MaPhongBan) {
            // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changeMessage v√† truy·ªÅn MaPhongBan trong URL
            window.location.href = `/changeMessage/${MaPhongBan}`;
          } else {
            alert("Kh√¥ng t√¨m th·∫•y MaPhongBan trong localStorage.");
          }
        });
    </script>
  </body>
</html>
