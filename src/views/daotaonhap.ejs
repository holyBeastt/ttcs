<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Học Viện Kỹ Thuật Mật Mã</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="/css/forminput.css" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    />
    <style>
      .thuocQuanDoiBox {
        height: 30px;
        line-height: 30px;
        align-items: center;
        gap: 8px; /* Khoảng cách giữa checkbox và nhãn */
      }

      .thuocQuanDoi-input {
        width: 20px;
        height: 20px;
        cursor: pointer;
      }

      .thuocQuanDoi-label {
        display: inline-block; /* Đảm bảo nhãn hiển thị riêng biệt */
        margin-right: 20px !important;
        font-size: 16px;
        color: #333;
        margin: 0;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <!-- Phần header -->
    <%- include('header') %>

    <!-- Phần nội dung -->
    <div class="m-3">
      <form
        action="/daotaonhap"
        enctype="multipart/form-data"
        class="form"
        method="POST"
      >
        <fieldset>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="HoTen">Họ tên:</label>
              <input
                required
                class="form-control"
                type="text"
                name="HoTen"
                id="HoTen"
              />
            </div>
            <div class="col-md-4">
              <label for="gioitinh">Giới tính:</label>
              <select class="form-control" name="GioiTinh" id="gioitinh">
                <option value="Nam">Nam</option>
                <option value="Nu">Nữ</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="ngaySinh">Ngày sinh:</label>
              <input
                required
                class="form-control"
                type="date"
                name="NgaySinh"
                id="ngaySinh"
              />
            </div>
          </div>
          <div class="row mb-3"></div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="CCCD">CCCD:</label>
              <input
                required
                class="form-control"
                type="text"
                name="CCCD"
                id="CCCD"
              />
            </div>
            <div class="col-md-4">
              <label for="NgayCapCCCD">Ngày cấp CCCD:</label>
              <input
                required
                class="form-control"
                type="date"
                name="NgayCapCCCD"
                id="NgayCapCCCD"
              />
            </div>
            <div class="col-md-4">
              <label for="NoiCapCCCD">Nơi cấp CCCD:</label>
              <input
                required
                class="form-control"
                type="text"
                name="NoiCapCCCD"
                id="NoiCapCCCD"
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="DiaChi">Địa chỉ theo CCCD:</label>
              <input
                required
                class="form-control"
                type="text"
                name="DiaChi"
                id="DiaChi"
              />
            </div>
            <div class="col-md-4">
              <label for="monGiangDayChinh">Bộ môn:</label>
              <select
                class="form-control"
                type="text"
                name="monGiangDayChinh"
                id="monGiangDayChinh"
              ></select>
            </div>
            <div class="col-md-4">
              <label for="BangTotNghiepLoai">Bằng tốt nghiệp loại:</label>
              <select
                class="form-control"
                name="BangTotNghiepLoai"
                id="BangTotNghiepLoai"
              >
                <option value="Trung bình">Trung bình</option>
                <option value="Khá">Khá</option>
                <option value="Giỏi">Giỏi</option>
                <option value="Xuất sắc">Xuất sắc</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label>Mặt trước CCCD:</label>
              <img id="imagetruocinput" src="" alt="Mặt trước CCCD" />
              <input
                class="form-control"
                type="file"
                name="truocCCCD"
                id="truocCCCD"
              />
            </div>
            <div class="col-md-4">
              <label>Mặt sau CCCD:</label>
              <img id="imagesauInput" src="" alt="Mặt sau CCCD" />
              <input
                class="form-control"
                type="file"
                name="sauCCCD"
                id="sauCCCD"
              />
            </div>
            <div class="col-md-4">
              <label>Bằng tốt nghiệp:</label>
              <img id="imagebang" alt="Bằng tốt nghiệp" />
              <input
                class="form-control"
                type="file"
                name="bangTotNghiep"
                id="bangTotNghiep"
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="dienThoai">Điện thoại:</label>
              <input
                required
                class="form-control"
                type="text"
                name="DienThoai"
                id="dienThoai"
              />
            </div>
            <!-- <div class="col-md-4">
              <label for="email">Email:</label>
              <input
                required
                class="form-control"
                type="email"
                name="email"
                id="email"
              />
            </div> -->
            <div class="col-md-4">
              <label for="msthue">Mã số thuế:</label>
              <input
                class="form-control"
                type="text"
                name="MaSoThue"
                id="msthue"
              />
            </div>
            <div class="col-md-4">
              <label>File lý lịch (PDF):</label>
              <input
                class="form-control"
                type="file"
                name="FileLyLich"
                id="FileLyLich"
              />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="NoiCongTac">Nơi công tác:</label>
              <input
                required
                class="form-control"
                type="text"
                name="NoiCongTac"
                id="NoiCongTac"
              />
            </div>
            <div class="col-md-4">
              <label for="chucvu">Chức vụ:</label>
              <input
                class="form-control"
                type="text"
                name="ChucVu"
                id="chucvu"
              />
            </div>
            <div class="col-md-4">
              <label for="hocVi">Học hàm/Học vị:</label>
              <select class="form-control" name="hocVi" id="hocVi">
                <option value="Cử nhân">Cử nhân</option>
                <option value="Kỹ sư">Kỹ sư</option>
                <option value="Thạc sĩ">Thạc sĩ</option>
                <option value="Tiến sĩ">Tiến sĩ</option>
                <option value="Phó giáo sư. Tiến sĩ">
                  Phó giáo sư. Tiến sĩ
                </option>
                <option value="Giáo sư. Tiến sĩ">Giáo sư. Tiến sĩ</option>
              </select>
            </div>
          </div>
          <div class="row mb-3"></div>
          <div class="row mb-3">
            <div class="col-md-1">
              <label for="hsl">Hệ số lương:</label>
              <input
                required
                class="form-control"
                type="text"
                name="HeSoLuong"
                id="hsl"
              />
            </div>
            <div class="col-md-3">
              <label for="stk">Số tài khoản:</label>
              <input
                required
                class="form-control"
                type="text"
                name="STK"
                id="stk"
              />
            </div>
            <div class="col-md-8">
              <label for="nganHang">Ngân hàng:</label>
              <input
                required
                class="form-control"
                type="text"
                name="NganHang"
                id="nganHang"
              />
            </div>
          </div>
          <div class="row mb-3" style="position: relative">
            <div class="col-md-4">
              <label for="tinhTrang">Tình trạng giảng dạy:</label>
              <select
                class="form-control"
                name="tinhTrangGiangDay"
                id="tinhTrang"
              >
                <option value="true">Đang giảng dạy</option>
                <option value="false">Đã ngừng giảng dạy</option>
              </select>
            </div>
            <div class="col-md-4">
              <label>QR Code:</label>
              <img id="QrCodeImg" src="" alt="QR CODE" />
              <input
                class="form-control"
                type="file"
                name="QrCode"
                id="QrCode"
              />
            </div>
            <div class="col-md-4">
              <label>File bổ sung:</label>
              <input
                class="form-control"
                type="file"
                name="fileBoSung"
                id="fileBoSung"
              />
            </div>
          </div>
          <div class="row mb-3" style="margin-top: 20px">
            <div class="col-md-4">
              <label><b>MÃ KHOA:</b></label>
              <label id="Ma_Khoa_Label"></label>
            </div>
            <div class="col-md-4">
              <label for="email">Email:</label>
              <input
                required
                class="form-control"
                type="email"
                name="email"
                id="email"
              />
            </div>
            <div class="col-md-4 thuocQuanDoiBox">
              <div class="form-group">
                <label for="thuocQuanDoi" class="thuocQuanDoi-label"
                  >Thuộc quân đội:</label
                >
                <input
                  type="checkbox"
                  class="thuocQuanDoi-input"
                  id="thuocQuanDoi"
                  name="thuocQuanDoi"
                  value="1"
                />
              </div>
            </div>
            <div class="justify-content-between" style="margin-top: 23px">
              <button class="btn" id="submit">Thêm mới</button>
              <button
                class="btn"
                id="return"
                style="margin-left: 20px"
                onclick="goBack()"
              >
                Quay lại
              </button>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Link script Sweet alert 2 -->
    <!-- SweetAlert2 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css"
      rel="stylesheet"
    />

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const maPhongBan = localStorage.getItem("MaPhongBan");
        document.getElementById(
          "Ma_Khoa_Label"
        ).innerHTML = `<b>${maPhongBan}</b>`;

        fetch(`/getMaBoMon/${maPhongBan}`)
          .then((response) => response.json())
          .then((data) => {
            console.log(data); // In ra phản hồi để kiểm tra
            const maBoMonSelect = document.getElementById("monGiangDayChinh");
            maBoMonSelect.innerHTML = ""; // Xóa các option cũ

            // Kiểm tra isKhoa và cập nhật quyền dựa theo giá trị
            if (data.success && data.maBoMon) {
              // Vòng lặp qua từng mục trong maBoMon và tạo thẻ option
              data.maBoMon.forEach((item) => {
                if (maPhongBan === item.MaPhongBan) {
                  const option = document.createElement("option");
                  option.value = item.MaBoMon; // Giả sử MaBoMon là thuộc tính cần làm value
                  option.textContent = `${item.TenBoMon} - ${item.MaBoMon}`; // Giả sử TenBoMon là tên bộ môn cần hiển thị
                  maBoMonSelect.appendChild(option);
                }
              });
            } else {
              console.error(
                "Dữ liệu maBoMon không tồn tại hoặc không thành công"
              );
            }
          })
          .catch((error) => console.error("Error:", error));
      });
    </script>

    <!-- <script >
        $(document).ready(function() {
    $('form').on('submit', function(event) {
       event.preventDefault(); // Ngăn chặn hành động submit mặc định

        var formData = $(this).serializeArray(); // Lấy tất cả dữ liệu từ form
        var formObject = {};

        $.each(formData, function(index, field) {
            formObject[field.name] = field.value; // Chuyển đổi dữ liệu thành đối tượng
        });

        console.log(formObject); // Hiển thị dữ liệu trong console
        });
    });
    </script> -->
    <!-- <script>
        $(document).ready(function() {
            $('form').on('submit', function(event) {
                event.preventDefault(); // Ngăn chặn hành động submit mặc định
        
                var formData = $(this).serializeArray(); // Lấy tất cả dữ liệu từ form
                var formObject = {};
        
                $.each(formData, function(index, field) {
                    formObject[field.name] = field.value; // Chuyển đổi dữ liệu thành đối tượng
                });
        
                console.log(formObject); // Hiển thị dữ liệu trong console
        
                // Gửi dữ liệu đến server
                $.ajax({
                    url: $(this).attr('action'), // URL lấy từ thuộc tính action của form
                    type: 'POST',
                    data: formObject, // Gửi dữ liệu đã thu thập
                    success: function(response) {
                        console.log('Dữ liệu đã được gửi thành công:', response);
                        // Bạn có thể thực hiện thêm các hành động khác tại đây
                    },
                    error: function(xhr, status, error) {
                        console.error('Đã xảy ra lỗi khi gửi dữ liệu:', error);
                    }
                });
            });
        });
        
    </script> -->
    <script>
      // Lấy query string từ URL
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get("message");

      // Lấy phần tử div để hiển thị thông báo
      const messageDiv = document.getElementById("message");

      // Hiển thị thông báo dựa trên giá trị của message
      if (message === "insertSuccess") {
        Swal.fire({
          title: "Thông báo",
          html: "Thêm thành công",
          icon: "success",
          confirmButtonText: "OK",
          width: "auto", // Tự động điều chỉnh chiều rộng
          padding: "20px", // Giữ khoảng cách cho nội dung
        });
      } else if (message === "insertFalse") {
        Swal.fire({
          title: "Thông báo",
          html: "Thêm thất bại",
          icon: "error",
          confirmButtonText: "OK",
          width: "auto", // Tự động điều chỉnh chiều rộng
          padding: "20px", // Giữ khoảng cách cho nội dung
        });
      }

      // Quay lại trang cũ
      function goBack() {
        window.history.back(); // Quay lại trang trước đó
      }

      // Sau khi hiển thị thông báo, xóa query string để tránh hiển thị lại khi refresh
      if (message) {
        // Sử dụng window.history để xóa query string mà không refresh lại trang
        const newUrl = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, newUrl);
      }
      const Home = document.getElementById("Home");

      Home.addEventListener("click", function (event) {
        event.preventDefault(); // Ngăn chặn hành vi mặc định của liên kết

        const isKhoa = localStorage.getItem("isKhoa");

        if (isKhoa == 0) {
          // Nếu là đào tạo hoặc tài chính
          window.location.href = "/maindt";
        } else {
          window.location.href = "/mainkhoa";
        }
      });
    </script>

    <script>
      document
        .getElementById("truocCCCD")
        .addEventListener("change", function (event) {
          displayImage(event, "imagetruocinput");
        });

      document
        .getElementById("sauCCCD")
        .addEventListener("change", function (event) {
          displayImage(event, "imagesauInput");
        });

      document
        .getElementById("bangTotNghiep")
        .addEventListener("change", function (event) {
          displayImage(event, "imagebang");
        });

      document
        .getElementById("QrCode")
        .addEventListener("change", function (event) {
          displayImage(event, "QrCodeImg");
        });

      function displayImage(event, imgId) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const img = document.getElementById(imgId);
            img.src = e.target.result;
            img.style.display = "block";
          };
          reader.readAsDataURL(file);
        }
      }
    </script>
    <script>
      document
        .getElementById("changePasswordLink")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ a
          const tenDangNhap = localStorage.getItem("TenDangNhap"); // Lấy TenDangNhap từ localStorage

          if (tenDangNhap) {
            // Chuyển hướng đến trang changePassword và truyền TenDangNhap trong URL
            window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(
              tenDangNhap
            )}`;
          } else {
            alert("Không tìm thấy TenDangNhap trong localStorage.");
          }
        });
    </script>
    <script>
      document
        .getElementById("infome")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ a
          const id_User = localStorage.getItem("id_User"); // Lấy id_User từ localStorage\
          if (id_User) {
            // Chuyển hướng đến trang infome và truyền id_User trong URL
            window.location.href = `/infome/${id_User}`;
          } else {
            alert("Không tìm thấy id_User trong localStorage.");
          }
        });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const Quyen = localStorage.getItem("userRole");

        // Ẩn button ngay khi trang được tải
        const actionButton = document.getElementById("changeMessage");
        //Ẩn site thêm thông báo
        if (Quyen === "Duyệt") {
          actionButton.style.display = "";
        } else {
          actionButton.style.display = "none";
        }
      });
    </script>
    <script>
      document
        .getElementById("changeMessage")
        .addEventListener("click", function (event) {
          event.preventDefault(); // Ngăn chặn hành vi mặc định của thẻ a
          const MaPhongBan = localStorage.getItem("MaPhongBan"); // Lấy MaPhongBan từ localStorage

          if (MaPhongBan) {
            // Chuyển hướng đến trang changeMessage và truyền MaPhongBan trong URL
            window.location.href = `/changeMessage/${MaPhongBan}`;
          } else {
            alert("Không tìm thấy MaPhongBan trong localStorage.");
          }
        });
    </script>
  </body>
</html>
