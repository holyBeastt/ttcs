<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/forminput.css">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <!-- <link rel="stylesheet" href="public/css/styles.css"> -->
  <style>
    .thuocQuanDoiBox {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .thuocQuanDoi-label {
      cursor: pointer;
      font-size: 16px;
      color: #333;
      margin-right: 10px;
      line-height: 20px;
    }

    .thuocQuanDoi-input {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #007bff;
    }
  </style>
</head>

<body>

  <!-- Ph·∫ßn header -->
  <%- include('header') %>

    <!-- Main content -->
    <div class="m-3 box">
      <form action="/updateGvm/:<%= value.id_Gvm %>" method="POST" class="form d-flex flex-column"
        enctype="multipart/form-data">
        <!-- //enctype="multipart/form-data" -->
        <fieldset>
          <div style="display: none;">
            <a>Id:<input class="input" type="text" name="IdGvm" id="IdGvm" value="<%= value.id_Gvm %> "></a>
          </div>
          <div class="row mb-3">
            <div style="width: 20%; padding-right: 0px;">
              <label for="HoTen">H·ªç t√™n:</label>
              <input required class="form-control" type="text" name="HoTen" id="HoTen" value="<%= value.HoTen %>">
            </div>
            <div style="width: 12%;">
              <label for="ngaySinh">Ng√†y sinh:</label>
              <input required class="form-control" type="date" name="NgaySinh" id="ngaySinh"
                value="<%= value.NgaySinh %>">
            </div>

            <div style="width: 13%;">
              <label for="CCCD">CCCD:</label>
              <input required class="form-control" type="text" name="CCCD" id="CCCD" value="<%= value.CCCD %>">
            </div>

            <div class="col-md-1">
              <label for="gioitinh">Gi·ªõi t√≠nh:</label>
              <select class="form-control" name="GioiTinh" id="gioitinh">
                <option value="Nam" <%=value.GioiTinh==='Nam' ? 'selected' : '' %>>Nam</option>
                <option value="Nu" <%=value.GioiTinh==='N·ªØ' ? 'selected' : '' %>>N·ªØ</option>
              </select>
            </div>

            <!-- M√£ ph√≤ng ban -->
            <div class="col-md-2">
              <label>M√£ ph√≤ng ban:</label>
              <select class="form-control" name="maPhongBan" id="maPhongBan" data-selected="<%= value.MaPhongBan %>">
              </select>
            </div>

            <div style="padding: 0px; width: 30%;">
              <label for="monGiangDayChinh">B·ªô m√¥n:</label>
              <select class="form-control" type="text" name="monGiangDayChinh" id="monGiangDayChinh">
              </select>
            </div>

          </div>

          <div class="row mb-3">
            <div class="col-md-2">
              <label for="NgayCapCCCD">Ng√†y c·∫•p CCCD:</label>
              <input required class="form-control" type="date" name="NgayCapCCCD" id="NgayCapCCCD"
                value="<%= value.NgayCapCCCD %>">
            </div>
            <div class="col-md-4">
              <label for="NoiCapCCCD">N∆°i c·∫•p CCCD:</label>
              <input required class="form-control" type="text" name="NoiCapCCCD" id="NoiCapCCCD"
                value="<%= value.NoiCapCCCD %>">
            </div>
            <div class="col-md-6">
              <label for="DiaChi">ƒê·ªãa ch·ªâ theo CCCD:</label>
              <input required class="form-control" type="text" name="DiaChi" id="DiaChi" value="<%= value.DiaChi %>">
            </div>
          </div>
          <div class="row mb-3">
            <!-- M·∫∑t tr∆∞·ªõc CCCD -->
            <div class="col-md-4">
              <label>M·∫∑t tr∆∞·ªõc CCCD:</label>
              <img
                src="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.MatTruocCCCD %>"
                alt="M·∫∑t tr∆∞·ªõc CCCD" id="imgtruoc"
                style="display: <%= value.MatTruocCCCD && value.MatTruocCCCD.endsWith('.pdf') ? 'none' : 'block' %>;">
              <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.MatTruocCCCD %>"
                target="_blank" id="linktruoc"
                style="display: <%= value.MatTruocCCCD && value.MatTruocCCCD.endsWith('.pdf') ? 'block' : 'none' %>;">
                Xem file PDF
              </a>
              <br>
              <input class="form-control" type="file" name="truocCCCD" id="imgtruocinput"
                value="<%= value.MatTruocCCCD %>">
              <input type="hidden" name="oldTruocCCCD" value="<%= value.MatTruocCCCD %>">
            </div>

            <!-- M·∫∑t sau CCCD -->
            <div class="col-md-4">
              <label>M·∫∑t sau CCCD:</label>
              <img
                src="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.MatSauCCCD %>"
                alt="M·∫∑t sau CCCD" id="imgsau"
                style="display: <%= value.MatSauCCCD && value.MatSauCCCD.endsWith('.pdf') ? 'none' : 'block' %>;">
              <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.MatSauCCCD %>"
                target="_blank" id="linksau"
                style="display: <%= value.MatSauCCCD && value.MatSauCCCD.endsWith('.pdf') ? 'block' : 'none' %>;">
                Xem file PDF
              </a>
              <br>
              <input class="form-control" type="file" name="sauCCCD" id="sauCCCD" value="<%= value.MatSauCCCD %>">
              <input type="hidden" name="oldSauCCCD" value="<%= value.MatSauCCCD %>">
            </div>

            <!-- H√¨nh ·∫£nh b·∫±ng c·∫•p cao nh·∫•t -->
            <div class="col-md-4">
              <label>H√¨nh ·∫£nh b·∫±ng c·∫•p cao nh·∫•t:</label>
              <img
                src="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.BangTotNghiep %>"
                alt="B·∫±ng c·∫•p cao nh·∫•t" id="imgbang"
                style="display: <%= value.BangTotNghiep && value.BangTotNghiep.endsWith('.pdf') ? 'none' : 'block' %>;">
              <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.BangTotNghiep %>"
                target="_blank" id="linkbang"
                style="display: <%= value.BangTotNghiep && value.BangTotNghiep.endsWith('.pdf') ? 'block' : 'none' %>;">
                Xem file PDF
              </a>
              <br>
              <input class="form-control" type="file" name="bangTotNghiep" id="bangTotNghiep"
                value="<%= value.BangTotNghiep %>">
              <input type="hidden" name="oldbangTotNghiep" value="<%= value.BangTotNghiep %>">
            </div>
          </div>

          <div class="row mb-3">
            <div class="col-md-2">
              <label for="dienThoai">ƒêi·ªán tho·∫°i:</label>
              <input required class="form-control" type="text" name="DienThoai" id="dienThoai"
                value="<%= value.DienThoai %>">
            </div>
            <div class="col-md-8">
              <label for="nganHang">Ng√¢n h√†ng:</label>
              <input required class="form-control" type="text" name="NganHang" id="nganHang"
                value="<%= value.NganHang %>">
            </div>
            <div class="col-md-2">
              <label for="HocVi">B·∫±ng c·∫•p cao nh·∫•t:</label>
              <select class="form-control" name="HocVi" id="HocVi">
                <option value="">---</option>
                <option value="C·ª≠ nh√¢n" <%=value.HocVi==="C·ª≠ nh√¢n" ? "selected" : "" %>>C·ª≠ nh√¢n</option>
                <option value="K·ªπ s∆∞" <%=value.HocVi==="K·ªπ s∆∞" ? "selected" : "" %>>K·ªπ s∆∞</option>
                <option value="Th·∫°c sƒ©" <%=value.HocVi==="Th·∫°c sƒ©" ? "selected" : "" %>>Th·∫°c sƒ©</option>
                <option value="Ti·∫øn sƒ©" <%=value.HocVi==="Ti·∫øn sƒ©" ? "selected" : "" %>>Ti·∫øn sƒ©</option>
                <option value="Ph√≥ gi√°o s∆∞" <%=value.HocVi==="Ph√≥ gi√°o s∆∞" ? "selected" : "" %>>Ph√≥
                  gi√°o s∆∞</option>
                <option value="Gi√°o s∆∞" <%=value.HocVi==="Gi√°o s∆∞" ? "selected" : "" %>>Gi√°o s∆∞
                </option>
                <option value="Ti·∫øng kh∆°-me" <%=value.HocVi==="Ti·∫øng kh∆°-me" ? "selected" : "" %>>Ti·∫øng
                  kh∆°-me</option>
                <option value="V√µ s∆∞" <%=value.HocVi==="V√µ s∆∞" ? "selected" : "" %>>V√µ s∆∞</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="col-md-8">
              <!-- D√≤ng 1 -->
              <div class="row">
                <div style="width: 75%;">
                  <label for="NoiCongTac">N∆°i c√¥ng t√°c:</label>
                  <input required class="form-control" type="text" name="NoiCongTac" id="NoiCongTac"
                    value="<%= value.NoiCongTac %>">
                </div>
                <div style="width: 25%; padding-right: 0px">
                  <label for="stk">S·ªë t√†i kho·∫£n:</label>
                  <input required class="form-control" type="text" name="STK" id="stk" value="<%= value.STK %>">
                </div>
              </div>
              <!-- D√≤ng 2 -->
              <p></p>
              <div class="row">
                <!-- M√£ s·ªë thu·∫ø -->
                <div style="width: 20%; padding-right: 0px">
                  <label for="msthue">M√£ s·ªë thu·∫ø:</label>
                  <input class="form-control" type="text" name="MaSoThue" id="msthue" value="<%= value.MaSoThue %>">
                </div>
                <!-- Ch·ª©c v·ª• -->
                <div style="width: 20%; padding-right: 0px">
                  <label for="chucvu">Ch·ª©c v·ª•:</label>
                  <input required class="form-control" type="text" name="ChucVu" id="chucvu"
                    value="<%= value.ChucVu %>">
                </div>

                <!-- Email -->
                <div style="width: 60%;">
                  <label for="email">Email:</label>
                  <input class="form-control" type="email" name="email" id="email" value="<%= value.Email %>">
                </div>
              </div>

              <!-- D√≤ng 3 -->
              <div class="row">
                <p></p>
                <div style="width: 20%; padding-right: 0px">
                  <label for="hsl">H·ªá s·ªë l∆∞∆°ng:</label>
                  <input class="form-control" type="text" name="HeSoLuong" id="hsl" value="<%= value.HSL %>">
                </div>

                <!-- B·∫±ng lo·∫°i -->
                <div style="width: 20%; padding-right: 0px">
                  <label for="BangTotNghiepLoai">B·∫±ng t·ªët nghi·ªáp lo·∫°i:</label>
                  <select class="form-control" name="BangTotNghiepLoai" id="BangTotNghiepLoai">
                    <option value="">---</option>
                    <option value="Trung b√¨nh" <%=value.BangTotNghiepLoai==="Trung b√¨nh" ? "selected" : "" %>>Trung b√¨nh
                    </option>
                    <option value="Kh√°" <%=value.BangTotNghiepLoai==="Kh√°" ? "selected" : "" %>>Kh√°</option>
                    <option value="Gi·ªèi" <%=value.BangTotNghiepLoai==="Gi·ªèi" ? "selected" : "" %>>Gi·ªèi</option>
                    <option value="Xu·∫•t s·∫Øc" <%=value.BangTotNghiepLoai==="Xu·∫•t s·∫Øc" ? "selected" : "" %>>Xu·∫•t s·∫Øc
                    </option>
                  </select>
                </div>
                <div style="width: 30%; padding-right: 0px">
                  <label for="tinhTrang" style="margin-bottom: 3px;">T√¨nh tr·∫°ng gi·∫£ng d·∫°y:</label>
                  <select class="form-control" name="tinhTrangGiangDay" id="tinhTrang">
                    <option value="true" <%=value.TinhTrangGiangDay==1 ? 'selected' : '' %>>ƒêang gi·∫£ng d·∫°y</option>
                    <option value="false" <%=value.TinhTrangGiangDay==0 ? 'selected' : '' %>>ƒê√£ ng·ª´ng gi·∫£ng d·∫°y</option>
                  </select>
                </div>
                <!-- Thu·ªôc qu√¢n ƒë·ªôi -->
                <div style="width: 30%; padding-right: 0px" class="thuocQuanDoiBox">
                  <label for="thuocQuanDoi" class="thuocQuanDoi-label">Thu·ªôc qu√¢n ƒë·ªôi:</label>
                  <input type="checkbox" class="thuocQuanDoi-input" id="thuocQuanDoi" name="thuocQuanDoi" value="1" <%
                    if (value.isQuanDoi===1 || value.isQuanDoi===true) { %> checked <% } %>
                    />
                </div>
              </div>

              <!-- D√≤ng 3.5 -->
              <div class="row">
                <p></p>
                <!-- ƒê√£ ngh·ªâ h∆∞u -->
                <div style="width: 20%; padding-right: 0px" class="thuocQuanDoiBox">
                  <label for="isNghiHuu" class="thuocQuanDoi-label">ƒê√£ ngh·ªâ h∆∞u:</label>
                  <input type="checkbox" class="thuocQuanDoi-input" id="isNghiHuu" name="isNghiHuu" value="1" <%
                    if (value.isNghiHuu===1 || value.isNghiHuu===true) { %> checked <% } %>
                    />
                </div>

                <div style="width: 50%; padding-right: 0px">
                  <label for="ChucDanhNgheNghiep">H·∫°ng ch·ª©c danh ngh·ªÅ nghi·ªáp:</label>
                  <select class="form-control" name="ChucDanhNgheNghiep" id="ChucDanhNgheNghiep">
                    <input
                      type="hidden"
                      id="currentChucDanhNgheNghiep"
                      value="<%= value.chuc_danh %>"
                    >
                </div>
              </div>

              <!-- D√≤ng 4 -->
              <div class="row">
                <p></p>
                <div class="col-md-6">
                  <label>File b·ªï sung:</label>
                  <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.fileBoSung %>"
                    target="_blank" id="linkFileBoSung">
                    <%= value.fileBoSung %>
                  </a>
                  <input class="form-control" type="file" name="fileBoSung" id="fileBoSung">
                  <input type="hidden" name="oldFileBoSung" value="<%= value.fileBoSung %>">
                  <p style="font-size:13px; font-style:italic; color:#2E8B57;">
                    (*) File pdf/word c·∫ßn ch·ª©a ·∫£nh CCCD m·∫∑t tr∆∞·ªõc + m·∫∑t sau (·ªü trong c√πng 1 trang); 
                    trang th·ª© 2 ch·ª©a b·∫±ng t·ªët nghi·ªáp cao nh·∫•t.
                  </p>
                </div>

                <div class="col-md-6">
                  <label>File l√Ω l·ªãch (PDF):</label>
                  <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.FileLyLich %>"
                    target="_blank" id="linkFileLyLich">
                    <%= value.FileLyLich %>
                  </a>
                  <input class="form-control" type="file" name="FileLyLich" id="FileLyLich">
                  <input type="hidden" name="oldFileLyLich" value="<%= value.FileLyLich %>">
                </div>
              </div>

              <!-- D√≤ng 5 -->
              <div class="row mb-3" style="padding-top: 130px;">
                <input type="text" id="boMon" value="<%= value.MonGiangDayChinh %>" hidden>
                <div class="col-md-4 d-flex justify-content-between" style="margin-top: 15px;">
                  <button class="btn" id="submit">C·∫≠p nh·∫≠t</button>
                  <button class="btn" id="return" type="button" onclick="goBack()">Quay l·∫°i</button>
                </div>
              </div>
            </div>
           
            <div class="col-md-4" style="position: relative; top: -40px;">
              <div class="col-md-12">
                <label>QR CODE:</label>
                <img src="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.QrCode %>"
                  alt="QR CODE" id="QrCodeImg"
                  style="display: <%= value.QrCode && value.QrCode.endsWith('.pdf') ? 'none' : 'block' %>;">
                <a href="/<%= value.MaPhongBan %>/<%= value.MonGiangDayChinh %>/<%= value.HoTen %>/<%= value.QrCode %>"
                  target="_blank" id="QrCodePdf"
                  style="display: <%= value.QrCode && value.QrCode.endsWith('.pdf') ? 'block' : 'none' %>;">
                  Xem file PDF
                </a>
                <br>
                <input class="form-control" type="file" name="QrCode" id="QrCodeInput" value="<%= value.QrCode %>">
                <input type="hidden" name="oldQrCode" value="<%= value.QrCode %>">
              </div>
            </div>

            <input type="hidden" name="oldHoTen" value="<%= value.HoTen %>" />
            <input type="hidden" name="oldMaPhongBan" value="<%= value.MaPhongBan %>" />
            <input type="hidden" name="oldMonGiangDayChinh" value="<%= value.MonGiangDayChinh %>" />            

          </div>
        </fieldset>
      </form>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Link script Sweet alert 2 -->
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css" rel="stylesheet">

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

    <script>
      function formatDate(dateString) {
        if (!dateString) return 'N/A'; // Ho·∫∑c tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh
        const date = new Date(dateString);
        if (isNaN(date)) return 'N/A'; // Ki·ªÉm tra n·∫øu ng√†y kh√¥ng h·ª£p l·ªá
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`; // ƒê·ªãnh d·∫°ng YYYY-MM-DD
      }

      function loadBoMonTheoPhongBan(maPhongBan, selectedBoMon = null) {
        const maBoMonSelect = document.getElementById('monGiangDayChinh');
        maBoMonSelect.innerHTML = "";
    
        const boMonData = JSON.parse(localStorage.getItem('dsBoMon')) || [];
    
        let foundMatch = false;
    
        boMonData.forEach(item => {
          if (item.MaPhongBan === maPhongBan) {
            const option = document.createElement('option');
            option.value = item.MaBoMon;
            option.textContent = `${item.TenBoMon} - ${item.MaBoMon}`;
    
            if (selectedBoMon && item.MaBoMon === selectedBoMon) {
              option.selected = true;
              foundMatch = true;
            }
    
            maBoMonSelect.appendChild(option);
          }
        });
    
        if (!foundMatch && selectedBoMon) {
          Swal.fire({
            title: 'Th√¥ng b√°o',
            html: "Kh√¥ng t·ªìn t·∫°i m√£ b·ªô m√¥n, vui l√≤ng s·ª≠a l·∫°i",
            icon: 'info',
            confirmButtonText: 'OK',
          });
        }
      }
    
      document.addEventListener("DOMContentLoaded", function () {
        const maPhongBanSelect = document.getElementById("maPhongBan");
        const selectedMaPhongBan = maPhongBanSelect.dataset.selected;
        const selectedBoMon = document.getElementById("boMon").value;
    
        // G·ªçi API ƒë·ªÉ l·∫•y b·ªô m√¥n v√† l∆∞u localStorage n·∫øu ch∆∞a c√≥
          fetch(`/api/shared/bo-mon`)
            .then(res => res.json())
            .then(data => {
              localStorage.setItem('dsBoMon', JSON.stringify(data));

              console.log("data = ", data)
              if (selectedMaPhongBan) {
                loadBoMonTheoPhongBan(selectedMaPhongBan, selectedBoMon);
              }
            })
            .catch(err => console.error("L·ªói khi fetch bo-mon:", err));
        
    
        // Khi ch·ªçn l·∫°i ph√≤ng ban
        maPhongBanSelect.addEventListener("change", function () {
          loadBoMonTheoPhongBan(this.value);
        });

        loadChucDanhToSelect();
      });

      async function loadChucDanhToSelect() {
        try {
          const currentId = document.getElementById(
            'currentChucDanhNgheNghiep'
          )?.value;

          const res = await fetch('/api/gvm/v1/chuc-danh-nghe-nghiep');
          const json = await res.json();

          if (!json.success) {
            console.error('API l·ªói');
            return;
          }

          const select = document.getElementById('ChucDanhNgheNghiep');
          if (!select) return;

          select.innerHTML = '';

          json.data.forEach(item => {
            const option = document.createElement('option');
            option.value = item.id;
            option.textContent = item.chuc_danh;
            select.appendChild(option);
          });

          // üî• T·ª∞ ƒê·ªòNG CH·ªåN THEO D·ªÆ LI·ªÜU RENDER
          if (currentId) {
            select.value = String(currentId);
          }

        } catch (err) {
          console.error('L·ªói load ch·ª©c danh:', err);
        }
      }

      // Load danh s√°ch ph√≤ng ban nh∆∞ c≈©
      $(document).ready(function () {
        const selectedMaPhongBan = $("#maPhongBan").data("selected");
    
        $.ajax({
          url: "/api/TKB/getKhoaList",
          method: "GET",
          success: function (response) {
            if (response.success) {
              response.MaPhongBan.forEach(function (item) {
                const isSelected = item.MaPhongBan === selectedMaPhongBan ? "selected" : "";
                $("#maPhongBan").append(
                  `<option value="${item.MaPhongBan}" ${isSelected}>${item.MaPhongBan}</option>`
                );
              });
            }
          }
        });
      });
    </script>
    

    <script>
      // L·∫•y query string t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get('message');
      // L·∫•y ph·∫ßn t·ª≠ div ƒë·ªÉ hi·ªÉn th·ªã th√¥ng b√°o
      const messageDiv = document.getElementById('message');

      // Hi·ªÉn th·ªã th√¥ng b√°o d·ª±a tr√™n gi√° tr·ªã c·ªßa message
      if (message === 'insertSuccess') {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "Th√™m th√†nh c√¥ng",
          icon: 'success',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message === 'insertFalse') {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "Th√™m th·∫•t b·∫°i",
          icon: 'error',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message === 'duplicateCCCD') {
        Swal.fire({
          title: 'C·∫£nh b√°o',
          html: "S·ªë CCCD b·ªã tr√πng",
          icon: 'warning',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message === 'duplicateHoTen') {
        Swal.fire({
          title: 'C·∫£nh b√°o',
          html: "H·ªç t√™n b·ªã tr√πng",
          icon: 'warning',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        });
      } else if (message == 'HeSoLuongNotValue') {
        Swal.fire({
          title: 'Th√¥ng b√°o',
          html: "H·ªá s·ªë l∆∞∆°ng kh√¥ng ƒë√∫ng ki·ªÉu d·ªØ li·ªáu",
          icon: 'info',
          confirmButtonText: 'OK',
          width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
          padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
        }).then(() => {
          // X√≥a query string sau khi user nh·∫•n "OK"
          const newUrl = window.location.origin + window.location.pathname;
          window.history.replaceState({}, document.title, newUrl);
        });
      }
      // Sau khi hi·ªÉn th·ªã th√¥ng b√°o, x√≥a query string ƒë·ªÉ tr√°nh hi·ªÉn th·ªã l·∫°i khi refresh
      if (message) {

      }

      // Quay l·∫°i trang c≈©
      function goBack() {
        window.history.back(); // Quay l·∫°i trang tr∆∞·ªõc ƒë√≥
      }
    </script>

<script>
      document.addEventListener('DOMContentLoaded', function () {
        // C·∫•u h√¨nh: Gi·ªõi h·∫°n 5MB
        const MAX_FILE_SIZE = 5 * 1024 * 1024;

        // DANH S√ÅCH C·∫§U H√åNH INPUT
        // inputId: ID c·ªßa th·∫ª input file
        // imgId: ID c·ªßa th·∫ª img preview (ƒë·ªÉ null n·∫øu kh√¥ng c√≥ ·∫£nh preview)
        // linkId: ID c·ªßa th·∫ª a ch·ª©a link file c≈©/preview PDF
        const mapping = [
          // 1. M·∫∑t tr∆∞·ªõc CCCD
          { inputId: 'imgtruocinput', imgId: 'imgtruoc', linkId: 'linktruoc' },
          // 2. M·∫∑t sau CCCD
          { inputId: 'sauCCCD', imgId: 'imgsau', linkId: 'linksau' },
          // 3. B·∫±ng t·ªët nghi·ªáp
          { inputId: 'bangTotNghiep', imgId: 'imgbang', linkId: 'linkbang' },
          // 4. QR Code
          { inputId: 'QrCodeInput', imgId: 'QrCodeImg', linkId: 'QrCodePdf' },
          // 5. File B·ªï Sung (Kh√¥ng c√≥ ·∫£nh preview -> imgId: null)
          { inputId: 'fileBoSung', imgId: null, linkId: 'linkFileBoSung' },
          // 6. File L√Ω L·ªãch (Kh√¥ng c√≥ ·∫£nh preview -> imgId: null)
          { inputId: 'FileLyLich', imgId: null, linkId: 'linkFileLyLich' }
        ];

        // G·∫Øn s·ª± ki·ªán v√≤ng l·∫∑p
        mapping.forEach(item => {
          const inputEl = document.getElementById(item.inputId);
          const imgEl = item.imgId ? document.getElementById(item.imgId) : null;
          const linkEl = document.getElementById(item.linkId);

          if (inputEl) {
            inputEl.addEventListener('change', function (event) {
              const file = event.target.files[0];
              handleFilePreview(file, imgEl, linkEl, inputEl);
            });
          }
        });

        // H√ÄM X·ª¨ L√ù CHUNG
        function handleFilePreview(file, imgElement, linkElement, inputElement) {
          // N·∫øu user cancel ch·ªçn file -> Gi·ªØ nguy√™n tr·∫°ng th√°i c≈©
          if (!file) return;

          // 1. KI·ªÇM TRA DUNG L∆Ø·ª¢NG (QUAN TR·ªåNG)
          if (file.size > MAX_FILE_SIZE) {
            const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
            Swal.fire({
              title: 'File qu√° l·ªõn!',
              html: `File n·∫∑ng <b>${sizeMB} MB</b>.<br>Vui l√≤ng t·∫£i file d∆∞·ªõi <b>5MB</b>.`,
              icon: 'warning',
              confirmButtonText: 'Ch·ªçn l·∫°i'
            });
            inputElement.value = ''; // Reset input
            return; // D·ª´ng ngay l·∫≠p t·ª©c
          }

          // 2. X·ª¨ L√ù PREVIEW
          const fileType = file.type;
          const fileName = file.name;
          const reader = new FileReader();

          // A. Tr∆∞·ªùng h·ª£p l√† ·∫¢NH (Image)
          if (fileType.startsWith('image/')) {
            reader.onload = function (e) {
              // N·∫øu c√≥ ch·ªó hi·ªán ·∫£nh th√¨ hi·ªán
              if (imgElement) {
                imgElement.src = e.target.result;
                imgElement.style.display = 'block';
              }
              // ·∫®n link PDF c≈© ƒëi (n·∫øu c√≥)
              if (linkElement) linkElement.style.display = 'none';
            };
            reader.readAsDataURL(file);
          }
          
          // B. Tr∆∞·ªùng h·ª£p l√† PDF
          else if (fileType === 'application/pdf') {
            reader.onload = function (e) {
              if (linkElement) {
                linkElement.href = e.target.result;
                linkElement.target = "_blank";
                linkElement.textContent = `Xem file PDF m·ªõi: ${fileName}`;
                linkElement.style.display = 'block';
                // ƒê·ªïi m√†u text ƒë·ªÉ ng∆∞·ªùi d√πng bi·∫øt l√† file m·ªõi
                linkElement.style.color = '#0d6efd'; 
                linkElement.style.fontStyle = 'italic';
              }
              // ·∫®n ·∫£nh c≈© ƒëi
              if (imgElement) imgElement.style.display = 'none';
            };
            reader.readAsDataURL(file);
          }
          
          // C. Tr∆∞·ªùng h·ª£p file Word/Excel/Kh√°c (Kh√¥ng xem tr∆∞·ªõc ƒë∆∞·ª£c tr√™n tr√¨nh duy·ªát)
          else {
            // V·ªõi file b·ªï sung (th∆∞·ªùng l√† word), ta ch·ªâ c·∫≠p nh·∫≠t t√™n file text
            if (linkElement) {
                // Kh√¥ng set href blob v√¨ browser kh√¥ng m·ªü ƒë∆∞·ª£c file word blob tr·ª±c ti·∫øp
                linkElement.removeAttribute('href'); 
                linkElement.style.display = 'block';
                linkElement.textContent = `ƒê√£ ch·ªçn file: ${fileName}`;
                linkElement.style.color = '#198754'; // M√†u xanh l√°
                linkElement.style.textDecoration = 'none';
                linkElement.style.cursor = 'default';
            }
            if (imgElement) imgElement.style.display = 'none';
          }
        }
      });
    </script>
    <script>
      document.getElementById("changePasswordLink").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

        if (tenDangNhap) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
          window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(tenDangNhap)}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
        }
      });
    </script>
    <script>
      document.getElementById("infome").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const id_User = localStorage.getItem("id_User"); // L·∫•y id_User t·ª´ localStorage\
        if (id_User) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang infome v√† truy·ªÅn id_User trong URL
          window.location.href = `/infome/${id_User}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y id_User trong localStorage.");
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const Quyen = localStorage.getItem("userRole");

        // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
        const actionButton = document.getElementById('changeMessage');
        //·∫®n site th√™m th√¥ng b√°o
        if (Quyen === "<%= APP_ROLES.troLy_phong %>" || Quyen === "<%= APP_ROLES.lanhDao_phong %>") {
          actionButton.style.display = '';
        } else {
          actionButton.style.display = 'none';
        }
      });
    </script>
    <script>
      document.getElementById("changeMessage").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const MaPhongBan = localStorage.getItem("MaPhongBan"); // L·∫•y MaPhongBan t·ª´ localStorage

        if (MaPhongBan) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changeMessage v√† truy·ªÅn MaPhongBan trong URL
          window.location.href = `/changeMessage/${MaPhongBan}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y MaPhongBan trong localStorage.");
        }
      });
    </script>
</body>

</html>
