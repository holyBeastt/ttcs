<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªçc Vi·ªán K·ªπ Thu·∫≠t M·∫≠t M√£</title>
  <link rel="stylesheet" href="/css/table.css">
  <link rel="stylesheet" href="/css/teachingInfo.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    .container {
      position: relative;
      /* Ensure the dropdown positions relative to this container */
      display: inline-block;
      /* Allows for proper alignment */
    }

    .table>:not(caption)>*>* {
      border-bottom-width: 2px;
    }

    .table {
      border-color: #ffffff;
      z-index: 1;
    }

    .suggestions {
      position: absolute;
      /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m b√™n tr√™n c√°c th√†nh ph·∫ßn kh√°c */
      top: calc(100% + 5px);
      /* ƒê·∫∑t g·ª£i √Ω ph√≠a tr√™n input v·ªõi m·ªôt kho·∫£ng c√°ch */
      font-size: 12px;
      left: 0;
      background-color: #f0f0f0;
      color: #000;
      border: 1px solid #ccc;
      box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      /* ƒê·∫£m b·∫£o g·ª£i √Ω n·∫±m tr√™n c√°c th√†nh ph·∫ßn kh√°c */
      border-radius: 4px;
      max-height: 300px;
      overflow-y: auto;
    }

    /* Hi·ªáu ·ª©ng lung linh khi hover */
    .suggestions:hover {
      background-color: #e0e0e0;
      /* Thay ƒë·ªïi m√†u n·ªÅn khi hover */
      box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
      /* TƒÉng ƒë·ªô b√≥ng khi hover */
    }


    /* CSS cho t·ª´ng m·ª•c g·ª£i √Ω */
    .suggestion-item {
      padding: 8px 12px;
      /* Kho·∫£ng c√°ch b√™n trong t·ª´ng m·ª•c */
      cursor: pointer;
      /* Con tr·ªè chu·ªôt thay ƒë·ªïi khi hover */
      transition: background-color 0.2s ease;
      /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªïi m∆∞·ª£t m√† khi hover */
    }

    /* Hi·ªáu ·ª©ng khi ng∆∞·ªùi d√πng di chu·ªôt v√†o m·ª•c g·ª£i √Ω */
    .suggestion-item:hover {
      background-color: #f0f0f0;
      /* M√†u n·ªÅn khi hover */
    }

    /* ƒê·∫∑t l·∫°i m·ªôt s·ªë thu·ªôc t√≠nh khi input m·∫•t focus */
    input:focus+.suggestions {
      display: block;
      /* ƒê·∫£m b·∫£o khung hi·ªÉn th·ªã khi input ƒë∆∞·ª£c focus */
    }

    /* ƒê·∫£m b·∫£o container g·ª£i √Ω kh√¥ng b·ªã tr√†n ra ngo√†i khung n·∫øu c√≥ */
    .suggestions {
      overflow: hidden;
    }

    /* ph·∫ßn css cho label t·ªïng s·ªë ti·∫øt ki*/
    .total-label {
      margin-left: auto;
      /* CƒÉn ph·∫£i cho th·∫ª total-label */
      margin-right: 0;
      font-family: Arial, sans-serif;
      font-size: 16px;
      background-color: #f4f4f4;
      padding: 10px;
      border-radius: 8px;
      width: fit-content;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: block;
      /* ƒê·∫£m b·∫£o th·∫ª div l√† kh·ªëi ƒë·ªÉ cƒÉn ph·∫£i ho·∫°t ƒë·ªông */
    }

    .total-label label {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ in ƒë·∫≠m */
      color: #000;
      /* M√†u ch·ªØ ƒëen */
      margin-right: 8px;
      /* Th√™m kho·∫£ng c√°ch b√™n ph·∫£i */
      cursor: pointer;
      /* T·∫°o hi·ªáu ·ª©ng chuy·ªÉn m√†u n·ªÅn v√† m√†u ch·ªØ m·ªÅm m·∫°i */
      padding: 5px 10px;
      /* Th√™m padding cho label ƒë·ªÉ t·∫°o kh√¥ng gian */
      border: 1px solid #ccc;
      /* Khung cho label */
      border-radius: 4px;
      /* Bo g√≥c cho khung */
    }

    .total-label label,
    .total-label label span {
      background-color: #007BFF;
      /* M√†u n·ªÅn khi hover */
      color: #fff;
      /* M√†u ch·ªØ tr·∫Øng khi hover */
    }

    .total-label span {
      font-weight: bold;
      /* Gi·ªØ ch·ªØ trong span c≈©ng in ƒë·∫≠m */
      color: #333;
      /* M√†u ch·ªØ ƒë·∫≠m cho gi√° tr·ªã */
    }

    /* ƒê·∫∑t chi·ªÅu r·ªông c·ªë ƒë·ªãnh cho c·∫£ input[type="date"] v√† input[type="text"] */
    input[type="date"],
    input[type="text"] {
      width: 120px;
      /* ƒêi·ªÅu ch·ªânh gi√° tr·ªã n√†y theo mong mu·ªën */
      box-sizing: border-box;
      padding: 5px;
      /* Gi·ªØ padding nh∆∞ c≈© */
    }

    .btn {
      margin-bottom: 0px;
      height: 45px;
    }
  </style>
  <style>
    /* T√πy ch·ªânh danh s√°ch g·ª£i √Ω */
    .ui-autocomplete {
      background: white;
      border: 1px solid #ccc;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      font-size: 14px;
      padding: 5px;
      width: 200px ; /* Gi·∫£m ƒë·ªô r·ªông */
      font-size: 12px !important;
  }
  
  
    /* Hi·ªÉn th·ªã ƒë·∫πp h∆°n, kh√¥ng c·∫ßn hover */
    .ui-menu-item {
        padding: 8px;
        cursor: default;
    }
  </style>
</head>

<body>
  <!-- Ph·∫ßn header -->
  <%- include('header') %>
    <!-- Ph·∫ßn n·ªôi dung -->

    <div class="container-fluid box m-4">
      <div class="">
        <div class="d-flex justify-content-between">
          <div class="cbb d-flex" style="margin-top: 20px;">
            <select class="selectop w-100px mx-1 " id="combobox-dot">
              <option value="">ƒê·ª£t</option>
            </select>

            <!-- Combo box ƒê·ª£t -->
            <select class="selectop w-100px mx-1 " id="comboboxki">
              <option value="">K·ª≥</option>
            </select>

            <!-- Combo box NƒÉm -->
            <select class="selectop mx-1 " id="NamHoc" style="width: 150px;">
              <option value="">NƒÉm h·ªçc</option>
            </select>
            <button id="getData" class="btn text-nowrap mx-3" style="width: max-content;">Hi·ªÉn th·ªã</button>
            <button id="update-qc" class="btn mx-3 luu">C·∫≠p nh·∫≠t</button>
            <!-- onclick="submitData()" -->
          </div>

        </div>


        <div class="d-flex my-3" style="height: 70px;">
          <!-- T√¨m ki·∫øm theo gi·∫£ng vi√™n -->
          <input type="text" id="filterName" placeholder="T√¨m theo t√™n gi·∫£ng vi√™n" class="form-control m-2 search"
            style="width: 200px;" />
          <input type="text" id="filterClass" placeholder="T√¨m theo t√™n h·ªçc ph·∫ßn" class="form-control m-2 search"
            style="width: 200px;" />
          <!-- T√¨m ki·∫øm theo b·ªô m√¥n -->
          <input type="text" id="filterBoMon" placeholder="T√¨m theo t√™n b·ªô m√¥n"  class="form-control m-2 search" style="width: 200px;" />

          <div class="input-group my-2 mx-1" style="width: 350px;" id="batdau">
            <label for="startDate" class="input-group-text">Ng√†y b·∫Øt ƒë·∫ßu</label>
            <input required type="date" id="startDate" class="form-control" />
          </div>
          <div class="input-group my-2 mx-1" style="width: 350px;" id="ketthuc">

            <label for="endDate" class="input-group-text">Ng√†y k·∫øt th√∫c</label>
            <input required type="date" id="endDate" class="form-control" />
          </div>
          <button id="fillDay" class="btn text-nowrap my-2 mx-1" style="height: 54px;">Ch√®n ng√†y</button>


          <!-- <button class="button-action SapXep " id="sortTeachersByName">S·∫Øp X·∫øp</button> -->


          <script>
            document.getElementById('sortTeachersByName').addEventListener('click', sortTeachersByName);

            function sortTeachersByName() {
              const tableBody = document.getElementById('tableBody');
              const rows = Array.from(tableBody.rows);

              // Lo·∫°i b·ªè h√†ng ti√™u ƒë·ªÅ kh·ªèi qu√° tr√¨nh s·∫Øp x·∫øp
              const dataRows = rows.slice(); // L·∫•y t·∫•t c·∫£ c√°c h√†ng d·ªØ li·ªáu

              // S·∫Øp x·∫øp c√°c h√†ng d·ªØ li·ªáu d·ª±a tr√™n t√™n gi√°o vi√™n
              dataRows.sort((a, b) => {
                const teacherA = a.cells[2].textContent.trim();
                const teacherB = b.cells[2].textContent.trim();

                // S·∫Øp x·∫øp theo ti√™u chu·∫©n ti·∫øng Vi·ªát
                return teacherA.localeCompare(teacherB, 'vi', { sensitivity: 'base' });
              });

              // X√≥a b·∫£ng v√† ch√®n l·∫°i c√°c h√†ng d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
              tableBody.innerHTML = ''; // X√≥a c√°c h√†ng hi·ªán c√≥
              dataRows.forEach(row => tableBody.appendChild(row)); // Ch√®n l·∫°i c√°c h√†ng d·ªØ li·ªáu ƒë√£ s·∫Øp x·∫øp
            }

          </script>
          <script>
            // H√†m ki·ªÉm tra v√† l·ªçc h√†ng trong b·∫£ng
            function filterTable() {
              const nameFilter = document.getElementById('filterName').value.toLowerCase();
              const classFilter = document.getElementById('filterClass').value.toLowerCase();
              const boMonFilter = document.getElementById('filterBoMon').value.toLowerCase();
              const tableRows = document.querySelectorAll('#tableBody tr');

              tableRows.forEach(row => {
                const nameCell = row.querySelector('td:nth-child(3)'); // C·ªôt t√™n gi·∫£ng vi√™n
                const classCell = row.querySelector('td:nth-child(1)'); // C·ªôt h·ªçc ph·∫ßn
                const boMonInput = row.querySelector('td:nth-child(7) input[name="bomon"]'); // C·ªôt b·ªô m√¥n

                const name = nameCell ? nameCell.textContent.toLowerCase() : '';
                const className = classCell ? classCell.textContent.toLowerCase() : '';
                const boMon = boMonInput ? boMonInput.value.toLowerCase() : '';

                // Ki·ªÉm tra ƒëi·ªÅu ki·ªán l·ªçc
                const matchesName = name.includes(nameFilter);
                const matchesClass = className.includes(classFilter);
                const matchesBoMon = boMon.includes(boMonFilter);

                // Hi·ªán ho·∫∑c ·∫©n h√†ng d·ª±a tr√™n ƒëi·ªÅu ki·ªán l·ªçc
                if (matchesName && matchesClass && matchesBoMon) {
                  row.style.display = ''; // Hi·ªán h√†ng n·∫øu t·∫•t c·∫£ c√°c ƒëi·ªÅu ki·ªán ƒë·ªÅu kh·ªõp
                } else {
                  row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
                }
              });

              calculateTotals(); // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt sau khi l·ªçc
            }

            // G√°n s·ª± ki·ªán cho c√°c input filter
            document.getElementById('filterName').addEventListener('input', filterTable);
            document.getElementById('filterClass').addEventListener('input', filterTable);
            document.getElementById('filterBoMon').addEventListener('input', filterTable);
          </script>
          <script>
            function sortTableByColumn(columnIndex, direction) {
              const tableBody = document.getElementById('tableBody');
              const rows = Array.from(tableBody.rows);

              rows.sort((a, b) => {
                const cellA = a.cells[columnIndex].textContent.trim();
                const cellB = b.cells[columnIndex].textContent.trim();

                if (direction === 'asc') {
                  return cellA.localeCompare(cellB, 'vi', { sensitivity: 'base' });
                } else {
                  return cellB.localeCompare(cellA, 'vi', { sensitivity: 'base' });
                }
              });

              tableBody.innerHTML = ''; // Clear current rows
              rows.forEach(row => tableBody.appendChild(row)); // Append sorted rows
            }
          </script>

        </div>

        <div id="renderInfo">
          <table class="text-center">
            <thead>
              <tr>
                <th style="width: 150px;">H·ªçc ph·∫ßn</th>
                <th style="width: 30px;">S·ªë TC</th>
                <th style="width: 130px;">
                  <span onclick="sortTableByColumn(2, 'asc')">GV theo TKB</span>
                  <span class="sort-icon">
                    <i class="bi bi-arrow-up" onclick="sortTableByColumn(2, 'asc')"></i>
                    <i class="bi bi-arrow-down" onclick="sortTableByColumn(2, 'desc')"></i>
                  </span>
                </th>
                <th style="width: 50px;">M·ªùi gi·∫£ng?</th>
                <th style="width: 250px;">GV gi·∫£ng d·∫°y</th>
                <th style="width: 50px;">Khoa</th>
                <th style="width: 64px;">B·ªô m√¥n</th>
                <th style="width: 100px;">H·ªá ƒë√†o t·∫°o</th>
                <th style="width: 50px;">S·ªë ti·∫øt LL</th>
                <th style="width: 50px;">S·ªë ti·∫øt QC</th>
                <th style="width: 50px;">Ng√†y b·∫Øt ƒë·∫ßu</th>
                <th style="width: 50px;">Ng√†y k·∫øt th√∫c</th>
                <th style="width: 50px">Ghi ch√∫</th>
                <th style="width: 50px; display: none" id="khoaColumn">
                  <div class="form-check">
                    Khoa
                    <input class="form-check-input" type="checkbox" id="checkAllKhoa" onclick="checkAll('khoa')">
                  </div>
                </th>
                <th style="width: 50px; display: none" id="daoTaoColumn">
                  <div class="form-check">
                    ƒê√†o t·∫°o
                  </div>
                </th>
                <th style="width: 50px; display: none" id="taiChinhColumn">
                  <div class="form-check">
                    T√†i ch√≠nh
                  </div>
                </th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td id="ankhoa"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- Label t·ªïng s·ªë ti·∫øt t√°ch ri√™ng v·ªõi b·∫£ng -->
      <div class="total-label">
        <label>T·ªïng s·ªë ti·∫øt L√™n L·ªõp: <span class="value" id="totalLL">0</span></label>
        <label>T·ªïng s·ªë ti·∫øt Quy Chu·∫©n: <span class="value" id="totalQC">0</span></label>
      </div>
    </div>
    </div>
    <div id="modalBackdrop" style="display: none;"></div> <!-- N·ªÅn t·ªëi -->
    <div id="noteForm" style="display: none;">
      <h3>Ghi ch√∫</h3>
      <label for="noteInput">N·ªôi dung:</label>
      <textarea id="noteInput"></textarea> <!-- S·ª≠ d·ª•ng textarea cho ghi ch√∫ d√†i -->
      <br />
      <label for="deadlineInput">H·∫°n:</label>
      <input type="date" id="deadlineInput"
        style="width: 100%; padding: 5px; border: 1px solid #ccc; border-radius: 4px;" />
      <br />
      <div class="d-flex text-nowrap" style="text-align: right;">
        <button onclick="saveNote()">L∆∞u</button>
        <button onclick="doneNote()">Ho√†n Th√†nh</button>
        <button class="cancel" onclick="closeNoteForm()">ƒê√≥ng</button>
      </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Link script Sweet alert 2 -->
    <!-- SweetAlert2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.min.css" rel="stylesheet">

    <!-- SweetAlert2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script>

    <!-- Th√™m jQuery v√† jQuery UI -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- jQuery UI CSS -->
    <link
      rel="stylesheet"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />

    <script>
      $(document).ready(function () {
        const isKhoa = localStorage.getItem("isKhoa");
        console.log('Gi√° tr·ªã isKhoa t·ª´ localStorage: ', isKhoa);
        hideButton();
        const Ban = localStorage.getItem("MaPhongBan");
        console.log('Gi√° tr·ªã Ban t·ª´ localStorage: ', Ban);
        const role = localStorage.getItem("userRole");
        console.log('Gi√° tr·ªã QUy·ªÅn t·ª´ localStorage: ', role);
      });

      function hideButton() {
        const isKhoa = localStorage.getItem("isKhoa");
        const role = localStorage.getItem("userRole");
        if (isKhoa === null) {
          console.log('Kh√¥ng t√¨m th·∫•y gi√° tr·ªã isKhoa trong localStorage');
        } else {
          console.log('Gi√° tr·ªã isKhoa: ', isKhoa);

          const actionButton = document.getElementById('actionButton');
          const actionButton1 = document.getElementById('actionButton1');
          const actionButton2 = document.getElementById('actionButton2');
          const actionButton3 = document.getElementById('actionButton3');

          // ·∫®n button import ƒë·ªì √°n
          const importDoAn = document.getElementById('importDoAn');
          const suaHD = document.getElementById('suaHD');

          if (isKhoa == 0 && role == 'Duy·ªát') {
            importDoAn.style.display = 'block';
            suaHD.style.display = 'block';
          }

          if (actionButton1 && actionButton2) {
            if (isKhoa === "0") {
              actionButton1.style.display = 'none'; // ·∫®n actionButton1 n·∫øu isKhoa = 0
              actionButton2.style.display = 'inline-block'; // Hi·ªán actionButton2
            } else {
              actionButton1.style.display = 'inline-block'; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
              actionButton2.style.display = 'none'; // ·∫®n actionButton2
              if (role.toLowerCase() == 'gv') {
                actionButton1.style.display = 'none'; // Hi·ªán actionButton1 n·∫øu isKhoa kh√°c 0
              }
            }
          } else {
            console.log('Kh√¥ng t√¨m th·∫•y c√°c n√∫t actionButton1 ho·∫∑c actionButton2');
          }
          //·∫®n site duy·ªát l·ªõp gk
          if (role === "L√£nh ƒë·∫°o khoa" || role === "Duy·ªát") {
            actionButton3.style.display = '';
          } else {
            actionButton3.style.display = 'none';
          }
        }
      }
    </script>

    <!-- ph·∫ßn hi·ªÉn th·ªã ph√¢n theo role -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const role = localStorage.getItem("userRole");

        // Ch·ªâ cho nh·∫≠p ng√†y b·∫Øt ƒë·∫ßu ng√†y k·∫øt th√∫c v·ªõi role thi h√†nh
        // if (role && role.includes('GV_CNBM')) {
        // document.getElementById('batdau').style.display = '';
        // document.getElementById('ketthuc').style.display = '';
        // }

        // N·∫øu role l√† 1 trong 3 gi√° tr·ªã sau th√¨ hi·ªÉn th·ªã c·ªôt, ng∆∞·ª£c l·∫°i th√¨ ·∫©n
        if (role === 'L√£nh ƒë·∫°o khoa') {
          // Hi·ªÉn th·ªã c·ªôt 'khoaColumn'
          document.getElementById('khoaColumn').style.display = 'table-cell';
          document.getElementById('daoTaoColumn').style.display = 'table-cell';
          document.getElementById('taiChinhColumn').style.display = 'table-cell';
        } else {
          // ·∫®n c·ªôt 'khoaColumn'
          document.getElementById('khoaColumn').style.display = 'none';
          document.getElementById('ankhoa').style.display = 'none';
        }
      });

    </script>

    <!-- ph·∫ßn ch√®n ng√†y, render b·∫£ng v√† v√† c√°c h√†m li√™n quan -->
    <script>

      var totalLL;
      var totalQC;
      var globalData = [];

      document.addEventListener('DOMContentLoaded', function () {

        // s·ª± ki·ªán click ch√®n ng√†y
        document.getElementById('fillDay').addEventListener('click', function () {
          // L·∫•y gi√° tr·ªã ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c t·ª´ ng∆∞·ªùi d√πng
          const globalStartDate = document.getElementById('startDate').value;
          const globalEndDate = document.getElementById('endDate').value;

          // Ki·ªÉm tra n·∫øu ng∆∞·ªùi d√πng ch∆∞a nh·∫≠p ng√†y
          if (!globalStartDate || !globalEndDate) {
            Swal.fire({
              title: 'Th√¥ng b√°o',
              html: "Vui l√≤ng nh·∫≠p ng√†y b·∫Øt ƒë·∫ßu v√† ng√†y k·∫øt th√∫c",
              icon: 'success',
              confirmButtonText: 'OK',
              width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });
            return;
          }

          // L·∫•y t·∫•t c·∫£ c√°c d√≤ng hi·ªÉn th·ªã trong b·∫£ng
          const rows = document.querySelectorAll('#tableBody tr');

          rows.forEach(row => {
            // B·ªè qua h√†ng b·ªã ·∫©n
            if (row.style.display === 'none') {
              return;
            }

            // L·∫•y id c·ªßa h√†ng t·ª´ thu·ªôc t√≠nh data-id
            // console.log(row)
            let rowId = parseInt(row.getAttribute('data-id', 10)); // Chuy·ªÉn ƒë·ªïi rowId th√†nh s·ªë nguy√™n
            // console.log('id trong b·∫£ng ƒëang hi·ªÉn th·ªã : ', rowId);

            // T√¨m ƒë·ªëi t∆∞·ª£ng trong localStorage c√≥ id tr√πng v·ªõi h√†ng hi·ªán t·∫°i
            let item = globalData.find(d => parseInt(d.ID) === parseInt(rowId));
            // console.log('id trong b·∫£ng d·ªØ li·ªáu ch√≠nh : ', item.id);

            // N·∫øu t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng v√† KhoaDuyet == 0
            if (item && item.KhoaDuyet == 0) {
              // ƒê·ªãnh d·∫°ng ng√†y tr∆∞·ªõc khi l∆∞u ƒë·ªÉ tr√°nh l·ªói m√∫i gi·ªù
              item.NgayBatDau = format(globalStartDate);
              item.NgayKetThuc = format(globalEndDate);
            }
          });

          // Ch√®n ng√†y b·∫Øt ƒë·∫ßu, b·ªè qua c√°c √¥ b·ªã disable
          document.querySelectorAll('[name="startDate"]').forEach(input => {
            if (!input.disabled && input.offsetParent !== null) {
              input.value = globalStartDate;
            }
          });

          // Ch√®n ng√†y k·∫øt th√∫c, b·ªè qua c√°c √¥ b·ªã disable
          document.querySelectorAll('[name="endDate"]').forEach(input => {
            if (!input.disabled && input.offsetParent !== null) {
              input.value = globalEndDate;
            }
          });

          // Ki·ªÉm tra ƒë·ªãnh d·∫°ng ng√†y v√† format l·∫°i n·∫øu c·∫ßn
          globalData.forEach(item => {
            if (item.NgayBatDau && isISODate(item.NgayBatDau)) {
              item.NgayBatDau = format(item.NgayBatDau);
            }
            if (item.NgayKetThuc && isISODate(item.NgayKetThuc)) {
              item.NgayKetThuc = format(item.NgayKetThuc);
            }
          });


          // Ki·ªÉm tra l·∫°i d·ªØ li·ªáu sau khi c·∫≠p nh·∫≠t
          console.log('D·ªØ li·ªáu sau khi ch√®n:', globalData);

          // G·ª≠i d·ªØ li·ªáu ƒë√£ c·∫≠p nh·∫≠t l√™n server
          fetch('/updateDateAll', {
            method: 'POST', // Ph∆∞∆°ng th·ª©c POST
            headers: {
              'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
            },
            body: JSON.stringify(globalData) // Chuy·ªÉn ƒë·ªïi data ƒë√£ c·∫≠p nh·∫≠t th√†nh chu·ªói JSON
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
              }
              return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
            })
            .then(data => {
              // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: data.message,
                icon: 'success',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });

            })
            .catch(error => {
              console.error('C√≥ l·ªói x·∫£y ra:', error);
              alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.');
            });
        });

        // G·∫Øn s·ª± ki·ªán click cho n√∫t
        document.getElementById('update-qc').addEventListener('click', submitData);

        function submitData() {

          // L∆∞u b·∫£ng hi·ªán c√≥ v√†o bi·∫øn globalData
          updateGlobalDataFromTable();

          // Fomart l·∫°i ng√†y th√°ng nƒÉm
          globalData.forEach(item => {
            item.NgayBatDau = format(item.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
            item.NgayKetThuc = format(item.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
          });

          console.log('D·ªØ li·ªáu khi click C·∫≠p nh·∫≠t : ', globalData);
          // G·ª≠i d·ªØ li·ªáu l√™n server
          fetch('/check-teaching', {
            method: 'POST', // Ph∆∞∆°ng th·ª©c POST
            headers: {
              'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
            },
            body: JSON.stringify(globalData) // Chuy·ªÉn ƒë·ªïi globalData th√†nh chu·ªói JSON
          })
            .then(response => {
              if (!response.ok) {
                throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
              }
              return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
            })
            .then(data => {
              // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
              const messageWithLineBreaks = data.message.replace(/\n/g, "<br>");

              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: messageWithLineBreaks,
                icon: 'success',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              }).then(() => {
                loadDataAfterUpdate();
                //location.reload();
              });
            })
            .catch(error => {
              console.error('C√≥ l·ªói x·∫£y ra:', error);
              alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.');
            });

        }

        async function loadDataAfterUpdate() {
          const dotValue = document.getElementById('combobox-dot').value;
          const kiValue = document.getElementById('comboboxki').value;
          const namValue = document.getElementById('NamHoc').value;

          // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
          const requestData = {
            Dot: dotValue,
            Ki: kiValue,
            Nam: namValue,
          };
          const teachingResponse = await fetch('/thong-tin-giang-day', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData),
          });
          if (!teachingResponse.ok) {
            Swal.fire({
              title: 'Th√¥ng b√°o',
              html: "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
              icon: 'info',
              confirmButtonText: 'OK',
              width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
              padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
            });

            return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
          }
          const rs = await teachingResponse.json();

          // L∆∞u d·ªØ li·ªáu k·∫øt qu·∫£
          globalData = rs.results; // D·ªØ li·ªáu k·∫øt qu·∫£
          const check = rs.check; // D·ªØ li·ªáu check
          localStorage.setItem('check', check);

          // Hi·ªÉn th·ªã d·ªØ li·ªáu
          viewData(globalData);
        }

        // load data l·∫•y d·ªØ li·ªáu t·ª´ server
        document.getElementById('getData').addEventListener('click', loadData);

        // view data l·∫•y d·ªØ li·ªáu t·ª´ storage
        function viewData() {
          // let data = JSON.parse(localStorage.getItem('tableData'));
          renderTable(globalData);
          calculateTotals();
        }

        // l·∫•y d·ªØ li·ªáu t∆∞∆°ng ·ª©ng t·ª´ t·ª´ b·∫£ng quy chu·∫©n, l·∫•y d·ªØ li·ªáu b·∫£ng b·ªô m√¥n, l∆∞u v√†o b·∫£ng trong local storage
        async function loadData() {

          const MaPhongBan = localStorage.getItem("MaPhongBan");

          try {
            const response = await fetch('/bo-mon-theo-gv', {
              method: 'GET', // Thay ƒë·ªïi th√†nh POST
              // headers: {
              //   'Content-Type': 'application/json'
              // },
              // body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
            });

            if (!response.ok) {
              throw new Error(`Error: ${response.status} - ${response.statusText}`);
            }

            const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
            localStorage.setItem('boMonTheoGiangVien', JSON.stringify(data));
            const boMonTheoGiangVien = JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
            // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n

          } catch (error) {
            console.error('C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:', error);
          }

          try {
            const response = await fetch('/bo-mon', {
              method: 'POST', // Thay ƒë·ªïi th√†nh POST
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ MaPhongBan }) // G·ª≠i MaPhongBan trong th√¢n y√™u c·∫ßu
            });

            if (!response.ok) {
              throw new Error(`Error: ${response.status} - ${response.statusText}`);
            }

            const data = await response.json(); // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu JSON
            localStorage.setItem('boMon', JSON.stringify(data));
            // Th√™m v√†o b·∫£ng ho·∫∑c x·ª≠ l√Ω d·ªØ li·ªáu theo nhu c·∫ßu c·ªßa b·∫°n

          } catch (error) {
            console.error('C√≥ l·ªói x·∫£y ra khi l·∫•y d·ªØ li·ªáu b·ªô m√¥n:', error);
          }



          try {
            // L·∫•y gi√° tr·ªã t·ª´ c√°c combobox
            const dotValue = document.getElementById('combobox-dot').value;
            const kiValue = document.getElementById('comboboxki').value;
            const namValue = document.getElementById('NamHoc').value;

            // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
            const requestData = {
              Dot: dotValue,
              Ki: kiValue,
              Nam: namValue,
            };

            // G·ªçi API ƒë·∫ßu ti√™n
            console.log('G·ªçi API gv-cohuu...');
            const giangVienRes = await fetch('/gv-cohuu');
            if (!giangVienRes.ok) {
              console.log('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho gv-cohuu!');
              return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
            }
            const giangVien = await giangVienRes.json();
            localStorage.setItem('nameGv', JSON.stringify(giangVien));

            // G·ªçi API th·ª© hai
            console.log('G·ªçi API gv-moi...');
            const giangVienMoiRes = await fetch('/gv-moi');
            if (!giangVienMoiRes.ok) {
              console.log('Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho gv-moi!');
              return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
            }
            const giangVienMoi = await giangVienMoiRes.json();
            localStorage.setItem('nameGvm', JSON.stringify(giangVienMoi));

            // G·ªçi API th·ª© ba
            console.log('G·ªçi API thong-tin-giang-day...');
            const teachingResponse = await fetch('/thong-tin-giang-day', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestData),
            });
            if (!teachingResponse.ok) {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
                icon: 'info',
                confirmButtonText: 'OK',
                width: 'auto',
                padding: '20px',
                timer: 3000, // T·ª± ƒë·ªông ƒë√≥ng sau 3 gi√¢y
                timerProgressBar: true, // Hi·ªÉn th·ªã thanh ƒë·∫øm th·ªùi gian
                didClose: () => {
                  location.reload(); // Reload trang khi ƒë√≥ng
                }
              }).then((result) => {
                if (result.isDismissed || result.isConfirmed) {
                  location.reload(); // Reload trang n·∫øu b·∫•m "OK" ho·∫∑c "X"
                }
              });

              return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
            }

            const rs = await teachingResponse.json();

            // L∆∞u d·ªØ li·ªáu k·∫øt qu·∫£
            globalData = rs.results; // D·ªØ li·ªáu k·∫øt qu·∫£
            const check = rs.check; // D·ªØ li·ªáu check
            localStorage.setItem('check', check);

            // Hi·ªÉn th·ªã d·ªØ li·ªáu
            viewData(globalData);
          } catch (error) {
            console.error('ƒê√£ c√≥ l·ªói x·∫£y ra:', error);
          }
        }

        // render ra b·∫£ng
        function renderTable(data) {
          const tableBody = document.getElementById('tableBody');
          tableBody.innerHTML = ''; // X√≥a n·ªôi dung c≈©

          const role = localStorage.getItem("userRole");
          const isKhoa = parseInt(localStorage.getItem("isKhoa"), 10); // Chuy·ªÉn ƒë·ªïi isKhoa th√†nh s·ªë
          const MaPhongBan = localStorage.getItem("MaPhongBan")

          // id truy·ªÅn v√†o ƒë·ªÉ ƒë√°nh d·∫•u m·ªói d√≤ng, m·ª•c ƒë√≠ch l·∫•y ph·∫ßn t·ª≠ v√† so s√°nh v·ªõi b·∫£ng trong localStorage
          data.forEach((row, id) => {
            const tableRow = document.createElement('tr');


            // G√°n ID trong csdl th√†nh attribute c·ªßa t·ª´ng h√†ng
            tableRow.setAttribute("data-id", row.ID);

            const lopHocPhanTd = document.createElement('td');
            lopHocPhanTd.textContent = `${row.LopHocPhan} (${row.TenLop})` || '';
            tableRow.appendChild(lopHocPhanTd);

            const soTcTd = document.createElement('td');
            soTcTd.textContent = row.SoTinChi || '';
            tableRow.appendChild(soTcTd);

            const giaoVienTd = document.createElement('td');
            giaoVienTd.textContent = row.GiaoVien || '';
            tableRow.appendChild(giaoVienTd);

            // T·∫°o m·ªôt √¥ td cho checkbox
            const moiGiangTd = document.createElement('td');

            // T·∫°o checkbox
            const inviteCheckbox = document.createElement('input');
            inviteCheckbox.name = 'moigiang';
            inviteCheckbox.type = 'checkbox';
            inviteCheckbox.checked = row.MoiGiang || false;

            // Th√™m checkbox v√†o √¥ td
            moiGiangTd.appendChild(inviteCheckbox);

            // Th√™m √¥ td v√†o h√†ng b·∫£ng
            tableRow.appendChild(moiGiangTd);

            const giaoVienGiangDayTd = document.createElement('td');
            const giaoVienGiangDayInput = document.createElement('input');
            giaoVienGiangDayInput.style.width = "100%";
            giaoVienGiangDayInput.style.boxSizing = "border-box";
            giaoVienGiangDayInput.type = 'text';
            giaoVienGiangDayInput.placeholder = 'Nh·∫≠p t√™n gi·∫£ng vi√™n';
            giaoVienGiangDayInput.value = row.GiaoVienGiangDay || '';
            // G√°n id cho input
            giaoVienGiangDayInput.id = `giaoVienGiangDayInput-${row.ID}`;

            giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
            tableRow.appendChild(giaoVienGiangDayTd);

            giaoVienGiangDayInput.onfocus = () => {
              const moiGiang = inviteCheckbox.checked;
              showSuggestionsGiangVien(giaoVienGiangDayInput, moiGiang, row.ID);
            };

            giaoVienGiangDayTd.appendChild(giaoVienGiangDayInput);
            tableRow.appendChild(giaoVienGiangDayTd);

            const khoaTd = document.createElement('td');
            khoaTd.textContent = row.Khoa || '';
            tableRow.appendChild(khoaTd);

            const boMonTd = document.createElement('td');
            const boMonInput = document.createElement('input');
            boMonTd.style.maxWidth = '64px';
            boMonInput.style.width = "100%";
            boMonInput.style.boxSizing = "border-box";
            boMonInput.type = 'text';
            boMonInput.name = 'bomon';
            boMonInput.value = row.BoMon || '';
            boMonInput.placeholder = 'Nh·∫≠p t√™n b·ªô m√¥n';
            // T·∫°o ID cho b·ªô m√¥n
            boMonInput.id = `boMonInput-${row.ID}`;
            boMonTd.appendChild(boMonInput);
            tableRow.appendChild(boMonTd);
  
            showSuggestionsBoMon(boMonInput);

            //Th·∫ª select h√¨nh th·ª©c thi gi·ªØa k·ª≥
            let he_dao_taoTd;
            let he_dao_taoSelect;
            he_dao_taoTd = document.createElement('td');
            he_dao_taoSelect = document.createElement('select');
            he_dao_taoSelect.name = 'he_dao_tao';

            // T·∫°o c√°c t√πy ch·ªçn cho select (c√≥ th·ªÉ thay ƒë·ªïi t√πy theo y√™u c·∫ßu)
            const options = [
              { value: 'ƒê·∫°i h·ªçc (M·∫≠t m√£)', text: 'ƒê·∫°i h·ªçc (M·∫≠t m√£)' },
              { value: 'ƒê·∫°i h·ªçc (ƒê√≥ng h·ªçc ph√≠)', text: 'ƒê·∫°i h·ªçc (ƒê√≥ng h·ªçc ph√≠)' },
              { value: 'Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)', text: 'Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)' },
              { value: 'Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)', text: 'Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)' },
            ];

            // Th√™m c√°c t√πy ch·ªçn v√†o select
            options.forEach(optionData => {
              const option = document.createElement('option');
              option.value = optionData.value;
              option.textContent = optionData.text;
              if (row.he_dao_tao === optionData.value) {
                option.selected = true;
              }
              he_dao_taoSelect.appendChild(option);
            });
            // Th√™m style tr·ª±c ti·∫øp
            he_dao_taoSelect.style.setProperty('background-color', 'white', 'important');
            he_dao_taoSelect.style.setProperty('color', 'black', 'important');
            he_dao_taoSelect.style.padding = '5px';
            //he_dao_taoSelect.style.maxWidth = "120px"

            he_dao_taoTd.appendChild(he_dao_taoSelect);
            // Th√™m id ƒë·ªÉ l·∫•y d·ªØ li·ªáu 
            he_dao_taoSelect.id = `he_dao_tao-${row.ID}`;
            tableRow.appendChild(he_dao_taoTd);


            const soTietLLTd = document.createElement('td');
            soTietLLTd.textContent = row.LL || '';
            tableRow.appendChild(soTietLLTd);

            const soTietQCTd = document.createElement('td');
            soTietQCTd.textContent = row.QuyChuan || '';
            tableRow.appendChild(soTietQCTd);

            // C·ªôt Ng√†y B·∫Øt ƒê·∫ßu
            const ngayBatDauTd = document.createElement('td');
            const ngayBatDauInput = document.createElement('input');
            ngayBatDauTd.style.maxWidth = "95px"; // Ho·∫∑c k√≠ch th∆∞·ªõc mong mu·ªën
            ngayBatDauInput.style.width = "100%";
            ngayBatDauInput.style.boxSizing = "border-box";
            ngayBatDauInput.type = 'date';
            ngayBatDauInput.name = 'startDate';
            ngayBatDauInput.value = formatDate(row.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y

            // Th√™m s·ª± ki·ªán paste cho input ng√†y b·∫Øt ƒë·∫ßu
            ngayBatDauInput.addEventListener('paste', (event) => {
              handleDatePaste(event, ngayBatDauInput);
            });

            ngayBatDauTd.appendChild(ngayBatDauInput);
            tableRow.appendChild(ngayBatDauTd);

            // C·ªôt Ng√†y K·∫øt Th√∫c
            const ngayKetThucTd = document.createElement('td');
            const ngayKetThucInput = document.createElement('input');
            ngayKetThucTd.style.maxWidth = "95px"; // Ho·∫∑c k√≠ch th∆∞·ªõc mong mu·ªën
            ngayKetThucInput.style.width = "100%";
            ngayKetThucInput.style.boxSizing = "border-box";
            ngayKetThucInput.type = 'date';
            ngayKetThucInput.name = 'endDate';
            ngayKetThucInput.value = formatDate(row.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y

            // Th√™m s·ª± ki·ªán paste cho input ng√†y k·∫øt th√∫c
            ngayKetThucInput.addEventListener('paste', (event) => {
              handleDatePaste(event, ngayKetThucInput);
            });

            ngayKetThucTd.appendChild(ngayKetThucInput);
            tableRow.appendChild(ngayKetThucTd);

            const ghiChuTd = document.createElement("td");
            const ghiChuValue = row.GhiChu && row.GhiChu.trim() !== "" ? row.GhiChu : false;
            const deadlineValue = row.Deadline || ""; // L·∫•y gi√° tr·ªã Deadline
            const hoanThanh = row.HoanThanh;
            if (role === 'GV' || role === 'Th∆∞·ªùng') {
              ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu role l√† GV ho·∫∑c Th∆∞·ªùng
              ghiChuTd.style.cursor = "not-allowed"; // Thay ƒë·ªïi con tr·ªè chu·ªôt th√†nh 'not-allowed' ƒë·ªÉ b√°o hi·ªáu kh√¥ng th·ªÉ t∆∞∆°ng t√°c
              ghiChuTd.title = "B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p"; // Th√™m tooltip ƒë·ªÉ gi·∫£i th√≠ch l√Ω do kh√¥ng th·ªÉ nh·∫•n
            } else {

              if (ghiChuValue) {
                if (hoanThanh) {
                  ghiChuTd.innerHTML = `üìú <span class="bi bi-check2-circle" style="color: green;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m xanh
                } else {
                  ghiChuTd.innerHTML = `üìú <span class="bi bi-circle" style="color: red;"></span>`; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ v√† ch·∫•m ƒë·ªè
                }

              } else {
                ghiChuTd.innerHTML = "üìú"; // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng ghi ch√∫ n·∫øu kh√¥ng c√≥ ghi ch√∫
              }
              ghiChuTd.style.cursor = "pointer"; // Thay ƒë·ªïi con tr·ªè chu·ªôt khi di chu·ªôt qua bi·ªÉu t∆∞·ª£ng
              ghiChuTd.onclick = () => openNoteForm(tableRow, ghiChuValue, deadlineValue); // G·ªçi h√†m m·ªü form khi nh·∫•n v√†o bi·ªÉu t∆∞·ª£ng
            }
            tableRow.appendChild(ghiChuTd); // Th√™m √¥ ghi ch√∫ v√†o h√†ng

            let khoaCheckboxTd, khoaCheckbox;
            khoaCheckboxTd = document.createElement('td');
            khoaCheckbox = document.createElement('input');
            khoaCheckbox.type = 'checkbox';
            khoaCheckbox.name = 'khoa';
            khoaCheckbox.checked = row.KhoaDuyet;
            khoaCheckbox.onchange = () => updateCheckAll('khoa');
            khoaCheckboxTd.appendChild(khoaCheckbox);
            tableRow.appendChild(khoaCheckboxTd);

            let daoTaoCheckboxTd, daoTaoCheckbox;
            daoTaoCheckboxTd = document.createElement('td');
            daoTaoCheckbox = document.createElement('input');
            daoTaoCheckbox.disabled = true;
            daoTaoCheckbox.type = 'checkbox';
            daoTaoCheckbox.name = 'daotao';
            daoTaoCheckbox.checked = row.DaoTaoDuyet;
            daoTaoCheckboxTd.appendChild(daoTaoCheckbox);
            tableRow.appendChild(daoTaoCheckboxTd);

            let taiChinhCheckboxTd, taiChinhCheckbox;
            taiChinhCheckboxTd = document.createElement('td');
            taiChinhCheckbox = document.createElement('input');
            taiChinhCheckbox.disabled = true;
            taiChinhCheckbox.type = 'checkbox';
            taiChinhCheckbox.name = 'taichinh';
            taiChinhCheckbox.checked = row.TaiChinhDuyet;
            taiChinhCheckboxTd.appendChild(taiChinhCheckbox);
            tableRow.appendChild(taiChinhCheckboxTd);


            // ƒêi·ªÅu ki·ªán ·∫©n checkbox Khoa n·∫øu role kh√¥ng ph·∫£i "CNTT_ALL"
            if (role != "L√£nh ƒë·∫°o khoa") {
              // Thi·∫øt l·∫≠p thu·ªôc t√≠nh CSS ƒë·ªÉ thu nh·ªè checkbox v√† √¥ <td> ch·ª©a n√≥
              khoaCheckbox.style.width = '10px'; // ƒê·∫∑t chi·ªÅu r·ªông nh·ªè nh·∫•t c√≥ th·ªÉ
              khoaCheckbox.style.height = '10px'; // ƒê·∫∑t chi·ªÅu cao nh·ªè nh·∫•t c√≥ th·ªÉ
              khoaCheckbox.style.display = 'none';
              daoTaoCheckbox.style.display = 'none';
              taiChinhCheckbox.style.display = 'none';

              khoaCheckboxTd.style.width = '1px';
              khoaCheckboxTd.style.padding = '0';
            }


            // N·∫øu L√£nh ƒë·∫°o khoa ƒë√£ duy·ªát, thi h√†nh s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
            // N·∫øu role l√† gi·∫£ng vi√™n th∆∞·ªùng c≈©ng s·∫Ω kh√¥ng nh·∫≠p ƒë∆∞·ª£c
            if (role == "GV" || row.KhoaDuyet == 1) {
              inviteCheckbox.disabled = true
              giaoVienGiangDayInput.disabled = true;
              boMonInput.disabled = true;
              he_dao_taoSelect.disabled = true;
              ngayBatDauInput.disabled = true;
              // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
              ngayKetThucInput.disabled = true;
            }

            const check = localStorage.getItem("check");

            // Ph√¢n quy·ªÅn theo ph√≤ng ban
            if (isKhoa == 1) { // N·∫øu l√† khoa
              if (check.includes(MaPhongBan)) {
                inviteCheckbox.disabled = true;

                giaoVienGiangDayInput.disabled = true;
                boMonInput.disabled = true;
                he_dao_taoSelect.disabled = true;
                ngayBatDauInput.disabled = true;
                // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i ng√†y k·∫øt th√∫c
                ngayKetThucInput.disabled = true;

                if (role == "L√£nh ƒë·∫°o khoa") {
                  khoaCheckbox.disabled = true;

                  // NgƒÉn checkbox t·ªïng c·ªßa 'khoa' kh√¥ng cho thay ƒë·ªïi
                  disableCheckAll('khoa');

                }
                // NgƒÉn ng∆∞·ªùi d√πng thay ƒë·ªïi tr·∫°ng th√°i checkbox

              }
            }

            // Th√™m h√†ng v√†o body c·ªßa b·∫£ng
            tableBody.appendChild(tableRow);
          });

          // Th√™m s·ª± ki·ªán khi doubleclick ƒë·ªÉ c√≥ th·ªÉ copy ƒë∆∞·ª£c ng√†y
          addDoubleClickEvents();
        }

        function addDoubleClickEvents() {
          // get all date input fields
          let dateInputs = document.querySelectorAll('[type="date"]');

          dateInputs.forEach(el => {
            // register double-click event to change date input to text input and select the value
            el.addEventListener('dblclick', () => {
              el.type = "text";

              // After changing input type with JS, .select() needs a timeout to work
              setTimeout(() => {
                el.select();
              });
            });

            // register the focusout event to reset the input back to a date input field
            el.addEventListener('focusout', () => {
              el.type = "date";
            });
          });
        }


        function disableCheckAll(type) {
          const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

          if (checkAllCheckbox) {
            checkAllCheckbox.disabled = true;
            // NgƒÉn kh√¥ng cho ng∆∞·ªùi d√πng thay ƒë·ªïi checkbox t·ªïng
            //checkAllCheckbox.addEventListener('click', function (e) {
             // e.preventDefault(); // NgƒÉn thay ƒë·ªïi tr·∫°ng th√°i
            //});
          }
        }

        // x·ª≠ l√≠ hi·ªÉn th·ªã ng√†y th√°ng nƒÉm
        function formatDate(dateString) {
          if (!dateString) return 'N/A'; // Ho·∫∑c tr·∫£ v·ªÅ gi√° tr·ªã m·∫∑c ƒë·ªãnh
          const date = new Date(dateString);
          if (isNaN(date)) return 'N/A'; // Ki·ªÉm tra n·∫øu ng√†y kh√¥ng h·ª£p l·ªá
          const year = date.getFullYear();
          const month = String(date.getMonth() + 1).padStart(2, '0');
          const day = String(date.getDate()).padStart(2, '0');
          return `${year}-${month}-${day}`; // ƒê·ªãnh d·∫°ng YYYY-MM-DD
        }

        // l∆∞u b·∫£ng v√†o localStorage
        function saveTableToLocalStorage(data) {
          localStorage.setItem('tableData', JSON.stringify(data));
        }

        // H√†m hi·ªÉn th·ªã g·ª£i √Ω ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t
        function showSuggestions(input, moiGiang, id) {
          const boMonTheoGiangVien = JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
          const bangDuLieu = globalData; // Assuming globalData is available in the current scope
          console.log("ID trong db c·ªßa l·ªõp n√†y: ", id);

          const rawValue = input.value.trim(); // L·∫•y to√†n b·ªô gi√° tr·ªã trong √¥ input
          const values = rawValue.split(',').map(val => val.trim()); // T√°ch c√°c t√™n ƒë√£ nh·∫≠p
          const value = values.pop().toLowerCase(); // L·∫•y gi√° tr·ªã cu·ªëi c√πng (t√™n m·ªõi nh·∫≠p)
          hideSuggestions(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω

          const suggestionsContainer = document.createElement('div');
          suggestionsContainer.className = 'suggestions';
          const { bottom, left, width } = input.getBoundingClientRect();
          suggestionsContainer.style.position = 'absolute';
          suggestionsContainer.style.top = `${bottom + window.scrollY}px`;
          suggestionsContainer.style.left = `${left + window.scrollX}px`;
          suggestionsContainer.style.width = `${width}px`;
          suggestionsContainer.style.zIndex = '1000';
          suggestionsContainer.style.maxHeight = '200px';
          suggestionsContainer.style.overflowY = 'auto';
          document.body.appendChild(suggestionsContainer);

          let suggestions = [];
          const nameGvm = JSON.parse(localStorage.getItem("nameGvm")) || [];
          const nameGv = JSON.parse(localStorage.getItem("nameGv")) || [];

          // Ki·ªÉm tra id trong bangDuLieu
          const currentObject = bangDuLieu.find(item => item.ID === id);
          if (!currentObject) {
            console.warn("Kh√¥ng t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng v·ªõi ID n√†y trong bangDuLieu.");
            return;
          }

          const he_dao_tao = currentObject.he_dao_tao;
          const validhe_dao_tao = ["Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)", "Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)"];

          // Ki·ªÉm tra ƒëi·ªÅu ki·ªán ƒë·ªÉ g·ª£i √Ω
          if (values.length > 0 && !validhe_dao_tao.includes(he_dao_tao)) {
            console.warn("Kh√¥ng th·ªÉ g·ª£i √Ω t√™n th·ª© 2 do he_dao_tao kh√¥ng h·ª£p l·ªá.");
            suggestionsContainer.remove();
            return;
          }

          // G·ª£i √Ω t·ª´ nameGvm n·∫øu l√† t√™n th·ª© 2 v√† he_dao_tao h·ª£p l·ªá
          if (values.length > 0 && validhe_dao_tao.includes(he_dao_tao)) {
            if (moiGiang) {
              suggestions = nameGvm
                .map(item => `${item.HoTen} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            } else {
              suggestions = nameGv
                .map(item => `${item.TenNhanVien} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            }
          } else if (values.length === 0) {
            // N·∫øu ch∆∞a c√≥ t√™n n√†o, l·∫•y t·∫•t c·∫£ c√°c gi·∫£ng vi√™n, ph√¢n bi·ªát theo moiGiang
            if (moiGiang) {
              suggestions = nameGvm
                .map(item => `${item.HoTen} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            } else {
              suggestions = nameGv
                .map(item => `${item.TenNhanVien} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            }
          }

          if (suggestions.length === 0) {
            suggestionsContainer.remove();
            return;
          }

          suggestions.forEach(name => {
            const suggestionItem = document.createElement('div');
            suggestionItem.className = 'suggestion-item';
            suggestionItem.textContent = name;

            suggestionItem.onclick = function () {
              const selectedName = name.split(" - ")[0];

              // C·∫≠p nh·∫≠t gi√° tr·ªã c·ªßa input
              input.value = values.length > 0
                ? `${values.join(', ')}, ${selectedName}`
                : selectedName;
              console.log(input.value);

              const lecturerFound = boMonTheoGiangVien.find(lecturer => lecturer.HoTen === selectedName.trim());
              if (lecturerFound) {
                const giaoVienGiangDayInput = document.getElementById(`giaoVienGiangDayInput-${id}`);
                giaoVienGiangDayInput.value = input.value;
                const boMonInput = document.getElementById(`boMonInput-${id}`);
                boMonInput.value = lecturerFound.MonGiangDayChinh;

                fetch('/update-name', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({
                    GiaoVienGiangDay: input.value,
                    BoMon: lecturerFound.MonGiangDayChinh,
                    ID: id
                  })
                })
                  .then(response => {
                    if (!response.ok) {
                      throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
                    }
                    return response.json();
                  })
                  .then(data => {
                    console.log(data.message);
                  })
                  .catch(error => {
                    console.error('C√≥ l·ªói x·∫£y ra:', error);
                  });
              }

              hideSuggestions();
            };

            suggestionsContainer.appendChild(suggestionItem);
          });

          input.onblur = function () {
            setTimeout(() => {
              hideSuggestions();
            }, 100);
          };
        }

        // H√†m ·∫©n g·ª£i √Ω
        function hideSuggestions() {
          const existingSuggestions = document.querySelectorAll('.suggestions');
          existingSuggestions.forEach(suggestion => suggestion.remove());
        }
      });

      function calculateTotals() {
        let totalLL = 0; // Reset t·ªïng s·ªë ti·∫øt LL
        let totalQC = 0; // Reset t·ªïng s·ªë ti·∫øt QC

        const rows = document.querySelectorAll('#tableBody tr'); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

        rows.forEach((row) => {
          // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
          if (row.style.display === 'none') {
            return;
          }

          // Gi·∫£ s·ª≠ c·ªôt LL l√† c·ªôt th·ª© 2 v√† c·ªôt QuyChuan l√† c·ªôt th·ª© 3
          const LLCell = row.querySelector('td:nth-child(9)'); // L·∫•y √¥ c·ªßa c·ªôt LL
          const QuyChuanCell = row.querySelector('td:nth-child(10)'); // L·∫•y √¥ c·ªßa c·ªôt QuyChuan

          // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã c·ªßa c√°c √¥ th√†nh s·ªë v√† c·ªông d·ªìn
          const LL = parseFloat(LLCell.textContent) || 0; // N·∫øu kh√¥ng ph·∫£i s·ªë, m·∫∑c ƒë·ªãnh l√† 0
          const QuyChuan = parseFloat(QuyChuanCell.textContent) || 0;

          totalLL += LL; // C·ªông d·ªìn s·ªë ti·∫øt LL
          totalQC += QuyChuan; // C·ªông d·ªìn s·ªë ti·∫øt QC
        });

        // C·∫≠p nh·∫≠t t·ªïng s·ªë ti·∫øt v√†o HTML v·ªõi 2 s·ªë sau d·∫•u ph·∫©y
        document.getElementById('totalLL').textContent = totalLL.toFixed(2);
        document.getElementById('totalQC').textContent = totalQC.toFixed(2);
      }

      $(document).ready(function () {
        // C·∫•u h√¨nh autocomplete
        $("#filterBoMon").autocomplete({
            source: function (request, response) {
                const value = request.term.toLowerCase();

                const boMon = JSON.parse(localStorage.getItem("boMon"));

                let suggestions = boMon
                    .map(item => `${item.MaPhongBan} - ${item.TenBoMon} - ${item.MaBoMon}`);
    
                // N·∫øu c√≥ gi√° tr·ªã nh·∫≠p v√†o th√¨ l·ªçc
                if (value) {
                    suggestions = suggestions.filter(name => name.toLowerCase().includes(value));
                }
    
                response(suggestions);
            },
            minLength: 0, // Cho ph√©p hi·ªÉn th·ªã ngay khi nh·∫•n v√†o √¥ input
            select: function (event, ui) {
                let parts = ui.item.value.split("-");
                let processedName = parts.slice(2).join("-").trim();
                $("#filterBoMon").val(processedName);
                filterTable();
                return false;
            }
        });
    
        // Khi click v√†o √¥ input, hi·ªÉn th·ªã danh s√°ch g·ª£i √Ω ngay l·∫≠p t·ª©c
        $("#filterBoMon").on("focus", function () {
            $(this).autocomplete("search", ""); // G·ªçi autocomplete v·ªõi chu·ªói r·ªóng ƒë·ªÉ hi·ªÉn th·ªã to√†n b·ªô
        });
    });
    
    let boMonTheoGiangVienCache =
      JSON.parse(localStorage.getItem("boMonTheoGiangVien")) || [];
    let nameGvmCache = JSON.parse(localStorage.getItem("nameGvm")) || [];
    let nameGvCoHuuCache = JSON.parse(localStorage.getItem("nameGv")) || [];
    let valuesCache;

    function showSuggestionsGiangVien(input, moiGiang, id) {
      $(input).autocomplete({
        source: function (request, response) {
          //const rawValue = request.term.trim();
          const bangDuLieuCache = globalData;
          const rawValue = input.value.trim();
          const values = rawValue.split(",").map((val) => val.trim());
          valuesCache = values;
          const value = values.pop().toLowerCase();

          const currentObject = bangDuLieuCache.find(
            (item) => item.ID === id
          );
          if (!currentObject){
            return;
          } 

          const he_dao_tao = currentObject.he_dao_tao;
          const validhe_dao_tao = [
            "Nghi√™n c·ª©u sinh (ƒê√≥ng h·ªçc ph√≠)",
            "Cao h·ªçc (ƒê√≥ng h·ªçc ph√≠)",
          ];

          let suggestions = [];

          // N·∫øu ƒë√£ nh·∫≠p 1 gi·∫£ng vi√™n v√† h·ªá ƒë√†o t·∫°o kh√¥ng h·ª£p l·ªá => kh√¥ng g·ª£i √Ω
          if (values.length > 0 && !validhe_dao_tao.includes(he_dao_tao))
            return;

          // G·ª£i √Ω theo ƒëi·ªÅu ki·ªán
          if (values.length > 0 && validhe_dao_tao.includes(he_dao_tao)) {
            if (moiGiang) {
              suggestions = nameGvmCache
                .map(item => `${item.HoTen} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            } else {
              suggestions = nameGvCoHuuCache
                .map(item => `${item.TenNhanVien} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            }
          } else if (values.length === 0) {
            // N·∫øu ch∆∞a c√≥ t√™n n√†o, l·∫•y t·∫•t c·∫£ c√°c gi·∫£ng vi√™n, ph√¢n bi·ªát theo moiGiang
            if (moiGiang) {
              suggestions = nameGvmCache
                .map(item => `${item.HoTen} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            } else {
              suggestions = nameGvCoHuuCache
                .map(item => `${item.TenNhanVien} - ${item.MaPhongBan}`)
                .filter(name => name.toLowerCase().includes(value)); // L·ªçc theo gi√° tr·ªã nh·∫≠p v√†o
            }
          }

          // L·ªçc nhanh b·∫±ng regex
          if (value) {
            const regex = new RegExp(value, "i");
            suggestions = suggestions.filter((name) => regex.test(name));
          }

          response(suggestions);
        },
        minLength: 0,
        delay: 0,
        autoFocus: false, // t·ª± ƒë·ªông focus m·ª•c ƒë·∫ßu ti√™n
        select: function (event, ui) {
          const selectedName = ui.item.value.split(" - ")[0];
          const values = valuesCache;
          const bangDuLieuCache = globalData;
          const itemIndex = bangDuLieuCache.findIndex(
            (item) => item.ID === id
          );
          if (itemIndex === -1) return;

          const ID = bangDuLieuCache[itemIndex].ID;
          input.value =
            values.length > 0
              ? `${values.join(", ")}, ${selectedName}`
              : selectedName;

          const lecturerFound = boMonTheoGiangVienCache.find(
            (lecturer) => lecturer.HoTen === selectedName.trim()
          );

          if (lecturerFound) {
            const data = {
              GiaoVienGiangDay: input.value,
              BoMon: lecturerFound.MonGiangDayChinh,
              ID: ID,
            };

            const boMonInput = document.getElementById(`boMonInput-${id}`);

            if (boMonInput) boMonInput.value = lecturerFound.MonGiangDayChinh;

            fetch("/update-name", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            }).catch((error) => console.error("C√≥ l·ªói x·∫£y ra:", error));
          }

          return false;
        },
      });

      // G·ªçi autocomplete "search" khi input ƒë∆∞·ª£c focus ho·∫∑c click
      $(input).on("focus click", function () {
        $(this).autocomplete("search", "");
      });
    }

    function showSuggestionsBoMon(input) {
      // Ki·ªÉm tra n·∫øu autocomplete ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o
      if ($(input).data("ui-autocomplete")) {
        return;
      }

      // L·∫•y d·ªØ li·ªáu t·ª´ localStorage ch·ªâ m·ªôt l·∫ßn
      let boMon = JSON.parse(localStorage.getItem("boMon")) || [];
      let suggestions = boMon.map(
        (item) => `${item.TenBoMon} - ${item.MaBoMon}`
      );

      $(input).autocomplete({
        source: function (request, response) {
          let value = request.term.toLowerCase();
          let filteredSuggestions = suggestions.filter((name) =>
            name.toLowerCase().includes(value)
          );
          response(filteredSuggestions);
        },
        minLength: 0,
        select: function (event, ui) {
          let parts = ui.item.value.split("-");
          let processedName = parts[1].trim();
          $(input).val(processedName);
          return false;
        },
      });

      $(input).on("focus", function () {
        if (!$(this).data("ui-autocomplete")) return;
        $(this).autocomplete("search", "");
      });
    }


    /*
      // H√†m g·ª£i √Ω b·ªô m√¥n ·ªü √¥ nh·∫≠p
      function showSuggestionsBoMon(input) {
        const value = input.value.toLowerCase(); // L·∫•y gi√° tr·ªã nh·∫≠p v√†o v√† chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng
        // alert(value);
        hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω c≈© tr∆∞·ªõc khi hi·ªÉn th·ªã g·ª£i √Ω m·ªõi

        // T·∫°o th·∫ª div ch·ª©a g·ª£i √Ω
        const suggestionsContainer = document.createElement('div');
        suggestionsContainer.className = 'suggestions'; // ƒê·∫∑t class cho khung g·ª£i √Ω

        // ƒê·∫∑t v·ªã tr√≠ cho suggestionsContainer
        const { bottom, left, width } = input.getBoundingClientRect(); // L·∫•y v·ªã tr√≠ c·ªßa input
        suggestionsContainer.style.position = 'absolute'; // ƒê·ªÉ ƒë√® l√™n b·∫£ng
        suggestionsContainer.style.top = `${bottom + window.scrollY}px`; // ƒê·∫∑t v·ªã tr√≠ ngay d∆∞·ªõi input
        suggestionsContainer.style.left = `${left + window.scrollX}px`; // CƒÉn tr√°i v·ªõi input
        suggestionsContainer.style.width = `${width}px`; // Chi·ªÅu r·ªông b·∫±ng v·ªõi input
        suggestionsContainer.style.zIndex = '1000'; // ƒê·∫£m b·∫£o lu√¥n hi·ªÉn th·ªã tr√™n c√°c th√†nh ph·∫ßn kh√°c
        suggestionsContainer.style.maxHeight = '200px'; // Gi·ªõi h·∫°n chi·ªÅu cao ƒë·ªÉ kh√¥ng qu√° l·ªõn
        suggestionsContainer.style.overflowY = 'auto'; // Cho ph√©p cu·ªôn d·ªçc n·∫øu qu√° nhi·ªÅu g·ª£i √Ω

        // Th√™m suggestionsContainer v√†o DOM
        document.body.appendChild(suggestionsContainer); // ƒê·∫∑t suggestionsContainer v√†o body thay v√¨ cha c·ªßa input

        let suggestions = []; // Kh·ªüi t·∫°o m·∫£ng g·ª£i √Ω

        // L·∫•y d·ªØ li·ªáu t·ª´ localStorage
        const boMon = JSON.parse(localStorage.getItem("boMon")) || [];
        console.log('Danh s√°ch b·ªô m√¥n :', boMon); // In danh s√°ch b·ªô m√¥n


        suggestions = boMon.map(item => `${item.TenBoMon} - ${item.MaBoMon}`);


        // N·∫øu ng∆∞·ªùi d√πng nh·∫≠p d·ªØ li·ªáu, l·ªçc k·∫øt qu·∫£ theo t√™n gi·∫£ng vi√™n
        if (value) {
          suggestions = suggestions.filter(name => name.toLowerCase().includes(value));
        }

        // N·∫øu kh√¥ng c√≥ g·ª£i √Ω, ·∫©n container
        if (suggestions.length === 0) {
          suggestionsContainer.remove();
          return; // K·∫øt th√∫c h√†m n·∫øu kh√¥ng c√≥ g·ª£i √Ω
        }

        // T·∫°o g·ª£i √Ω d∆∞·ªõi d·∫°ng danh s√°ch (list)
        suggestions.forEach(name => {
          const suggestionItem = document.createElement('div'); // T·∫°o ph·∫ßn t·ª≠ cho t·ª´ng g·ª£i √Ω
          suggestionItem.className = 'suggestion-item'; // ƒê·∫∑t class ƒë·ªÉ t√πy ch·ªânh giao di·ªán
          suggestionItem.textContent = name; // Hi·ªÉn th·ªã t√™n gi·∫£ng vi√™n k√®m theo khoa

          // Th√™m s·ª± ki·ªán click ƒë·ªÉ ƒëi·ªÅn t√™n v√†o √¥ input
          suggestionItem.onclick = function () {
            // Gi·∫£ s·ª≠ 'name' l√† gi√° tr·ªã g·ª£i √Ω b·∫°n nh·∫≠n ƒë∆∞·ª£c t·ª´ suggestionItem
            const name = suggestionItem.innerText; // Ho·∫∑c c√≥ th·ªÉ l√† suggestionItem.textContent
            console.log('gi√° tr·ªã nh·∫≠p : ', name);
            // T√¨m v·ªã tr√≠ c·ªßa d·∫•u "-" trong chu·ªói
            const dashIndex = name.indexOf("-");

            // N·∫øu kh√¥ng c√≥ d·∫•u "-", s·ª≠ d·ª•ng t√™n g·ª£i √Ω g·ªëc
            let processedName = name;

            if (dashIndex !== -1) {
              // L·∫•y ph·∫ßn sau d·∫•u "-" v√† lo·∫°i b·ªè kho·∫£ng tr·∫Øng
              processedName = name.slice(dashIndex + 1).trim().replace(/\s+/g, '');
            }

            // ƒêi·ªÅn t√™n g·ª£i √Ω ƒë√£ x·ª≠ l√Ω v√†o √¥ input
            input.value = processedName;
            if (input.id == 'filterBoMon') {
              filterTable();
            }
            hideSuggestionsBoMon(); // ·∫®n g·ª£i √Ω sau khi ch·ªçn
          };

          suggestionsContainer.appendChild(suggestionItem); // Th√™m m·ª•c v√†o danh s√°ch g·ª£i √Ω
        });

        // ·∫®n g·ª£i √Ω khi input kh√¥ng c√≤n focus
        input.onblur = function () {
          setTimeout(() => {
            hideSuggestionsBoMon();
          }, 100); // Th·ªùi gian ch·ªù ƒë·ªÉ nh·∫≠n di·ªán click
        };
      }

      // H√†m ·∫©n g·ª£i √Ω
      function hideSuggestionsBoMon() {
        const existingSuggestions = document.querySelectorAll('.suggestions');
        existingSuggestions.forEach(suggestion => suggestion.remove());
      }
*/
      // H√†m x·ª≠ l√Ω t√¨m ki·∫øm theo t√™n b·ªô m√¥n
      function filterBoMon() {
        const input = document.getElementById('filterBoMon');
        const filter = input.value.trim().toLowerCase(); // B·ªè kho·∫£ng tr·∫Øng v√† chuy·ªÉn ch·ªØ th∆∞·ªùng
        const tableRows = document.querySelectorAll('#tableBody tr');

        tableRows.forEach(row => {
          const nameInput = row.querySelector('td:nth-child(7) input[name="bomon"]'); // L·∫•y input c√≥ name="bomon" ·ªü c·ªôt th·ª© 7
          const checkbox = row.querySelector('input[type="checkbox"]');

          if (nameInput) {
            const name = nameInput.value.toLowerCase(); // L·∫•y gi√° tr·ªã c·ªßa input c√≥ name="bomon"

            if (filter === '' || name.includes(filter)) {
              row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp ho·∫∑c filter tr·ªëng
              checkbox.disabled = false; // K√≠ch ho·∫°t checkbox
            } else {
              row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
              checkbox.disabled = true; // V√¥ hi·ªáu h√≥a checkbox
            }
          }
        });
        calculateTotals();
      }

      // H√†m x·ª≠ l√≠ : ·∫•n l∆∞u d·ªØ li·ªáu s·∫Ω c·∫≠p nh·∫≠t v√†o localStorage, db ch∆∞a thay ƒë·ªïi
      function updateGlobalDataFromTable() {
        const rows = document.querySelectorAll('#tableBody tr'); // L·∫•y t·∫•t c·∫£ c√°c h√†ng trong b·∫£ng

        rows.forEach((row, index) => {
          // B·ªè qua c√°c h√†ng ƒëang b·ªã ·∫©n
          if (row.style.display === 'none') {
            return;
          }

          // L·∫•y c√°c gi√° tr·ªã t·ª´ c√°c √¥ nh·∫≠p v√† checkbox
          const giaoVienGiangDayInput = row.querySelector('input[type="text"][placeholder="Nh·∫≠p t√™n gi·∫£ng vi√™n"]');
          const boMonInput = row.querySelector('input[type="text"][placeholder="Nh·∫≠p t√™n b·ªô m√¥n"]');
          const he_dao_taoSelect = row.querySelector('select[name="he_dao_tao"]');
          const moiGiangCheckbox = row.querySelector('input[type="checkbox"][name="moigiang"]');
          const khoaCheckbox = row.querySelector('input[type="checkbox"][name="khoa"]');

          // L·∫•y gi√° tr·ªã t·ª´ c√°c √¥ nh·∫≠p li·ªáu
          const giaoVienGiangDay = giaoVienGiangDayInput ? giaoVienGiangDayInput.value : '';
          const boMon = boMonInput ? boMonInput.value : '';
          const he_dao_tao = he_dao_taoSelect ? he_dao_taoSelect.value : '';

          // L·∫•y tr·∫°ng th√°i c·ªßa checkbox "Khoa" v√† "ƒê√†o T·∫°o"
          const khoaDuyet = khoaCheckbox ? khoaCheckbox.checked : false;
          const moiGiang = moiGiangCheckbox ? moiGiangCheckbox.checked : false;

          // L·∫•y gi√° tr·ªã c·ªßa c√°c √¥ ng√†y b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c
          const ngayBatDauInput = row.querySelector('input[type="date"][name="startDate"]');
          const ngayKetThucInput = row.querySelector('input[type="date"][name="endDate"]');

          const ngayBatDauValue = ngayBatDauInput ? ngayBatDauInput.value : '';
          const ngayKetThucValue = ngayKetThucInput ? ngayKetThucInput.value : '';

          // So s√°nh v√† c·∫≠p nh·∫≠t n·∫øu c·∫ßn
          const currentNgayBatDau = globalData[index].NgayBatDau || '';
          const currentNgayKetThuc = globalData[index].NgayKetThuc || '';

          // C·∫≠p nh·∫≠t v√†o d·ªØ li·ªáu to√†n c·ª•c (globalData)
          if (currentNgayBatDau == '' || currentNgayBatDau != ngayBatDauValue) {
            globalData[index].NgayBatDau = ngayBatDauValue; // C·∫≠p nh·∫≠t ng√†y b·∫Øt ƒë·∫ßu n·∫øu c·∫ßn
          }

          if (currentNgayKetThuc == '' || currentNgayKetThuc != ngayKetThucValue) {
            globalData[index].NgayKetThuc = ngayKetThucValue; // C·∫≠p nh·∫≠t ng√†y k·∫øt th√∫c n·∫øu c·∫ßn
          }

          // C·∫≠p nh·∫≠t c√°c gi√° tr·ªã kh√°c kh√¥ng thay ƒë·ªïi
          globalData[index].GiaoVienGiangDay = giaoVienGiangDay;
          globalData[index].KhoaDuyet = khoaDuyet;
          globalData[index].MoiGiang = moiGiang;
          globalData[index].BoMon = boMon;
          globalData[index].he_dao_tao = he_dao_tao;
        });

        // In k·∫øt qu·∫£ ra console ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√†o globalData
        console.log('C·∫≠p nh·∫≠t v√†o globalData: ', globalData);

        // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng n·∫øu c·∫ßn
        // alert('L∆∞u c·ª•c b·ªô th√†nh c√¥ng');
        // window.location.reload();
      }

      // x·ª≠ l√≠ t√¨m theo t√™n
      function filterByName() {
        const input = document.getElementById('filterName');
        const filter = input.value.toLowerCase();
        const tableRows = document.querySelectorAll('#tableBody tr');

        // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
        if (!filter) {
          tableRows.forEach(row => {
            row.style.display = ''; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
          });
          return;
        }

        // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ t√™n gi·∫£ng vi√™n kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
        tableRows.forEach(row => {
          const nameCell = row.querySelector('td:nth-child(3)'); // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n n·∫±m ·ªü c·ªôt th·ª© 3
          const name = nameCell.textContent.toLowerCase();

          if (name.includes(filter)) {
            row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp
          } else {
            row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        });
        calculateTotals();
      }

      // x·ª≠ l√≠ t√¨m theo l·ªõp
      function filterByClass() {
        const input = document.getElementById('filterClass');
        const filter = input.value.toLowerCase();
        const tableRows = document.querySelectorAll('#tableBody tr');

        // N·∫øu √¥ t√¨m ki·∫øm tr·ªëng, hi·ªÉn th·ªã t·∫•t c·∫£ c√°c d√≤ng
        if (!filter) {
          tableRows.forEach(row => {
            row.style.display = ''; // Hi·ªán t·∫•t c·∫£ c√°c d√≤ng
          });
          return;
        }

        // Ch·ªâ hi·ªán c√°c d√≤ng c√≥ t√™n gi·∫£ng vi√™n kh·ªõp v·ªõi gi√° tr·ªã t√¨m ki·∫øm
        tableRows.forEach(row => {
          const nameCell = row.querySelector('td:nth-child(1)'); // Gi·∫£ s·ª≠ t√™n gi·∫£ng vi√™n n·∫±m ·ªü c·ªôt th·ª© 5
          const name = nameCell.textContent.toLowerCase();

          if (name.includes(filter)) {
            row.style.display = ''; // Hi·ªán h√†ng n·∫øu kh·ªõp
          } else {
            row.style.display = 'none'; // ·∫®n h√†ng n·∫øu kh√¥ng kh·ªõp
          }
        });
        calculateTotals();
      }

      // h√†m check all
      function checkAll(type) {
        const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${type}"]`);
        const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

        checkboxes.forEach(checkbox => {
          const row = checkbox.closest('tr');
          if (row.style.display !== 'none') { // Ki·ªÉm tra n·∫øu d√≤ng hi·ªán tr√™n m√†n h√¨nh
            checkbox.checked = checkAllCheckbox.checked; // G√°n tr·∫°ng th√°i checkbox "Check All" cho checkbox hi·ªÉn th·ªã
          }
        });
      }

      // h√†m x·ª≠ l√≠ check all
      function updateCheckAll(type) {
        const checkboxes = document.querySelectorAll(`input[type="checkbox"][name="${type}"]`);
        const checkAllCheckbox = document.getElementById(`checkAll${type.charAt(0).toUpperCase() + type.slice(1)}`);

        // Ki·ªÉm tra n·∫øu t·∫•t c·∫£ checkbox c√° nh√¢n ƒë·ªÅu ƒë∆∞·ª£c ch·ªçn
        const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
        checkAllCheckbox.checked = allChecked; // C·∫≠p nh·∫≠t tr·∫°ng th√°i c·ªßa checkbox "Check All"
      }
      /*
            // H√†m ƒë·∫©y d·ªØ li·ªáu l√™n server
            function submitData() {
      
              // L∆∞u b·∫£ng hi·ªán c√≥ v√†o bi·∫øn globalData
              updateGlobalDataFromTable();
      
              // Fomart l·∫°i ng√†y th√°ng nƒÉm
              globalData.forEach(item => {
                item.NgayBatDau = format(item.NgayBatDau); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
                item.NgayKetThuc = format(item.NgayKetThuc); // ƒê·ªãnh d·∫°ng ng√†y b·∫Øt ƒë·∫ßu
              });
      
              console.log('D·ªØ li·ªáu khi click C·∫≠p nh·∫≠t : ', globalData);
              // G·ª≠i d·ªØ li·ªáu l√™n server
              fetch('/check-teaching', {
                method: 'POST', // Ph∆∞∆°ng th·ª©c POST
                headers: {
                  'Content-Type': 'application/json' // ƒê·ªãnh d·∫°ng g·ª≠i l√† JSON
                },
                body: JSON.stringify(globalData) // Chuy·ªÉn ƒë·ªïi globalData th√†nh chu·ªói JSON
              })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('L·ªói khi g·ª≠i d·ªØ li·ªáu');
                  }
                  return response.json(); // Chuy·ªÉn ƒë·ªïi ph·∫£n h·ªìi th√†nh JSON
                })
                .then(data => {
                  // Hi·ªÉn th·ªã th√¥ng b√°o t·ª´ server
                  const messageWithLineBreaks = data.message.replace(/\n/g, "<br>");
      
                  Swal.fire({
                    title: 'Th√¥ng b√°o',
                    html: messageWithLineBreaks,
                    icon: 'success',
                    confirmButtonText: 'OK',
                    width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                    padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                  }).then(() => {
                    loadDataAfterUpdate();
                    //location.reload();
                  });
                })
                .catch(error => {
                  console.error('C√≥ l·ªói x·∫£y ra:', error);
                  alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t d·ªØ li·ªáu.');
                });
      
            }
      
            async function loadDataAfterUpdate() {
              const dotValue = document.getElementById('combobox-dot').value;
              const kiValue = document.getElementById('comboboxki').value;
              const namValue = document.getElementById('NamHoc').value;
      
              // T·∫°o ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë·ªÉ g·ª≠i
              const requestData = {
                Dot: dotValue,
                Ki: kiValue,
                Nam: namValue,
              };
            const teachingResponse = await fetch('/thong-tin-giang-day', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestData),
            });
            if (!teachingResponse.ok) {
              Swal.fire({
                title: 'Th√¥ng b√°o',
                html: "Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu",
                icon: 'info',
                confirmButtonText: 'OK',
                width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
              });
              return; // D·ª´ng l·∫°i n·∫øu c√≥ l·ªói
            }
            const rs = await teachingResponse.json();
      
            // L∆∞u d·ªØ li·ªáu k·∫øt qu·∫£
            globalData = rs.results; // D·ªØ li·ªáu k·∫øt qu·∫£
            const check = rs.check; // D·ªØ li·ªáu check
            localStorage.setItem('check', check);
      
            // Hi·ªÉn th·ªã d·ªØ li·ªáu
            viewData(globalData);
          }
      */
      // H√†m ƒë·ªãnh d·∫°ng ng√†y th√†nh chu·ªói YYYY-MM-DD
      function format(dateStr) {
        const date = new Date(dateStr);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      // H√†m ki·ªÉm tra xem ng√†y c√≥ ƒë·ªãnh d·∫°ng ISO hay kh√¥ng
      function isISODate(dateStr) {
        const isoRegex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}Z$/;
        return isoRegex.test(dateStr);
      }


    </script>

    <script>
      let currentRow; // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u h√†ng hi·ªán t·∫°i

      function openNoteForm(row, GhiChu, Deadline) {
        currentRow = row; // L∆∞u h√†ng hi·ªán t·∫°i
        // alert(row.getAttribute('data-id'))
        console.log(formatInputDate(Deadline));
        document.getElementById("noteForm").style.display = "block"; // Hi·ªÉn th·ªã form
        document.getElementById("modalBackdrop").style.display = "block"; // Hi·ªÉn th·ªã n·ªÅn t·ªëi

        // Hi·ªÉn th·ªã gi√° tr·ªã ghi ch√∫ v√† h·∫°n
        document.getElementById("noteInput").value = GhiChu || ""; // Hi·ªÉn th·ªã ghi ch√∫
        document.getElementById("deadlineInput").value = formatInputDate(Deadline) || ""; // Hi·ªÉn th·ªã h·∫°n
      }


      function closeNoteForm() {
        document.getElementById("noteForm").style.display = "none"; // ·∫®n form
        document.getElementById("modalBackdrop").style.display = "none"; // ·∫®n n·ªÅn t·ªëi
      }
      window.onclick = function (event) {
        const modal = document.getElementById("noteForm");
        const modalBackdrop = document.getElementById("modalBackdrop");
        if (event.target === modalBackdrop) {
          closeNoteForm();
        }
      }
      async function saveNote() {
        const note = document.getElementById("noteInput").value;
        const deadline = document.getElementById("deadlineInput").value;

        if (currentRow) {
          const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng
          // const id2 = parseInt(id) + 1
          // alert(id2);
          // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
          if (id) {

            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
            try {
              const response = await fetch("/savenote", {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id, ghiChu: note, deadline }),
              });
              const result = await response.json();
              if (!result.success) {
                Swal.fire({
                  title: 'Th√¥ng b√°o',
                  html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                  icon: 'error',
                  confirmButtonText: 'OK',
                  width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              } else {
                Swal.fire({
                  title: 'Th√¥ng b√°o',
                  html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                  icon: 'success',
                  confirmButtonText: 'OK',
                  width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              }
            } catch (error) {
              alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
            }
          } else {
            alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
          }
        } else {
          alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
        }

        closeNoteForm();
      }

      async function doneNote() {
        const note = document.getElementById("noteInput").value;
        const deadline = document.getElementById("deadlineInput").value;

        if (currentRow) {
          const id = currentRow.getAttribute("data-id"); // L·∫•y ID t·ª´ thu·ªôc t√≠nh `data-id` c·ªßa h√†ng
          // alert(id);

          // Ki·ªÉm tra ID c√≥ t·ªìn t·∫°i
          if (id) {


            // G·ª≠i d·ªØ li·ªáu ƒë·∫øn API ƒë·ªÉ l∆∞u v√†o CSDL
            try {
              const response = await fetch('/donenote', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ id, ghiChu: note, deadline }),
              });
              const result = await response.json();
              if (!result.success) {
                Swal.fire({
                  title: 'Th√¥ng b√°o',
                  html: "L·ªói khi l∆∞u ghi ch√∫ v√†o CSDL: " + result.message,
                  icon: 'error',
                  confirmButtonText: 'OK',
                  width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              } else {
                Swal.fire({
                  title: 'Th√¥ng b√°o',
                  html: "C·∫≠p nh·∫≠t th√†nh c√¥ng",
                  icon: 'success',
                  confirmButtonText: 'OK',
                  width: 'auto', // T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh chi·ªÅu r·ªông
                  padding: '20px', // Gi·ªØ kho·∫£ng c√°ch cho n·ªôi dung
                });
              }
            } catch (error) {
              alert("L·ªói khi g·ª≠i y√™u c·∫ßu ƒë·∫øn server: " + error);
            }
          } else {
            alert("ID c·ªßa h√†ng hi·ªán t·∫°i kh√¥ng t·ªìn t·∫°i.");
          }
        } else {
          alert("currentRow kh√¥ng ƒë∆∞·ª£c x√°c ƒë·ªãnh.");
        }

        closeNoteForm();
      }


      // H√†m ƒë·ªÉ chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y
      function formatInputDate(dateString) {
        const date = new Date(dateString);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0'); // L·∫•y th√°ng (0-11) v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë
        const day = String(date.getDate()).padStart(2, '0'); // L·∫•y ng√†y v√† ƒë·∫£m b·∫£o c√≥ 2 ch·ªØ s·ªë

        return `${year}-${month}-${day}`; // Tr·∫£ v·ªÅ ƒë·ªãnh d·∫°ng yyyy-mm-dd cho input
      }



      // S·ª± ki·ªán click ngo√†i modal ƒë·ªÉ ƒë√≥ng modal
      window.onclick = function (event) {
        const modal = document.getElementById("noteForm");
        const modalBackdrop = document.getElementById("modalBackdrop");
        if (event.target === modalBackdrop) {
          closeNoteForm();
        }
      }
    </script>


    <!-- Ph·∫ßn ph√¢n quy·ªÅn -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {

        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="ThongTinGD"
        const ThongTinGD = document.getElementById("ThongTinGD");

        ThongTinGD.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

          const isKhoa = localStorage.getItem("isKhoa"); // L·∫•y role t·ª´ localStorage

          if (isKhoa == 0) { // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/info2";
          } else {
            window.location.href = "/info";
          }
        });

        // Th√™m s·ª± ki·ªán click cho ph·∫ßn t·ª≠ c√≥ id="Home"

        const Home = document.getElementById("Home");

        Home.addEventListener("click", function (event) {
          event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa li√™n k·∫øt

          const isKhoa = localStorage.getItem("isKhoa")

          if (isKhoa == 0) { // N·∫øu l√† ƒë√†o t·∫°o ho·∫∑c t√†i ch√≠nh
            window.location.href = "/maindt";
          } else {
            window.location.href = "/mainkhoa";
          }
        });

        // get all date input fields
        let dateInputs = document.querySelectorAll('[type="date"]');

        dateInputs.forEach(el => {
          // register double click event to change date input to text input and select the value
          el.addEventListener('dblclick', () => {
            el.type = "text";

            // After changing input type with JS .select() wont work as usual
            // Needs timeout fn() to make it work
            setTimeout(() => {
              el.select();
            })
          });

          // register the focusout event to reset the input back to a date input field
          el.addEventListener('focusout', () => {
            el.type = "date";
          });
        });
      });

    </script>

    <script>
      document.getElementById("changePasswordLink").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const tenDangNhap = localStorage.getItem("TenDangNhap"); // L·∫•y TenDangNhap t·ª´ localStorage

        if (tenDangNhap) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changePassword v√† truy·ªÅn TenDangNhap trong URL
          window.location.href = `/changePassword?tenDangNhap=${encodeURIComponent(tenDangNhap)}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y TenDangNhap trong localStorage.");
        }
      });
    </script>
    <script>
      $(document).ready(function () {
        $('#NamHoc option[value=""]').remove();
        $('#comboboxki option[value=""]').remove();
        $('#combobox-dot option[value=""]').remove();

        $.ajax({
          url: '/getNamHoc',
          method: 'GET',
          success: function (response) {
            if (response.success) {

              response.NamHoc.forEach(function (item) {
                console.log(item.NamHoc);
                $('#NamHoc').append(
                  `<option value="${item.NamHoc}">${item.NamHoc}</option>`
                );
              });

              response.Ki.forEach(function (item) {
                console.log(item.Ki);
                $('#comboboxki').append(
                  `<option value="${item.value}">${item.Ki}</option>`
                );
              });
              response.Dot.forEach(function (item) {
                console.log(item.Dot);
                $('#combobox-dot').append(
                  `<option value="${item.value}">${item.Dot}</option>`
                );
              });
            } else {
              console.error("Kh√¥ng l·∫•y ƒë∆∞·ª£c d·ªØ li·ªáu nƒÉm h·ªçc:", response.message);
            }
          },
          error: function (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu nƒÉm h·ªçc:", error);
          }
        });
      });
    </script>
    <script>
      document.getElementById("infome").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const id_User = localStorage.getItem("id_User"); // L·∫•y id_User t·ª´ localStorage\
        if (id_User) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang infome v√† truy·ªÅn id_User trong URL
          window.location.href = `/infome/${id_User}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y id_User trong localStorage.");
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const role = localStorage.getItem("userRole");

        // ·∫®n button ngay khi trang ƒë∆∞·ª£c t·∫£i
        const actionButton = document.getElementById('changeMessage');
        //·∫®n site th√™m th√¥ng b√°o
        if (role === "Duy·ªát") {
          actionButton.style.display = '';
        } else {
          actionButton.style.display = 'none';
        }
      });
    </script>
    <script>
      document.getElementById("changeMessage").addEventListener("click", function (event) {
        event.preventDefault(); // NgƒÉn ch·∫∑n h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa th·∫ª a
        const MaPhongBan = localStorage.getItem("MaPhongBan"); // L·∫•y MaPhongBan t·ª´ localStorage

        if (MaPhongBan) {
          // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang changeMessage v√† truy·ªÅn MaPhongBan trong URL
          window.location.href = `/changeMessage/${MaPhongBan}`;
        } else {
          alert("Kh√¥ng t√¨m th·∫•y MaPhongBan trong localStorage.");
        }
      });
    </script>
</body>

</html>